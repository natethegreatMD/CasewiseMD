"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[8740],{69845:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var a=n(86326),s=n(95e3);const r=function(e,t,n){const a=t.getCustomization("cornerstone.overlayViewportTools");return e.createToolGroupAndAddTools(n,a)};var i=n(43547);const o=function({servicesManager:e,segDisplaySet:t,viewportId:n,preHydrateCallbacks:a,hydrateCallback:s}){return i.utils.promptHydrationDialog({servicesManager:e,viewportId:n,displaySet:t,preHydrateCallbacks:a,hydrateCallback:s,type:"SEG"})};var l=n(99737),c=n(83641);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},p.apply(null,arguments)}const u=function(e){const{servicesManager:t,commandsManager:n}=(0,c.Jg)(),{children:u,displaySets:d,viewportOptions:S}=e,m=S.viewportId,{displaySetService:I,toolGroupService:y,segmentationService:g,customizationService:f}=t.services,v=f.getCustomization("ui.loadingIndicatorTotalPercent"),E=`SEGToolGroup-${m}`;if(d.length>1)throw new Error("SEG viewport should only have a single display set");const w=d[0],[b,D]=(0,s.ihW)(),{setPositionPresentation:h}=(0,i.usePositionPresentationStore)(),[T,C]=(0,a.useState)(!w.isLoaded),[P,N]=(0,a.useState)({percentComplete:null,totalSegments:null}),G=(0,a.useRef)(null),{viewports:M,activeViewportId:k}=b,A=w.referencedDisplaySetInstanceUID,O=I.getDisplaySetByUID(A),U=function(e,t){const{SharedFunctionalGroupsSequence:n}=t.instance,a=Array.isArray(n)?n[0]:n,{PixelMeasuresSequence:s}=a,r=Array.isArray(s)?s[0]:s,{SpacingBetweenSlices:i,SliceThickness:o}=r,l=e.images[0],c={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness||o,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices||i};return c}(O,w);G.current={displaySet:O,metadata:U};const L=(0,a.useCallback)(()=>a.createElement(i.OHIFCornerstoneViewport,p({},e,{displaySets:[w],viewportOptions:{viewportType:S.viewportType,toolGroupId:E,orientation:S.orientation,viewportId:S.viewportId,presentationIds:S.presentationIds},onElementEnabled:t=>{e.onElementEnabled?.(t)}})),[m,w,E,e,S]);(0,a.useEffect)(()=>{T||m===k&&o({servicesManager:t,viewportId:m,segDisplaySet:w,hydrateCallback:async()=>(await n.runCommand("hydrateSecondaryDisplaySet",{displaySet:w,viewportId:m}),!0)})},[t,m,w,T,n,k]),(0,a.useEffect)(()=>{g.clearSegmentationRepresentations(m);const{unsubscribe:e}=g.subscribe(g.EVENTS.SEGMENTATION_LOADING_COMPLETE,e=>{if(e.segDisplaySet.displaySetInstanceUID===w.displaySetInstanceUID&&C(!1),w?.firstSegmentedSliceImageId&&S?.presentationIds){const{firstSegmentedSliceImageId:e}=w,{presentationIds:t}=S;h(t.positionPresentationId,{viewReference:{referencedImageId:e}})}});return()=>{e()}},[w]),(0,a.useEffect)(()=>{const{unsubscribe:e}=g.subscribe(g.EVENTS.SEGMENT_LOADING_COMPLETE,({percentComplete:e,numSegments:t})=>{N({percentComplete:e,totalSegments:t})});return()=>{e()}},[w]),(0,a.useEffect)(()=>{const e=I.subscribe(I.EVENTS.DISPLAY_SETS_REMOVED,({displaySetInstanceUIDs:e})=>{const t=M.get(k);e.includes(t.displaySetInstanceUID)&&D.setDisplaySetsForViewport({viewportId:k,displaySetInstanceUIDs:[]})});return()=>{e.unsubscribe()}},[]),(0,a.useEffect)(()=>{let e=y.getToolGroup(E);if(!e)return n.runCommand("updateStoredSegmentationPresentation",{displaySet:w,type:l.SegmentationRepresentations.Labelmap}),g.clearSegmentationRepresentations(m),e=r(y,f,E),()=>{g.clearSegmentationRepresentations(m),y.destroyToolGroup(E)}},[]);let V=null;return G.current&&O.displaySetInstanceUID===G.current.displaySet.displaySetInstanceUID?(u&&u.length&&(V=u.map((e,t)=>e&&a.cloneElement(e,{viewportId:m,key:t}))),a.createElement(a.Fragment,null,a.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},T&&a.createElement(v,{className:"h-full w-full",totalNumbers:P.totalSegments,percentComplete:P.percentComplete,loadingText:"Loading SEG..."}),L(),V))):null}}}]);
//# sourceMappingURL=8740.bundle.caf905114579c4694161.js.map