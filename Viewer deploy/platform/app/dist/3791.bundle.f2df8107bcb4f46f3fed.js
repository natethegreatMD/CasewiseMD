"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[3791],{5057:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(53586),o=n(48080),a=n(92885),r=n(71209);function s(e,t){const n=e.image;if(!e.canvas||!e.image)return;const s=(0,i.A)();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let i=n.render;i||(i=e.viewport.colormap?r.l:n.color?o.f:a.j),i(e,t)}const l=(0,i.A)()-s;n.stats.lastRenderTime=l,e.invalid=!1,e.needsRedraw=!1}},7808:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(45354);function o(e,t){const n=new i.d;if(!e.viewport.displayedArea)return n;n.translate(e.canvas.width/2,e.canvas.height/2);const o=e.viewport.rotation;0!==o&&n.rotate(o*Math.PI/180);let a=e.viewport.scale,r=e.viewport.scale;const s=e.viewport.displayedArea.brhc.x-(e.viewport.displayedArea.tlhc.x-1),l=e.viewport.displayedArea.brhc.y-(e.viewport.displayedArea.tlhc.y-1);if("NONE"===e.viewport.displayedArea.presentationSizeMode)e.image.rowPixelSpacing<e.image.columnPixelSpacing?a*=e.image.columnPixelSpacing/e.image.rowPixelSpacing:e.image.columnPixelSpacing<e.image.rowPixelSpacing&&(r*=e.image.rowPixelSpacing/e.image.columnPixelSpacing);else if(a=e.viewport.displayedArea.columnPixelSpacing,r=e.viewport.displayedArea.rowPixelSpacing,"SCALE TO FIT"===e.viewport.displayedArea.presentationSizeMode){const t=e.canvas.height/(l*r),n=e.canvas.width/(s*a);a=r=Math.min(n,t),e.viewport.displayedArea.rowPixelSpacing<e.viewport.displayedArea.columnPixelSpacing?a*=e.viewport.displayedArea.columnPixelSpacing/e.viewport.displayedArea.rowPixelSpacing:e.viewport.displayedArea.columnPixelSpacing<e.viewport.displayedArea.rowPixelSpacing&&(r*=e.viewport.displayedArea.rowPixelSpacing/e.viewport.displayedArea.columnPixelSpacing)}return n.scale(a,r),0!==o&&n.rotate(-o*Math.PI/180),n.translate(e.viewport.translation.x,e.viewport.translation.y),0!==o&&n.rotate(o*Math.PI/180),void 0!==t&&n.scale(t,t),e.viewport.hflip&&n.scale(-1,1),e.viewport.vflip&&n.scale(1,-1),n.translate(-s/2,-l/2),n}},36931:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(12132),o=n(57162);function a(e,t,n,a){if(void 0===e)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(void 0===t)return(0,i.A)();const r=(0,o.A)(e,t,0).scaleFactor;let s;return"PT"===n&&t.isPreScaled?s={windowWidth:5,windowCenter:2.5}:void 0!==t.windowWidth&&void 0!==t.windowCenter&&(s={windowWidth:Array.isArray(t.windowWidth)?t.windowWidth[0]:t.windowWidth,windowCenter:Array.isArray(t.windowCenter)?t.windowCenter[0]:t.windowCenter}),{scale:r,translation:{x:0,y:0},voi:s,invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:t.modalityLUT,modality:n,voiLUT:t.voiLUT,colormap:void 0!==a?a:t.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:t.columns,y:t.rows},rowPixelSpacing:void 0===t.rowPixelSpacing?1:t.rowPixelSpacing,columnPixelSpacing:void 0===t.columnPixelSpacing?1:t.columnPixelSpacing,presentationSizeMode:"NONE"}}}},50584:(e,t,n)=>{n(49038),n(86252),n(90808),n(29625),n(50180),n(1271)},71851:(e,t,n)=>{n.d(t,{BlendModes:()=>l.A,CalibrationTypes:()=>m.A,Events:()=>o.A,GeometryType:()=>d.A,ImageQualityStatus:()=>p.A,InterpolationType:()=>s.A,MeshType:()=>g.A,MetadataModules:()=>v.A,OrientationAxis:()=>c.A,RequestType:()=>a.A,VOILUTFunctionType:()=>u.A,VideoEnums:()=>f,ViewportStatus:()=>h.A,ViewportType:()=>r.A});var i,o=n(32643),a=n(43213),r=n(41864),s=n(29310),l=n(63591),c=n(18735),d=n(91346),g=(n(86066),n(32731)),u=n(82501),m=(n(91369),n(38059)),h=n(1814),p=n(77474),f=n(13545),v=n(69850);!function(e){e.SUM="SUM",e.SUBTRACT="SUBTRACT",e.AVERAGE="AVERAGE"}(i||(i={}));n(6796)},15327:(e,t,n)=>{n.d(t,{BaseVolumeViewport:()=>l.A,CONSTANTS:()=>o,Enums:()=>i,StackViewport:()=>c.A,VolumeViewport:()=>s.A,addImageSlicesToViewports:()=>P.ge,addVolumesToViewports:()=>P.x,cache:()=>u.Ay,convertMapperToNotSharedMapper:()=>r.h,createVolumeActor:()=>a.A,eventTarget:()=>d.A,getEnabledElement:()=>m.Ay,getEnabledElementByIds:()=>m.b1,getEnabledElementByViewportId:()=>m.yj,getEnabledElements:()=>m.zb,getRenderingEngine:()=>g.lD,getRenderingEngines:()=>g.qO,getWebWorkerManager:()=>p.G_,metaData:()=>h,triggerEvent:()=>E.A,utilities:()=>M,volumeLoader:()=>x});var i=n(71851),o=n(19325),a=(n(56706),n(61640)),r=n(92099),s=(n(30135),n(94155)),l=(n(40893),n(46347)),c=n(79720),d=(n(32501),n(81466),n(10056),n(10364)),g=(n(78337),n(39536)),u=(n(50584),n(49038)),m=(n(91073),n(51159),n(86846)),h=n(74876),p=n(26896);const f=Symbol("DefaultSettings"),v=Symbol("RuntimeSettings"),w=Symbol("ObjectSettingsMap"),I=Symbol("Dictionary");class A{constructor(e){const t=Object.create(e instanceof A&&I in e?e[I]:null);Object.seal(Object.defineProperty(this,I,{value:t}))}set(e,t){return b(this[I],e,t,null)}get(e){return function(e,t){return e[t]}(this[I],e)}unset(e){return function(e,t){if(t.endsWith(".")){let n=0;const i=t,o=i.slice(0,-1),a=0===o.length;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a||t.startsWith(i)||t===o)&&(delete e[t],++n);return n>0}return delete e[t]}(this[I],e+"")}forEach(e){S(this[I],e)}extend(){return new A(this)}import(e){y(e)&&Object.keys(e).forEach(t=>{b(this[I],t,e[t],null)})}dump(){const e={};return S(this[I],(t,n)=>{void 0!==n&&R(e,t,n)}),e}static assert(e){return e instanceof A?e:A.getRuntimeSettings()}static getDefaultSettings(e=null){let t=A[f];if(t instanceof A||(t=new A,A[f]=t),e){const n={};return t.forEach(i=>{if(i.startsWith(e)){const o=i.split(`${e}.`)[1];n[o]=t.get(i)}}),n}return t}static getRuntimeSettings(){let e=A[v];return e instanceof A||(e=new A(A.getDefaultSettings()),A[v]=e),e}static getObjectSettings(e,t){let n=null;if(e instanceof A)n=e;else if("object"==typeof e&&null!==e){let i=A[w];i instanceof WeakMap||(i=new WeakMap,A[w]=i),n=i.get(e),n instanceof A||(n=new A(A.assert(A.getObjectSettings(t))),i.set(e,n))}return n}static extendRuntimeSettings(){return A.getRuntimeSettings().extend()}}function S(e,t){for(const n in e)t(n,e[n])}function b(e,t,n,i){return!!function(e){let t,n,i;if("string"!=typeof e||(t=e.length-1)<0)return!1;i=-1;for(;(n=e.indexOf(".",i+1))>=0;){if(n-i<2||n===t)return!1;i=n}return!0}(t)&&(y(n)?function(e,t,n,i){let o;if(i.has(n))return b(e,t,null,i);i.add(n),o=0;for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&(b(e,0===a.length?t:`${t}.${a}`,n[a],i)||++o);return i.delete(n),0===o}(e,t,n,i instanceof WeakSet?i:new WeakSet):(e[t]=n,!0))}function y(e){if("object"==typeof e&&null!==e){const t=Object.getPrototypeOf(e);if(t===Object.prototype||null===t)return!0}return!1}function R(e,t,n){const i=t.indexOf(".");if(i>=0){const o=t.slice(0,i);let a=e[o];if("object"!=typeof a||null===a){const t=a;a={},void 0!==t&&(a[""]=t),e[o]=a}R(a,t.slice(i+1,t.length),n)}else e[t]=n}A.getDefaultSettings().set("useCursors",!0);var x=n(87142),M=(n(80068),n(89926),n(36822),n(10297)),E=n(69372),P=(n(55500),n(55509),n(56074),n(40661))},80068:(e,t,n)=>{n.d(t,{createAndCacheDerivedImages:()=>A,createAndCacheLocalImage:()=>S,loadAndCacheImage:()=>w,loadImage:()=>v});var i=n(49038),o=n(32643),a=n(10364),r=n(27119),s=n(99576),l=n(69372),c=n(80221),d=n(24623),g=(n(51159),n(74876)),u=n(6796);const m={};let h;function p(e,t){const n=i.Ay.getImageLoadObject(e);if(n)return f(n.promise,e),n;const o=e.split(":")[0],a=m[o]||h;if(!a)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${o}'`);const r=a(e,t);return f(r.promise,e),r}function f(e,t){Promise.resolve(e).then(e=>{!function(e){if(!e.voxelManager){const{width:t,height:n,numberOfComponents:i}=e,o=d.A.createImageVoxelManager({scalarData:e.getPixelData(),width:t,height:n,numberOfComponents:i});e.voxelManager=o,e.getPixelData=()=>o.getScalarData(),delete e.imageFrame.pixelData}}(e),(0,l.A)(a.A,o.A.IMAGE_LOADED,{image:e})}).catch(e=>{const n={imageId:t,error:e};(0,l.A)(a.A,o.A.IMAGE_LOAD_FAILED,n)})}function v(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadImage: parameter imageId must not be undefined");return p(e,t).promise}function w(e,t={priority:0,requestType:"prefetch"}){if(void 0===e)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=p(e,t);return i.Ay.getImageLoadObject(e)||i.Ay.putImageLoadObject(e,n),n.promise}function I(e,t={}){if(void 0===e)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");void 0===t.imageId&&(t.imageId=`derived:${(0,c.A)()}`);const{imageId:n,skipCreateBuffer:o,onCacheAdd:a,voxelRepresentation:l}=t,d=g.get("imagePlaneModule",e),u=d.rows*d.columns,{TypedArrayConstructor:m}=(0,s.h)(t.targetBuffer?.type,u),h=new m(o?1:u),p=n,f=g.get("imagePlaneModule",e);r.A.add(p,{type:"imagePlaneModule",metadata:f});const v=g.get("generalSeriesModule",e);r.A.add(p,{type:"generalSeriesModule",metadata:v}),r.A.add(p,{type:"generalImageModule",metadata:{instanceNumber:t.instanceNumber}});const w=g.get("imagePixelModule",e);r.A.add(p,{type:"imagePixelModule",metadata:{...w,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const I=S(n,{scalarData:h,onCacheAdd:a,skipCreateBuffer:o,targetBuffer:{type:h.constructor.name},voxelRepresentation:l,dimensions:[d.columns,d.rows],spacing:[d.columnPixelSpacing,d.rowPixelSpacing],origin:d.imagePositionPatient,direction:d.imageOrientationPatient,frameOfReferenceUID:d.frameOfReferenceUID,referencedImageId:e});return I.referencedImageId=e,i.Ay.getImageLoadObject(n)||i.Ay.putImageSync(n,I),I}function A(e,t={}){if(0===e.length)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");const n=[];return e.map((e,i)=>{const o={imageId:t?.getDerivedImageId?.(e)||`derived:${(0,c.A)()}`,...t};return n.push(o.imageId),I(e,{...o,instanceNumber:i+1})})}function S(e,t){const{scalarData:n,origin:o,direction:a,targetBuffer:l,skipCreateBuffer:c,onCacheAdd:g,frameOfReferenceUID:m,voxelRepresentation:h,referencedImageId:p}=t,f=t.dimensions,v=t.spacing;if(!f||!v)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const w=f[0],I=f[1],A=v[0],S=v[1],b={frameOfReferenceUID:m,rows:I,columns:w,imageOrientationPatient:a??[1,0,0,0,1,0],rowCosines:a?a.slice(0,3):[1,0,0],columnCosines:a?a.slice(3,6):[0,1,0],imagePositionPatient:o??[0,0,0],pixelSpacing:[S,A],rowPixelSpacing:S,columnPixelSpacing:A},y=w*I,R=n.length/y;let x,M,E,P;if(n){if(!(n instanceof Uint8Array||n instanceof Float32Array||n instanceof Uint16Array||n instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");x=n}else if(!c){const{TypedArrayConstructor:e}=(0,s.h)(l?.type,y);x=new e(y)}if(x instanceof Uint8Array)M=8,E=8,P=7;else if(x instanceof Uint16Array)M=16,E=16,P=15;else if(x instanceof Int16Array)M=16,E=16,P=15;else{if(!(x instanceof Float32Array))throw new Error("Unsupported scalarData type");M=32,E=32,P=31}const C={samplesPerPixel:1,photometricInterpretation:x.length>f[0]*f[1]?"RGB":"MONOCHROME2",rows:I,columns:w,bitsAllocated:M,bitsStored:E,highBit:P},D={imagePlaneModule:b,imagePixelModule:C};["imagePlaneModule","imagePixelModule"].forEach(t=>{r.A.add(e,{type:t,metadata:D[t]||{}})});const T=e,L=h===u.A.RLE&&d.A.createRLEImageVoxelManager({dimensions:f,id:T})||d.A.createImageVoxelManager({height:I,width:w,numberOfComponents:R,scalarData:x,id:T});let _=x[0],O=x[0];for(let e=1;e<x.length;e++)x[e]<_&&(_=x[e]),x[e]>O&&(O=x[e]);const V={imageId:e,intercept:0,windowCenter:0,windowWidth:0,color:"RGB"===C.photometricInterpretation,numberOfComponents:C.samplesPerPixel,dataType:l?.type,slope:1,minPixelValue:_,maxPixelValue:O,rows:C.rows,columns:C.columns,getCanvas:void 0,height:C.rows,width:C.columns,rgba:void 0,columnPixelSpacing:b.columnPixelSpacing,rowPixelSpacing:b.rowPixelSpacing,FrameOfReferenceUID:b.frameOfReferenceUID,invert:!1,getPixelData:()=>L.getScalarData(),voxelManager:L,sizeInBytes:n.byteLength,referencedImageId:p};return g?.(V),i.Ay.putImageSync(V.imageId,V),V}},56750:(e,t,n)=>{n.d(t,{A:()=>i});class i{static{this.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i}static imageIdToFrames(e){const t=e.match(this.frameRangeExtractor);if(!t||!t[2])return null;const n=t[2].split("-").map(e=>Number(e));return 1===n.length?n[0]:n}static imageIdToFrameEnd(e){const t=this.imageIdToFrames(e);return Array.isArray(t)?t[1]:t}static imageIdToFrameStart(e){const t=this.imageIdToFrames(e);return Array.isArray(t)?t[0]:t}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,t){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const i=this.framesToString(t);return e.replace(this.frameRangeExtractor,`${n[1]}${i}`)}}},13876:(e,t,n)=>{n.d(t,{A:()=>i});class i{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:t=1024,dimensions:n=3,growSize:i=128}=e,o=t*n;this.growSize=i,this.array=new ArrayBuffer(o*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=n}forEach(e){for(let t=0;t<this._length;t++)e(this.getPoint(t),t)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const t=this._dimensions*e;return this.data.subarray(t,t+this._dimensions)}getPointArray(e){const t=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;for(let e=0;e<this._dimensions;e++)t.push(this.data[e+n]);return t}grow(e=1,t=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const n=this.data.length+t,i=new ArrayBuffer(n*this._dimensions*this._byteSize),o=new Float32Array(i);o.set(this.data),this.data=o,this.array=i}reverse(){const e=Math.floor(this._length/2);for(let t=0;t<e;t++){const e=t*this._dimensions,n=(this._length-1-t)*this._dimensions;for(let t=0;t<this._dimensions;t++){const i=this.data[e+t];this.data[e+t]=this.data[n+t],this.data[n+t]=i}}}getTypedArray(){return this.data}push(e){this.grow(1);const t=this.length*this._dimensions;for(let n=0;n<this._dimensions;n++)this.data[n+t]=e[n];this._length++}map(e){const t=[];for(let n=0;n<this._length;n++)t.push(e(this.getPoint(n),n));return t}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:t,y:n,z:i}=e;return this.forEach(e=>{t.push(e[0]),n.push(e[1]),i&&i.push(e[2])}),e}static fromXYZ({x:e,y:t,z:n}){const o=i.create3(e.length);let a=0;for(let i=0;i<e.length;i++)o.data[a++]=e[i],o.data[a++]=t[i],o.data[a++]=n?n[i]:0;return o._length=e.length,o}subselect(e=10,t=0){const n=new i({initialSize:e,dimensions:this._dimensions});for(let i=0;i<e;i++){const o=(t+Math.floor(this.length*i/e))%this.length;n.push(this.getPoint(o))}return n}static create3(e=128,t){e=Math.max(e,t?.length||0);const n=new i({initialSize:e,dimensions:3});return t&&t.forEach(e=>n.push(e)),n}static create2(e=128){return new i({initialSize:e,dimensions:2})}}},22191:(e,t,n)=>{n.d(t,{A:()=>i});class i{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const t=new i("as iterator");return e.then(e=>{try{t.add(e,!0)}catch(e){t.reject(e)}},e=>{t.reject(e)}),t}add(e,t=!1){this.nextValue=e,this.done||=t,this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){this.rejectReason=e,this.waiting?.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(void 0!==this.nextValue&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,t)=>{this.waiting.resolve=e,this.waiting.reject=t})),await this.waiting.promise}yield this.nextValue}async forEach(e,t){let n=0;try{for await(const i of this){const{done:o}=this;try{await e(i,o,n),n++}catch(e){if(!o){console.warn("Caught exception in intermediate value",e);continue}if(!t)throw e;t(e,o)}}}catch(e){if(!t)throw e;t(e,!0)}}generate(e,t){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},e=>{this.reject(e),t?t(e):console.warn("Couldn't process because",e)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}}},67645:(e,t,n)=>{n.d(t,{A:()=>s});const i=[[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],o=[[0,-1,0],[0,1,0]],a=[[0,-1,0],[0,1,0],[0,0,-1]],r=[[0,-1,0],[0,1,0],[0,0,1]];class s{static copyMap(e,t){for(const[n,i]of t.rows)e.rows.set(n,structuredClone(i))}constructor(e,t,n=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.pixelDataConstructor=Uint8Array,this.updateScalarData=function(e){e.fill(0);this.forEach((t,n,i)=>{const{start:o,end:a,value:r}=n;for(let n=o;n<a;n++)e[t+n]=r})},this.get=e=>{const t=e%this.jMultiple,n=(e-t)/this.jMultiple,i=this.getRLE(t,n);return i?.value??this.defaultValue},this.getRun=(e,t)=>{const n=e+t*this.height;return this.rows.get(n)},this.set=(e,t)=>{if(void 0===t)return;const n=e%this.width,i=(e-n)/this.width,o=this.rows.get(i);if(!o)return void this.rows.set(i,[{start:n,end:n+1,value:t}]);const a=this.findIndex(o,n),r=o[a],s=o[a-1];if(!r)return s&&s.value===t&&s.end===n?void s.end++:void(o[a]={start:n,end:n+1,value:t});const{start:l,end:c,value:d}=r;if(t===d&&n>=l)return;const g={start:n,end:n+1,value:t},u=n>l,m=u?a+1:a,h=u?r:s;let p=u?o[a+1]:r;if(h?.value===t&&h?.end===n)return h.end++,void(p?.value===t&&p.start===n+1?(h.end=p.end,o.splice(a,1)):p?.start===n&&(p.start++,p.start===p.end&&(o.splice(a,1),p=o[a],p?.start===n+1&&p.value===t&&(h.end=p.end,o.splice(a,1)))));if(p?.value===t&&p.start===n+1)return p.start--,void(h?.end>n&&(h.end=n,h.end===h.start&&o.splice(a,1)));if(p?.start===n&&p.end===n+1){p.value=t;const e=o[a+1];return void(e?.start==n+1&&e.value===t&&(o.splice(a+1,1),p.end=e.end))}n===p?.start&&p.start++,u&&c>n+1?o.splice(m,0,g,{start:n+1,end:h.end,value:h.value}):o.splice(m,0,g),h?.end>n&&(h.end=n)},this.width=e,this.height=t,this.depth=n,this.jMultiple=e,this.kMultiple=this.jMultiple*t}static{this.getScalarData=function(e=Uint8ClampedArray){const t=new e(this.frameSize);return this.map.updateScalarData(t),t}}toIJK(e){const t=e%this.jMultiple;return[t,(e-t)/this.jMultiple%this.height,Math.floor(e/this.kMultiple)]}toIndex([e,t,n]){return e+n*this.kMultiple+t*this.jMultiple}getRLE(e,t,n=0){const i=this.rows.get(t+n*this.height);if(!i)return;const o=i[this.findIndex(i,e)];return e>=o?.start?o:void 0}has(e){const t=e%this.jMultiple,n=(e-t)/this.jMultiple,i=this.getRLE(t,n);return void 0!==i?.value}delete(e){const t=e%this.width,n=(e-t)/this.width,i=this.rows.get(n);if(!i)return;const o=this.findIndex(i,t),a=i[o];if(!a||a.start>t)return;if(a.end===t+1)return a.end--,void(a.start>=a.end&&(i.splice(o,1),i.length||this.rows.delete(n)));if(a.start===t)return void a.start++;const r={value:a.value,start:t+1,end:a.end};a.end=t,i.splice(o+1,0,r)}findIndex(e,t){for(let n=0;n<e.length;n++){const{end:i}=e[n];if(t<i)return n}return e.length}forEach(e,t){const n=t?.rowModified;for(const[t,i]of this.rows){const o=n?[...i]:i;for(const n of o)e(t*this.width,n,i)}}forEachRow(e){for(const[t,n]of this.rows)e(t*this.width,n)}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,t){t?t.fill(0):t=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:n,height:i,numComps:o}=this;for(let a=0;a<i;a++){const i=this.getRun(a,e);if(i)if(1===o)for(const e of i){const i=a*n,{start:o,end:r,value:s}=e;for(let e=o;e<r;e++)t[i+e]=s}else for(const e of i){const i=a*n*o,{start:r,end:s,value:l}=e;for(let e=r;e<s;e+=o)for(let n=0;n<o;n++)t[i+e+n]=l[n]}}return t}floodFill(e,t,n,i,o){const a=this.getRLE(e,t,n);if(!a)throw new Error(`Initial point ${e},${t},${n} isn't in the RLE`);const r=[[a,t,n]],s=a.value;if(s===i)throw new Error(`source (${s}) and destination (${i}) are identical`);return this.flood(r,s,i,o)}flood(e,t,n,i){let o=0;const{planar:a=!0,diagonals:r=!0,singlePlane:s=!1}=i||{},l={planar:a,diagonals:r,singlePlane:s};for(;e.length;){const i=e.pop(),[a]=i;if(a.value!==t)continue;a.value=n,o+=a.end-a.start;const r=this.findAdjacents(i,l).filter(e=>e&&e[0].value===t);e.push(...r)}return o}fillFrom(e,t){for(let n=t[2][0];n<=t[2][1];n++)for(let i=t[1][0];i<=t[1][1];i++){let o,a;for(let r=t[0][0];r<=t[0][1];r++){const t=e(r,i,n);void 0!==t?(a||(a=[],this.rows.set(i+n*this.height,a)),o&&o.value!==t&&(o=void 0),o||(o={start:r,end:r,value:t},a.push(o)),o.end++):o=void 0}}}findAdjacents(e,{diagonals:t=!0,planar:n=!0,singlePlane:s=!1}){const[l,c,d,g]=e,{start:u,end:m}=l,h=u>0&&this.getRLE(u-1,c,d),p=m<this.width&&this.getRLE(m,c,d),f=t?[u>0?u-1:u,m<this.width?m+1:m]:[u,m],v=[];h&&v.push([h,c,d]),p&&v.push([p,c,d]);for(const e of g||(s?o:i)){const[,t,l]=e,u=t+c,m=l+d;if(u<0||u>=this.height)continue;if(m<0||m>=this.depth)continue;const h=this.getRun(u,m);if(h)for(const e of h){const t=g||s&&o||n&&l>0&&r||n&&l<0&&a||i;e.end<=f[0]||e.start>=f[1]||v.push([e,u,m,t])}}return v}}},98039:(e,t,n)=>{function i(e){return o(e,"vtkVolume")||o(e,"vtkImageSlice")}function o(e,t){const n="isA"in e?e:e.actor;return!!n&&!!n.isA(t)}n.d(t,{N:()=>o,e:()=>i})},96833:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(642),o=n(99341);function a(e,t){const n=t.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:a}=function(e){let t=1/0,n=-1/0;for(let i=0;i<e.length;i+=4)t=Math.min(t,e[i]),n=Math.max(n,e[i]);const i=(n-t)/2;return{shiftRange:[-i,i],min:t,max:n}}(n),r=a[0],s=a[1]-a[0],l=i.Ay.newInstance(),c=[];for(let e=0;e<n.length;e+=4){let t=n[e];const i=n[e+1],o=n[e+2],a=n[e+3];t=(t-r)/s,c.push([t,i,o,a])}!function(e,t,n){const i=t[1]-t[0],o=e.map(([e,n,o,a])=>[e*i+t[0],n,o,a]);n.removeAllPoints(),o.forEach(([e,t,i,o])=>n.addRGBPoint(e,t,i,o))}(c,a,l),e.getProperty().setRGBTransferFunction(0,l);const d=t.scalarOpacity.split(" ").splice(1).map(parseFloat),g=o.Ay.newInstance(),u=[];for(let e=0;e<d.length;e+=2){let t=d[e];const n=d[e+1];t=(t-r)/s,u.push([t,n])}!function(e,t,n){const i=t[1]-t[0],o=e.map(([e,n])=>[e*i+t[0],n]);n.removeAllPoints(),o.forEach(([e,t])=>n.addPoint(e,t))}(u,a,g);const m=e.getProperty();m.setScalarOpacity(0,g);const[h,p,f,v]=t.gradientOpacity.split(" ").splice(1).map(parseFloat);m.setUseGradientOpacity(0,!0),m.setGradientOpacityMinimumValue(0,h),m.setGradientOpacityMinimumOpacity(0,p),m.setGradientOpacityMaximumValue(0,f),m.setGradientOpacityMaximumOpacity(0,v),"1"===t.interpolation&&m.setInterpolationTypeToFastLinear(),m.setShade("1"===t.shade);const w=parseFloat(t.ambient),I=parseFloat(t.diffuse),A=parseFloat(t.specular),S=parseFloat(t.specularPower);m.setAmbient(w),m.setDiffuse(I),m.setSpecular(A),m.setSpecularPower(S)}},91979:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(39536),o=n(24724);const a=e=>{const t=function(e){const t=(0,i.qO)(),n=[];return t.forEach(t=>{const i=(0,o.A)(e);i.length&&n.push({renderingEngine:t,viewportIds:i.map(e=>e.id)})}),n}(e);t?.length&&t.forEach(({renderingEngine:e,viewportIds:t})=>{e.hasBeenDestroyed||e.renderViewports(t)})}},89131:(e,t,n)=>{n.d(t,{KP:()=>r,SJ:()=>a});var i=n(74876),o=n(71851);function a(e){const t={...i.get(o.MetadataModules.IMAGE_PLANE,e)};return t.columnPixelSpacing||(t.columnPixelSpacing=1),t.rowPixelSpacing||(t.rowPixelSpacing=1),t.columnCosines||(t.columnCosines=[0,1,0]),t.rowCosines||(t.rowCosines=[1,0,0]),t.imagePositionPatient||(t.imagePositionPatient=[0,0,0]),t.imageOrientationPatient||(t.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),t}function r(e){const t=e.imageId,{pixelRepresentation:n,bitsAllocated:r,bitsStored:s,highBit:l,photometricInterpretation:c,samplesPerPixel:d}=i.get("imagePixelModule",t),{windowWidth:g,windowCenter:u,voiLUTFunction:m}=e,{modality:h}=i.get("generalSeriesModule",t),p=i.get("scalingModule",t),f=i.get(o.MetadataModules.CALIBRATION,t),v=function(e){return Object.values(o.VOILUTFunctionType).includes(e)?e:o.VOILUTFunctionType.LINEAR}(m);return{calibration:f,scalingFactor:p,voiLUTFunction:v,modality:h,imagePlaneModule:a(t),imagePixelModule:{bitsAllocated:r,bitsStored:s,samplesPerPixel:d,highBit:l,photometricInterpretation:c,pixelRepresentation:n,windowWidth:g,windowCenter:u,modality:h,voiLUTFunction:v}}}},42384:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(3823),o=n(74876),a=n(26896);function r(e){const{imagePositionPatient:t,imageOrientationPatient:n}=o.get("imagePlaneModule",e[0]),r=i.eR.fromValues(n[0],n[1],n[2]),s=i.eR.fromValues(n[3],n[4],n[5]),l=i.eR.create();i.eR.cross(l,r,s);const c=i.eR.fromValues(t[0],t[1],t[2]);let d;function g(e){const{imagePositionPatient:t}=o.get("imagePlaneModule",e),n=i.eR.create(),a=i.eR.fromValues(t[0],t[1],t[2]);return i.eR.sub(n,c,a),i.eR.dot(n,l)}if("wadouri"===e[0].split(":")[0]){const t=[e[0],e[Math.floor(e.length/2)]],n=(g(t[0]),g(t[1]),o.get("imagePlaneModule",t[1]));if(!n)throw new Error("Incomplete metadata required for volume construction.");const a=i.eR.create(),r=i.eR.fromValues(n.imagePositionPatient[0],n.imagePositionPatient[1],n.imagePositionPatient[2]);i.eR.sub(a,c,r);const s=i.eR.dot(a,l);d=Math.abs(s)/Math.floor(e.length/2)}else{const t=e.map(e=>({distance:g(e),imageId:e}));t.sort((e,t)=>t.distance-e.distance);const n=t.length;d=Math.abs(t[n-1].distance-t[0].distance)/(n-1)}const{sliceThickness:u,spacingBetweenSlices:m}=o.get("imagePlaneModule",e[0]),{strictZSpacingForVolumeViewport:h}=(0,a.D0)().rendering;return 0!==d&&!isNaN(d)||h||(m?(console.debug("Could not calculate spacing. Using spacingBetweenSlices"),d=m):u?(console.debug("Could not calculate spacing and no spacingBetweenSlices. Using sliceThickness"),d=u):(console.debug("Could not calculate spacing. The VolumeViewport visualization is compromised. Setting spacing to 1 to render"),d=1)),d}},84061:(e,t,n)=>{function i(e,t,n){return Math.max(t,Math.min(n,e))}n.d(t,{A:()=>i,q:()=>i})},13859:(e,t,n)=>{n.r(t),n.d(t,{findMatchingColormap:()=>u,getColormap:()=>d,getColormapNames:()=>g,getMaxOpacity:()=>w,getThresholdValue:()=>v,registerColormap:()=>c,setColorMapTransferFunctionForVolumeActor:()=>m,updateOpacity:()=>h,updateThreshold:()=>p});var i=n(660),o=n(642),a=n(99341),r=n(74638),s=n(98039);const l=new Map;function c(e){e.name=e.name||e.Name,l.set(e.name,e)}function d(e){return l.get(e)}function g(){return Array.from(l.keys())}function u(e,t){const n=i.A.rgbPresetNames.map(e=>i.A.getPresetByName(e)),o=g().map(e=>d(e)),a=n.concat(o).find(t=>{const{RGBPoints:n}=t;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t+=4)if(!(0,r.Ay)(n.slice(t+1,t+4),e.slice(t+1,t+4)))return!1;return!0});if(!a)return null;const l=[];if((0,s.N)(t,"vtkVolume")){const e=t.getProperty().getScalarOpacity(0).getDataPointer();if(!e)return{name:a.Name};for(let t=0;t<e.length;t+=2)l.push({value:e[t],opacity:e[t+1]})}return{name:a.Name,opacity:l}}function m(e){const{volumeActor:t,preset:n,opacity:a=.9,threshold:r=null,colorRange:s=[0,5]}=e;t.getMapper().setSampleDistance(1);const l=o.Ay.newInstance(),c=n||i.A.getPresetByName("hsv");l.applyColorMap(c),l.setMappingRange(s[0],s[1]),t.getProperty().setRGBTransferFunction(0,l),f(t,a,r)}function h(e,t){f(e,t,v(e))}function p(e,t){f(e,w(e),t)}function f(e,t,n){const i=e.getMapper().getInputData().get("voxelManager");if(!i?.voxelManager)throw new Error("No voxel manager was found for the volume actor, or you cannot yet update opacity with a threshold using stacked images");const o=i.voxelManager.getRange(),r=a.Ay.newInstance();if(null!==n){const e=.001*Math.abs(o[1]-o[0]),i=Math.max(o[0],Math.min(o[1],n));r.addPoint(o[0],0),r.addPoint(i-e,0),r.addPoint(i,t),r.addPoint(o[1],t)}else r.addPoint(o[0],t),r.addPoint(o[1],t);e.getProperty().setScalarOpacity(0,r)}function v(e){const t=e.getProperty().getScalarOpacity(0);if(!t)return null;const n=t.getDataPointer();if(!n||n.length<=4)return null;for(let e=0;e<n.length-2;e+=2){n[e];const t=n[e+1],i=n[e+2],o=n[e+3];if(0===t&&o>0)return i}return null}function w(e){const t=e.getProperty().getScalarOpacity(0);if(!t)return 1;const n=t.getDataPointer();if(!n||0===n.length)return 1;let i=0;for(let e=1;e<n.length;e+=2)n[e]>i&&(i=n[e]);return i}},74657:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(642);function o(e){const t=i.Ay.newInstance();let n=0,o=1024;return void 0!==e.lower&&void 0!==e.upper&&(n=e.lower,o=e.upper),t.addRGBPoint(n,0,0,0),t.addRGBPoint(o,1,1,1),t}},40256:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(642),o=n(42008),a=n(68136),r=n(58977);function s(e,t=1024){const{windowWidth:n,windowCenter:s}=a.toWindowLevel(e.lower,e.upper),l=Array.from({length:t},(e,n)=>(n+1)/(t+2)).flatMap(e=>[(0,r.i)(e,s,n),e,e,e,.5,0]),c=i.Ay.newInstance();return c.buildFunctionFromArray(o.Ay.newInstance({values:l,numberOfComponents:6})),c}},63470:(e,t,n)=>{function i(e,t,n=0){const i=[];for(let o=n;o<e.length;o+=t)i.push(o);return i}n.d(t,{A:()=>i})},99949:(e,t,n)=>{function i(e){if(null===e||"object"!=typeof e)return e;if("function"==typeof e)return e;if("function"==typeof structuredClone)return e;if(Array.isArray(e))return e.map(i);{const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=i(e[n]));return t}}n.d(t,{G:()=>i})},20286:(e,t,n)=>{function i(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return(t>>>0).toString(36)}n.d(t,{A:()=>i})},88619:(e,t,n)=>{n.d(t,{A:()=>c});var i=n(3823),o=n(74876),a=n(7608),r=n(85008),s=n(19325);const l=a.coreLog.getLogger("utilities","getClosestImageId");function c(e,t,n,a){const{direction:c,spacing:d,imageIds:g}=e,{ignoreSpacing:u=!1}=a||{};if(!g?.length)return;const m=c.slice(6,9),h=i.eR.dot(m,n);if(Math.abs(h)<1-s.EPSILON)return;let p,f;if(!u){p=(0,r.A)({direction:c,spacing:d},n)/2}let v=1/0;for(let e=0;e<g.length;e++){const a=g[e],r=o.get("imagePlaneModule",a);if(!r?.imagePositionPatient){l.warn(`Missing imagePositionPatient for imageId: ${a}`);continue}const{imagePositionPatient:s}=r,c=i.eR.create();i.eR.sub(c,t,s);const d=Math.abs(i.eR.dot(c,n));u?d<v&&(v=d,f=a):d<p&&d<v&&(v=d,f=a)}return void 0===f&&l.warn("No imageId found within the specified criteria (half spacing or absolute closest)."),f}},53932:(e,t,n)=>{n.d(t,{T:()=>r});var i=n(3823),o=n(19325),a=n(89131);function r(e){const{imagePlaneModule:t,imagePixelModule:n,voiLUTFunction:r,modality:s,scalingFactor:l,calibration:c}=(0,a.KP)(e);let{rowCosines:d,columnCosines:g}=t;null!=d&&null!=g||(d=[1,0,0],g=[0,1,0]);const u=i.eR.fromValues(d[0],d[1],d[2]),m=i.eR.fromValues(g[0],g[1],g[2]),h=i.eR.create();i.eR.cross(h,u,m);let p=t.imagePositionPatient;null==p&&(p=[0,0,0]);const f=t.columnPixelSpacing||e.columnPixelSpacing,v=t.rowPixelSpacing||e.rowPixelSpacing,w=e.columns,I=e.rows,A=o.EPSILON;n.photometricInterpretation||e.sizeInBytes!==3*e.width*e.height||(e.numberOfComponents=3);return{numberOfComponents:e.numberOfComponents||function(e){let t=1;("RGB"===e||e?.includes("YBR")||"PALETTE COLOR"===e)&&(t=3);return t}(n.photometricInterpretation),origin:p,direction:[...u,...m,...h],dimensions:[w,I,1],spacing:[f,v,A],numVoxels:w*I*1,imagePlaneModule:t,imagePixelModule:n,bitsAllocated:n.bitsAllocated,voiLUTFunction:r,modality:s,scalingFactor:l,calibration:c,scanAxisNormal:h}}},47476:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(20537),o=n(65292);const a=function(e){const t=e.getCamera(),{spacingInNormalDirection:n,imageVolume:a}=(0,o.A)(e,t);if(!a)return;const{viewPlaneNormal:r,focalPoint:s}=t,l=e.getActors().find(e=>e.referencedId===a.volumeId||e.uid===a.volumeId);l||console.warn("No actor found for with actorUID of",a.volumeId);const c=l.actor,d=(0,i.A)(c,r,s),{min:g,max:u,current:m}=d,h=Math.round((u-g)/n)+1;let p=(m-g)/(u-g)*h;return p=Math.floor(p),p>h-1?p=h-1:p<0&&(p=0),{numberOfSlices:h,imageIndex:p}}},32173:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(74876);function o(e){const t=i.get("modalityLutModule",e)||{},n=i.get("generalSeriesModule",e)||{},{modality:o}=n,a={rescaleSlope:t.rescaleSlope||1,rescaleIntercept:t.rescaleIntercept??0,modality:o},r=i.get("scalingModule",e)||{};return{...a,..."PT"===o&&{suvbw:r.suvbw,suvbsa:r.suvbsa,suvlbm:r.suvlbm},..."RTDOSE"===o&&{doseGridScaling:r.DoseGridScaling,doseSummation:r.DoseSummation,doseType:r.DoseType,doseUnit:r.DoseUnit}}}},20537:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(89265),o=n(15105),a=n(19325);const r=a.EPSILON*a.EPSILON,s=e=>Math.abs(Math.abs(e)-1)<r,l=(e,t)=>s(e[t])||s(e[t+1])||s(e[t+2]),c=e=>l(e,0)&&l(e,3)&&l(e,6);function d(e,t,n){const a=e.getMapper().getInputData();let r;const s=a.getDirection();if(c(s))r=(0,o.A)(e);else{const[e,t,n]=a.getDimensions();r=[[0,0,0],[e-1,0,0],[0,t-1,0],[e-1,t-1,0],[0,0,n-1],[e-1,0,n-1],[0,t-1,n-1],[e-1,t-1,n-1]].map(e=>a.indexToWorld(e))}const l=i.A.buildFromDegree().identity().rotateFromDirections(t,[1,0,0]);r.forEach(e=>l.apply(e));const d=[...n];l.apply(d);const g=d[0];let u=1/0,m=-1/0;for(let e=0;e<8;e++){const t=r[e][0];t>m&&(m=t),t<u&&(u=t)}return{min:u,max:m,current:g,actor:e,viewPlaneNormal:t,focalPoint:n}}},85008:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(3823);function o(e,t){const{direction:n,spacing:o}=e,a=n.slice(0,3),r=n.slice(3,6),s=n.slice(6,9),l=[i.eR.dot(a,t),i.eR.dot(r,t),i.eR.dot(s,t)],c=i.eR.create();i.eR.set(c,l[0]*o[0],l[1]*o[1],l[2]*o[2]);return i.eR.length(c)}},65292:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(49038),o=n(19325),a=n(85008),r=n(87142),s=n(12437);const l=1+o.EPSILON,c=e=>!!(0,r.getVolumeLoaderSchemes)().find(t=>{return n=e.volumeId,(i=t)===n.substring(0,Math.min(n.length,i.length));var n,i});function d(e,t,n,o=!1){const{viewPlaneNormal:a}=t,r=e.getActors();if(!r.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const d=r.map(e=>{const t=e.referencedId??e.uid;return i.Ay.getVolume(t)}).filter(e=>!!e);if(n){const t=(0,s.A)(n),i=d.findIndex(e=>t.includes(e.volumeId)),l=d[i],{uid:c}=r[i];return{imageVolume:l,spacingInNormalDirection:g(l,a,e,o),actorUID:c}}if(!d.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const u={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},m=d.find(c);for(let t=0;t<d.length;t++){const n=d[t];if(m&&!c(n))continue;const i=g(n,a,e);i*l<u.spacingInNormalDirection&&(u.spacingInNormalDirection=i,u.imageVolume=n,u.actorUID=r[t].uid)}return u}function g(e,t,n,i=!1){const{slabThickness:o}=n.getProperties();let r=o;return o&&i||(r=(0,a.A)(e,t)),r}},24724:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(39536);const o=function(e){const t=(0,i.qO)(),n=[];return t.forEach(t=>{const i=t.getVolumeViewports().filter(t=>t.hasVolumeId(e));n.push(...i)}),n}},70210:(e,t,n)=>{function i(e){let t=[];const[n,i]=e.getRange();e.getTable(n,i,1024,t),t=t.filter((e,t)=>t%3==0);const o=[...Array(1024).keys()].map((e,t)=>n+(i-n)/1023*t),a=t[256],r=Math.log((1-a)/a),s=o[256],l=t[768],c=Math.log((1-l)/l),d=o[768],g=Math.round(4*(d-s)/(r-c)),u=Math.round(s+g*r/4);return[Math.round(u-g/2),Math.round(u+g/2)]}n.d(t,{A:()=>i})},15105:(e,t,n)=>{function i(e){const t=e.getMapper().getInputData(),n=t.extentToBounds(t.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}n.d(t,{A:()=>i})},12437:(e,t,n)=>{n.d(t,{A:()=>i});const i=e=>{const t="volumeId:",n=e.includes(t)?e.substring(9):e,i=n.indexOf("sliceIndex=");return-1===i?n:n.substring(0,i-1)}},4031:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(20537),o=n(65292);const a=function(e,t,n=!1){const a=e.getCamera(),{focalPoint:r,viewPlaneNormal:s}=a,{spacingInNormalDirection:l,actorUID:c}=(0,o.A)(e,a,t,n);if(!c)throw new Error(`Could not find image volume with id ${t} in the viewport`);const d=e.getActor(c);if(!d)return console.warn("No actor found for with actorUID of",c),null;const g=d.actor;return{sliceRange:(0,i.A)(g,s,r),spacingInNormalDirection:l,camera:a}}},61375:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(4031);const o=function(e,t,n=!1){const{sliceRange:o,spacingInNormalDirection:a,camera:r}=(0,i.A)(e,t,n),{min:s,max:l,current:c}=o,d=Math.round((l-s)/a),g=(c-s)/(l-s)*d;return{numScrollSteps:d,currentStepIndex:Math.round(g),sliceRangeInfo:{sliceRange:o,spacingInNormalDirection:a,camera:r}}}},30169:(e,t,n)=>{n.d(t,{a:()=>i});const i=e=>Object.values(e).some(e=>"number"==typeof e&&!Number.isInteger(e))},38883:(e,t,n)=>{function i(e){return Array.isArray(e)?e.some(e=>Number.isNaN(e)):Number.isNaN(e)}n.d(t,{A:()=>i})},39537:(e,t,n)=>{function i(e){const t=e.indexOf(":");return e.substring(t+1)}n.d(t,{A:()=>i})},17791:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(74876);const o=new Map,a="imageRetrieveConfiguration",r={IMAGE_RETRIEVE_CONFIGURATION:a,clear:()=>{o.clear()},add:(e,t)=>{o.set(e,t)},clone:()=>new Map(o),restore:e=>{o.clear(),e.forEach((e,t)=>{o.set(t,e)})},get:(e,...t)=>{if(e===a)return t.map(e=>o.get(e)).find(e=>void 0!==e)}};(0,i.addProvider)(r.get.bind(r));const s=r},10297:(e,t,n)=>{n.r(t),n.d(t,{FrameRange:()=>mt.A,HistoryMemo:()=>o,PointsManager:()=>Re.A,ProgressiveIterator:()=>Ne.A,RLEVoxelMap:()=>Ze.A,VoxelManager:()=>Ke.A,actorIsA:()=>de.N,applyPreset:()=>ye.A,autoLoad:()=>Mt.A,buildMetadata:()=>ft.KP,calculateNeighborhoodStats:()=>Ut,calculateSpacingBetweenImageIds:()=>Vt.A,calculateViewportsSpatialRegistration:()=>Ie,calibratedPixelSpacingMetadataProvider:()=>R,clamp:()=>x.A,clip:()=>Dt,color:()=>r,colormap:()=>st,convertStackToVolumeViewport:()=>ze,convertToGrayscale:()=>Qe,convertVolumeToStackViewport:()=>$e,createLinearRGBTransferFunction:()=>u.A,createSigmoidRGBTransferFunction:()=>d.A,createSubVolume:()=>_t,decimate:()=>Ue.A,deepClone:()=>Pt.G,deepEqual:()=>ut,deepMerge:()=>xe.A,eventListener:()=>i,fnv1aHash:()=>ht.A,generateVolumePropsFromImageIds:()=>Ge.D,genericMetadataProvider:()=>Le.A,getBufferConfiguration:()=>We.h,getClosestImageId:()=>E.A,getClosestStackImageIndexForPoint:()=>me,getCurrentVolumeViewportSlice:()=>pe,getDynamicVolumeInfo:()=>xt,getImageDataMetadata:()=>pt.T,getImageLegacy:()=>Ce,getImageSliceDataForVolumeViewport:()=>ce.A,getMinMax:()=>f,getPixelSpacingInformation:()=>Bt,getRandomSampleFromArray:()=>tt,getRuntimeId:()=>S,getScalingParameters:()=>Me.A,getSliceRange:()=>se.A,getSpacingInNormalDirection:()=>P.A,getTargetVolumeAndSpacingInNormalDir:()=>C.A,getViewportImageCornersInWorld:()=>Ae,getViewportImageIds:()=>et,getViewportModality:()=>Ft,getViewportsWithImageURI:()=>ge,getViewportsWithVolumeId:()=>O.A,getVoiFromSigmoidRGBTransferFunction:()=>g.A,getVolumeActorCorners:()=>D.A,getVolumeDirectionVectors:()=>Ot,getVolumeId:()=>it.A,getVolumeSliceRangeInfo:()=>ae.A,getVolumeViewportScrollInfo:()=>re.A,getVolumeViewportsContainingSameVolumes:()=>_,hasFloatScalingParameters:()=>ot.a,hasNaNValues:()=>be.A,imageIdToURI:()=>b.A,imageRetrieveMetadataProvider:()=>ke.A,imageToWorldCoords:()=>oe,indexWithinDimensions:()=>T,invertRgbTransferFunction:()=>c.A,isEqual:()=>_e.n4,isEqualAbs:()=>_e.Ph,isEqualNegative:()=>_e.WC,isImageActor:()=>de.e,isNumber:()=>_e.Et,isOpposite:()=>M,isPTPrescaledWithSUV:()=>q,isValidVolume:()=>Oe,isVideoTransferSyntax:()=>Fe,jumpToSlice:()=>Lt,loadImageToCanvas:()=>J,logger:()=>Nt,makeVolumeMetadata:()=>Te.A,planar:()=>ue,pointInShapeCallback:()=>at.ii,renderToCanvasCPU:()=>Z,renderToCanvasGPU:()=>z,roundNumber:()=>Xe,roundToPrecision:()=>Je,scaleArray:()=>Et,scaleRgbTransferFunction:()=>m,scroll:()=>Tt,snapFocalPointToSlice:()=>le.A,sortImageIdsAndGetSpacing:()=>De.A,spatialRegistrationMetadataProvider:()=>we,splitImageIdsBy4DTags:()=>Rt,transferFunctionUtils:()=>lt,transformIndexToWorld:()=>N.A,transformWorldToIndex:()=>V.A,transformWorldToIndexContinuous:()=>V.p,triggerEvent:()=>h.A,updateVTKImageDataWithCornerstoneImage:()=>Ve.J,uuidv4:()=>p.A,windowLevel:()=>rt,worldToImageCoords:()=>ie});var i={};n.r(i),n.d(i,{MultiTargetEventListenerManager:()=>l,TargetEventListeners:()=>s});var o={};n.r(o),n.d(o,{DefaultHistoryMemo:()=>ne,HistoryMemo:()=>te});var a,r={};n.r(r),n.d(r,{hexToRgb:()=>gt,rgbToHex:()=>dt}),function(e){e[e.None=0]="None",e[e.Capture=1]="Capture",e[e.Bubble=2]="Bubble"}(a||(a={}));class s{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return 0===this._eventListeners.size&&0===this._children.size}addEventListener(e,t,n){const i=e.indexOf(".");if(-1!==i){const o=e.substring(0,i);let a=this._children.get(o);a||(a=new s(this._target),this._children.set(o,a)),e=e.substring(i+1),a.addEventListener(e,t,n)}else this._addEventListener(e,t,n)}removeEventListener(e,t,n){const i=e.indexOf(".");if(-1!==i){const o=e.substring(0,i),a=this._children.get(o);if(!a)return;e=e.substring(i+1),a.removeEventListener(e,t,n),a.isEmpty&&this._children.delete(o)}else this._removeEventListener(e,t,n)}reset(){Array.from(this._children.entries()).forEach(([e,t])=>{if(t.reset(),!t.isEmpty)throw new Error("Child is not empty and cannot be removed");this._children.delete(e)}),this._unregisterAllEvents()}_addEventListener(e,t,n){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const o=n?.capture??!1?a.Capture:a.Bubble,r=i.get(t)??a.None;r&o?console.warn("A listener is already registered for this phase"):(i.set(t,r|o),this._target.addEventListener(e,t,n))}_removeEventListener(e,t,n){const i=n?.capture??!1?a.Capture:a.Bubble,o=this._eventListeners.get(e);if(!o)return;(t?[t]:Array.from(o.keys())).forEach(t=>{const r=o.get(t)??a.None;if(!!!(r&i))return;this._target.removeEventListener(e,t,n);const s=r^i;s===a.None?o.delete(t):o.set(t,s)}),o.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,t){Array.from(t.entries()).forEach(([t,n])=>{for(let i=a.Capture;n;i<<=1){if(!(n&i))continue;const o=i===a.Capture;this.removeEventListener(e,t,{capture:o}),n^=i}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,t])=>{this._unregisterAllListeners(e,t)})}}class l{constructor(){this._targetsEventListeners=new Map}addEventListener(e,t,n,i){let o=this._targetsEventListeners.get(e);o||(o=new s(e),this._targetsEventListeners.set(e,o)),o.addEventListener(t,n,i)}removeEventListener(e,t,n,i){const o=this._targetsEventListeners.get(e);o&&(o.removeEventListener(t,n,i),o.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,t])=>{t.reset(),this._targetsEventListeners.delete(e)})}}var c=n(50134),d=n(40256),g=n(70210),u=n(74657);function m(e,t){const n=e.getSize();for(let i=0;i<n;i++){const n=[];e.getNodeValue(i,n),n[1]=n[1]*t,n[2]=n[2]*t,n[3]=n[3]*t,e.setNodeValue(i,n)}}var h=n(69372),p=n(80221);function f(e){let t,n=e[0],i=e[0];const o=e.length;for(let a=1;a<o;a++)t=e[a],n=Math.min(n,t),i=Math.max(i,t);return{min:n,max:i}}const v=Symbol("LastRuntimeId"),w={},I=4294967295,A="-";function S(e,t,n){return function(e,t,n){let i=e[t];i instanceof Array||(i=[0],Object.defineProperty(e,t,{value:i}));for(let e=!0,t=0;e&&t<i.length;++t){let o=0|i[t];o<n?(e=!1,o+=1):(o=0,t+1===i.length&&i.push(0)),i[t]=o}return i}(null!==e&&"object"==typeof e?e:w,v,("number"==typeof n&&n>0?n:I)>>>0).join("string"==typeof t?t:A)}var b=n(39537);const y={},R={add:(e,t)=>{const n=(0,b.A)(e);y[n]=t},get:(e,t)=>{if("calibratedPixelSpacing"===e){const e=(0,b.A)(t);return y[e]}}};var x=n(84061);function M(e,t,n=1e-5){return Math.abs(e[0]+t[0])<n&&Math.abs(e[1]+t[1])<n&&Math.abs(e[2]+t[2])<n}var E=n(88619),P=n(85008),C=n(65292),D=n(15105);function T(e,t){return!(e[0]<0||e[0]>=t[0]||e[1]<0||e[1]>=t[1]||e[2]<0||e[2]>=t[2])}var L=n(39536);const _=function(e,t){let n;n=t?[(0,L.lD)(t)]:(0,L.qO)();const i=[];return n.forEach(t=>{const n=e.getActors(),o=t.getVolumeViewports();for(const e of o){const t=e.getActors();if(t.length!==n.length)continue;n.every(({uid:e})=>t.find(t=>e===t.uid))&&i.push(e)}}),i};var O=n(24724),V=n(38669),N=n(94741),U=n(80068),k=n(74876),B=n(71851),F=n(51159),W=n(3823),G=n(30135),j=n(56706);const q=e=>e.preScale.scaled&&e.preScale.scalingParameters.suvbw;function z(e,t,n=void 0,i="_thumbnails",o={displayArea:{imageArea:[1,1]}}){if(!(e&&e instanceof HTMLCanvasElement))throw new Error("canvas element is required");const a=!t.imageId,r=!a&&t,s=a&&t,l=`renderGPUViewport-${r.imageId||s.volumeId}`,c=document.createElement("div"),d=window.devicePixelRatio||1;o.displayArea||(o.displayArea={imageArea:[1,1]});const g=e.width,u=e.height;c.style.width=`${g/d+G.p8}px`,c.style.height=`${u/d+G.p8}px`,c.style.visibility="hidden",c.style.position="absolute",document.body.appendChild(c);const m=l.split(":").join("-");c.setAttribute("viewport-id-for-remove",m);const h=(0,G.Ay)(c),p=(0,L.lD)(i)||new j.Ay(i);let f=p.getViewport(l);if(!f){const e={viewportId:l,type:a?B.ViewportType.ORTHOGRAPHIC:B.ViewportType.STACK,element:c,defaultOptions:{...o,suppressEvents:!0}};p.enableElement(e),f=p.getViewport(l)}return new Promise(i=>{let g=!1,{viewReference:u}=o;const v=t=>{if(g)return;if(u){const e=u;return u=null,f.setViewReference(e),void f.render()}e.getContext("2d").drawImage(h,0,0,h.width,h.height,0,0,e.width,e.height);const n=f.canvasToWorld([0,0]),o=f.canvasToWorld([h.width/d,0]),a=f.canvasToWorld([0,h.height/d]),r=W.eR.sub([0,0,0],f.canvasToWorld([1/d,0]),n),s=W.eR.sub([0,0,0],f.canvasToWorld([0,1/d]),n);g=!0,c.removeEventListener(B.Events.IMAGE_RENDERED,v),setTimeout(()=>{p.disableElement(l);document.querySelectorAll(`[viewport-id-for-remove="${m}"]`).forEach(e=>{e.remove()})},0),i({origin:n,bottomLeft:a,topRight:o,thicknessMm:1,rightVector:r,downVector:s})};c.addEventListener(B.Events.IMAGE_RENDERED,v),a?f.setVolumes([s],!1,!0):f.renderImageObject(t),f.resetCamera(),"PT"!==n||q(r)||f.setProperties({voiRange:{lower:r.minPixelValue,upper:r.maxPixelValue}}),f.render()})}var H=n(36931),$=n(7808),K=n(5057);function Z(e,t,n,i,o){if(t.volumeId)throw new Error("Unsupported volume rendering for CPU");const a=t,r={canvas:e,viewport:(0,H.A)(e,a,n),image:a,renderingTools:{}};r.transform=(0,$.A)(r);return new Promise((e,t)=>{(0,K.A)(r,true),e(null)})}var Y=n(49038);function J(e){const{canvas:t,imageId:n,viewReference:i,requestType:o=B.RequestType.Thumbnail,priority:a=-5,renderingEngineId:r="_thumbnails",useCPURendering:s=!1,thumbnail:l=!1,imageAspect:c=!1,viewportOptions:d}=e,g=i?.volumeId,u=g&&!n,m=i&&d?{...d,viewReference:i}:d,h=s?Z:z;return new Promise((e,i)=>{function d(n,o){const{modality:a}=k.get("generalSeriesModule",o)||{},d=!u&&n,g=u&&n;d&&(d.isPreScaled=d.isPreScaled||d.preScale?.scaled),l&&(t.height=256,t.width=256),c&&d&&(t.width=d&&t.height*d.width/d.height),t.style.width=t.width/devicePixelRatio+"px",t.style.height=t.height/devicePixelRatio+"px",g&&s&&i(new Error("CPU rendering of volume not supported")),h(t,n,a,r,m).then(e)}function p(e,t){console.error(e,t),i(e)}const f={useRGBA:!!s,requestType:o};if(g){const e=Y.Ay.getVolume(g);e||i(new Error(`Volume id ${g} not found in cache`));d(e,e.imageIds[0])}else F.A.addRequest(function(e,t,n){return(0,U.loadAndCacheImage)(e,n).then(t=>{d.call(this,t,e)},t=>{p.call(this,t,e)})}.bind(null,n,null,f),o,{imageId:n},a)})}var X=n(10364);const Q="CORNERSTONE_TOOLS_HISTORY_UNDO",ee="CORNERSTONE_TOOLS_HISTORY_REDO";class te{constructor(e="Tools",t=50){this.position=-1,this.redoAvailable=0,this.undoAvailable=0,this.ring=new Array,this.label=e,this._size=t}get size(){return this._size}set size(e){this.ring=new Array(e),this._size=e,this.position=-1,this.redoAvailable=0,this.undoAvailable=0}undo(e=1){for(;e>0&&this.undoAvailable>0;){const t=this.ring[this.position];t.restoreMemo(!0),t.id&&X.A.dispatchEvent(new CustomEvent(Q,{detail:{isUndo:!0,id:t.id,operationType:t.operationType||"annotation",memo:t}})),e--,this.redoAvailable++,this.undoAvailable--,this.position=(this.position-1+this.size)%this.size}}undoIf(e){return!!(this.undoAvailable>0&&e(this.ring[this.position]))&&(this.undo(),!0)}redo(e=1){for(;e>0&&this.redoAvailable>0;){const t=(this.position+1)%this.size,n=this.ring[t];n.restoreMemo(!1),n.id&&X.A.dispatchEvent(new CustomEvent(ee,{detail:{isUndo:!1,id:n.id,operationType:n.operationType||"annotation",memo:n}})),e--,this.position=t,this.undoAvailable++,this.redoAvailable--}}push(e){if(!e)return;const t=e.restoreMemo?e:e.createMemo?.();return t?(this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=t,t):void 0}}const ne=new te;const ie=function(e,t){const n=(0,k.get)("imagePlaneModule",e);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${e}`);const{columnCosines:i,rowCosines:o,imagePositionPatient:a}=n;let{columnPixelSpacing:r,rowPixelSpacing:s}=n;r||=1,s||=1;const l=W.eR.create();W.eR.scaleAndAdd(l,a,i,-r/2),W.eR.scaleAndAdd(l,l,o,-s/2);const c=W.eR.create();return W.eR.sub(c,t,l),[W.eR.dot(c,o)/s,W.eR.dot(c,i)/r]};function oe(e,t){const n=(0,k.get)("imagePlaneModule",e);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${e}`);const{columnCosines:i,rowCosines:o,imagePositionPatient:a}=n;let{columnPixelSpacing:r,rowPixelSpacing:s}=n;r||=1,s||=1;const l=W.eR.create();return W.eR.scaleAndAdd(l,a,o,s*(t[0]-.5)),W.eR.scaleAndAdd(l,l,i,r*(t[1]-.5)),Array.from(l)}var ae=n(4031),re=n(61375),se=n(20537),le=n(80500),ce=n(47476),de=n(98039);function ge(e){const t=(0,L.qO)(),n=[];return t.forEach(t=>{t.getViewports().forEach(t=>{t.hasImageURI(e)&&n.push(t)})}),n}var ue=n(52268);function me(e,t){const n=function(e,t){const n=t.getImageIds(),i=t.getCurrentImageIdIndex();if(0===n.length)return null;const o=t=>{const n=function(e){const t=k.get("imagePlaneModule",e);if(!(t&&t.rowCosines instanceof Array&&3===t.rowCosines.length&&t.columnCosines instanceof Array&&3===t.columnCosines.length&&t.imagePositionPatient instanceof Array&&3===t.imagePositionPatient.length))return null;const{rowCosines:n,columnCosines:i,imagePositionPatient:o}=t,a=W.eR.set(W.eR.create(),...n),r=W.eR.set(W.eR.create(),...i),s=W.eR.cross(W.eR.create(),a,r);return{rowCosines:n,columnCosines:i,imagePositionPatient:o,planeNormal:s}}(t);if(!n)return null;const i=ue.planeEquation(n.planeNormal,n.imagePositionPatient);return ue.planeDistanceToPoint(i,e)},a={distance:o(n[i])??1/0,index:i},r=n.slice(i+1);for(let e=0;e<r.length;e++){const t=o(r[e]);if(null!==t){if(!(t<=a.distance))break;a.distance=t,a.index=e+i+1}}const s=n.slice(0,i);for(let e=s.length-1;e>=0;e--){const t=o(s[e]);if(null!==t&&t!==a.distance){if(!(t<a.distance))break;a.distance=t,a.index=e}}return a.distance===1/0?null:a}(e,t);return n?n.index:null}var he=n(51919);function pe(e){const{width:t,height:n}=e.getCanvas(),{sliceToIndexMatrix:i,indexToSliceMatrix:o}=e.getSliceViewInfo(),a=(0,he.e)(e,[0,0]),r=(0,he.e)(e,[t-1,0]),s=(0,he.e)(e,[0,n-1]),l=W.eR.sub(W.eR.create(),r,a),c=W.eR.sub(W.eR.create(),s,a),d=W.eR.cross(W.eR.create(),l,c);W.eR.normalize(l,l),W.eR.normalize(c,c),W.eR.normalize(d,d);const g=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2])),u=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2]));if(!W.Fd.equals(1,g)||!W.Fd.equals(1,u))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:m}=e.getImageData(),h=e.getSliceViewInfo(),p=m.getSliceData(h);return{width:h.width,height:h.height,scalarData:p,sliceToIndexMatrix:i,indexToSliceMatrix:o}}const fe={},ve={add:(e,t)=>{const[n,i]=e,o=`${n}_${i}`;fe[o]||(fe[o]={}),fe[o]=t},get:(e,t,n)=>{if("spatialRegistrationModule"!==e)return;const i=`${t}_${n}`;if(fe[i])return fe[i];const o=`${n}_${t}`;return fe[o]?W.pB.invert(W.pB.create(),fe[o]):void 0}};(0,k.addProvider)(ve.get.bind(ve));const we=ve;const Ie=function(e,t){const n=e.getSliceIndex(),i=t.getSliceIndex(),o=(0,k.get)("imagePlaneModule",n.toString()),a=(0,k.get)("imagePlaneModule",i.toString());if(!o||!a)return void console.log("Viewport spatial registration requires image plane module");const{imageOrientationPatient:r}=a;if(!o.imageOrientationPatient.every((e,t)=>Math.abs(e-r[t])<.05))return void console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",o?.imageOrientationPatient,a?.imageOrientationPatient);const s=o.imagePositionPatient,l=a.imagePositionPatient,c=W.eR.subtract(W.eR.create(),s,l),d=W.pB.fromTranslation(W.pB.create(),c);we.add([e.id,t.id],d)};function Ae(e){const{imageData:t,dimensions:n}=e.getImageData()||{};if(!t||!n)return[];const{canvas:i}=e,o=window.devicePixelRatio,a=[i.width/o,0],r=[i.width/o,i.height/o],s=[0,i.height/o],l=e.canvasToWorld([0,0]),c=e.canvasToWorld(a),d=e.canvasToWorld(r),g=e.canvasToWorld(s),u=t.worldToIndex(l),m=t.worldToIndex(c),h=t.worldToIndex(d),p=t.worldToIndex(g);return function({dimensions:e,imageData:t,topLeftImage:n,topRightImage:i,bottomRightImage:o,bottomLeftImage:a,topLeftWorld:r,topRightWorld:s,bottomRightWorld:l,bottomLeftWorld:c}){const d=Se(n,e)?r:t.indexToWorld([0,0,0]),g=Se(i,e)?s:t.indexToWorld([e[0]-1,0,0]),u=Se(o,e)?l:t.indexToWorld([e[0]-1,e[1]-1,0]),m=Se(a,e)?c:t.indexToWorld([0,e[1]-1,0]);return[d,g,m,u]}({dimensions:n,imageData:t,topLeftImage:u,topRightImage:m,bottomRightImage:h,bottomLeftImage:p,topLeftWorld:l,topRightWorld:c,bottomRightWorld:d,bottomLeftWorld:g})}function Se(e,t){return e[0]>0||e[0]<t[0]-1||e[1]>0||e[1]<t[1]-1||e[2]>0||e[2]<t[2]-1}var be=n(38883),ye=n(96833),Re=n(13876),xe=n(74268),Me=n(32173),Ee=n(79720),Pe=n(86846);const Ce=function(e){const t=(0,Pe.Ay)(e);if(!t)return;const{viewport:n}=t;if(!(n instanceof Ee.A))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${n.type}`);return n.getCornerstoneImage()};var De=n(90537),Te=n(1865),Le=n(27119),_e=n(74638);function Oe(e){if(e.length<=1)return!1;const t=e[0],{modality:n,seriesInstanceUID:i}=k.get("generalSeriesModule",t),{imageOrientationPatient:o,pixelSpacing:a,frameOfReferenceUID:r,columns:s,rows:l,usingDefaultValues:c}=k.get("imagePlaneModule",t);if(c)return!1;const d={modality:n,imageOrientationPatient:o,pixelSpacing:a,frameOfReferenceUID:r,columns:s,rows:l,seriesInstanceUID:i};let g=!0;for(let t=0;t<e.length;t++){const n=e[t],{modality:i,seriesInstanceUID:o}=k.get("generalSeriesModule",n),{imageOrientationPatient:a,pixelSpacing:r,columns:s,rows:l}=k.get("imagePlaneModule",n);if(o!==d.seriesInstanceUID){g=!1;break}if(i!==d.modality){g=!1;break}if(s!==d.columns){g=!1;break}if(l!==d.rows){g=!1;break}if(!(0,_e.Ay)(a,d.imageOrientationPatient)){g=!1;break}if(!(0,_e.Ay)(r,d.pixelSpacing)){g=!1;break}}return g}var Ve=n(45278),Ne=n(22191),Ue=n(63470),ke=n(17791);const Be=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function Fe(e){if(!e)return!1;return(Array.isArray(e)?e:[e]).find(e=>Be.has(e))}var We=n(99576),Ge=n(9734),je=n(40661),qe=n(87142);async function ze({viewport:e,options:t={}}){const n=e.getRenderingEngine();let i=t.volumeId||`${(0,p.A)()}`;if(0===i.split(":").length){i=`${(0,qe.getUnknownVolumeLoaderSchema)()}:${i}`}const{id:o,element:a}=e,r=t.viewportId||o,s=e.getImageIds(),l=e.getViewPresentation(),c=e.getViewReference();n.enableElement({viewportId:r,type:B.ViewportType.ORTHOGRAPHIC,element:a,defaultOptions:{background:t.background,orientation:t.orientation}});(await(0,qe.createAndCacheVolume)(i,{imageIds:s})).load();const d=n.getViewport(r);await(0,je.A7)(n,[{volumeId:i}],[r]);const g=()=>{d.render(),a.removeEventListener(B.Events.VOLUME_VIEWPORT_NEW_VOLUME,g)};return a.addEventListener(B.Events.VOLUME_VIEWPORT_NEW_VOLUME,g),d.setViewPresentation(l),d.setViewReference(c),d.render(),d}var He=n(86252);async function $e({viewport:e,options:t}){const n=e,{id:i,element:o}=n,a=e.getRenderingEngine(),{background:r}=t,s=t.viewportId||i,l=Y.Ay.getVolume(n.getVolumeId());if(!(l instanceof He.Q))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const c={viewportId:s,type:B.ViewportType.STACK,element:o,defaultOptions:{background:r}},d=n.getViewReference();a.enableElement(c);const g=a.getViewport(s);return await g.setStack(l.imageIds),g.setViewReference(d),g.render(),g}var Ke=n(24623),Ze=n(67645),Ye=n(19325);function Je(e){return Math.round(e/Ye.EPSILON)*Ye.EPSILON}const Xe=function e(t,n=2){if(Array.isArray(t))return t.map(t=>e(t,n)).join(", ");if(null==t||""===t)return"NaN";t=Number(t);const i=Math.abs(t);if(i<1e-4)return`${t}`;const o=i>=100?n-2:i>=10?n-1:i>=1?n:i>=.1?n+1:i>=.01?n+2:i>=.001?n+3:n+4;return t.toFixed(o)};function Qe(e,t,n){const i=e.length===t*n*4,o=e.length===t*n*3;if(i||o){const o=new Float32Array(t*n);let a=0,r=0;const s=i?4:3;for(let i=0;i<t;i++)for(let t=0;t<n;t++){const t=e[a],n=e[a+1],i=e[a+2];o[r]=(t+n+i)/3,a+=s,r++}return o}return e}const et=function(e){if(e instanceof j.PX){return Y.Ay.getVolume(e.getVolumeId()).imageIds}if(e.getImageIds)return e.getImageIds()};function tt(e,t){const n=[...e];return t>=n.length?(nt(n),n):(nt(n),n.slice(0,t))}function nt(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}var it=n(12437),ot=n(30169),at=n(69032),rt=n(68136),st=n(13859),lt=n(85745);function ct(e){const t=e.toString(16);return 1==t.length?"0"+t:t}function dt(e,t,n){return"#"+ct(e)+ct(t)+ct(n)}function gt(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function ut(e,t){if(e===t)return!0;if(null==e||null==t)return!1;try{return JSON.stringify(e)===JSON.stringify(t)}catch(n){return console.debug("Error in JSON.stringify during deep comparison:",n),e===t}}var mt=n(56750),ht=n(20286),pt=n(53932),ft=n(89131);function vt(e,t){const n={};let i=[];const o=Object.keys(e);for(let a=0;a<o.length;a++){const r=new Set,s=e[o[a]];for(let e=0;e<s.length;e++){const i=t(s[e].imageId)||0;if(n[i]=n[i]||[],n[i].push({imageId:s[e].imageId}),r.add(i),r.size-1<e)return}if(0==a)i=Array.from(r);else if(!bt(i,r))return}return n}function wt(e,t){const n=k.get(t,e);try{return parseFloat(n)}catch{return}}function It(e){const t=k.get("20011003",e);try{const{InlineBinary:e}=t;if(e){const t=atob(e),n=new ArrayBuffer(t.length),i=new DataView(n);for(let e=0;e<t.length;e++)i.setUint8(e,t.charCodeAt(e));return new Float32Array(n)[0]}return parseFloat(t)}catch{return}}function At(e){let t=k.get("0019100c",e)||k.get("0019100C",e);try{const{InlineBinary:e}=t;return e&&(t=atob(e)),parseFloat(t)}catch{return}}function St(e){let t=k.get("00431039",e);try{const{InlineBinary:e}=t;return e&&(t=atob(e).split("//")),parseFloat(t[0])%1e5}catch{return}}function bt(e,t){if(e.length!=t.size)return!1;for(let n=0;n<e.length;n++)if(!t.has(e[n]))return!1;return!0}function yt(e){const t=k.get("petImageModule",e);return t?t.frameReferenceTime:0}const Rt=function(e){const t=function(e){const t=e.map(e=>{const{imagePositionPatient:t}=k.get("imagePlaneModule",e)||{};return{imageId:e,imagePositionPatient:t}});if(!t.every(e=>e.imagePositionPatient))return null;const n=(i="imagePositionPatient",t.reduce((e,t)=>((e[t[i]]=e[t[i]]||[]).push(t),e),{}));var i;const o=Object.keys(n),a=n[o[0]].length;return 1===a?null:o.every(e=>n[e].length===a)?n:null}(e);if(!t)return{imageIdGroups:[e],splittingTag:null};const n=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],i=[e=>wt(e,n[0]),e=>wt(e,n[1]),e=>wt(e,n[2]),e=>wt(e,n[3]),e=>wt(e,n[4]),It,At,St,yt];for(let e=0;e<i.length;e++){const o=vt(t,i[e]);if(o){return{imageIdGroups:Object.keys(o).map(Number.parseFloat).sort((e,t)=>e-t).map(e=>o[e].map(e=>e.imageId)),splittingTag:n[e]}}}return{imageIdGroups:[e],splittingTag:null}};const xt=function(e){const{imageIdGroups:t,splittingTag:n}=Rt(e);return{isDynamicVolume:t.length>1,timePoints:t,splittingTag:n}};var Mt=n(91979);function Et(e,t){const n=e.length,{rescaleSlope:i,rescaleIntercept:o,suvbw:a}=t;if("PT"===t.modality&&"number"==typeof a)for(let t=0;t<n;t++)e[t]=a*(e[t]*i+o);else for(let t=0;t<n;t++)e[t]=e[t]*i+o;return e}var Pt=n(99949);function Ct(e,t,n){return Math.min(Math.max(t,e),n)}const Dt=Ct;function Tt(e,t){if(!(0,Pe.Ay)(e.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(e instanceof j.hS&&0===e.getImageIds().length)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:n,delta:i,scrollSlabs:o}=t;if(e instanceof j.PX)!function(e,t,n,i=!1){const o=i,{numScrollSteps:a,currentStepIndex:r,sliceRangeInfo:s}=(0,re.A)(e,t,o);if(!s)return;const{sliceRange:l,spacingInNormalDirection:c,camera:d}=s,{focalPoint:g,viewPlaneNormal:u,position:m}=d,{newFocalPoint:p,newPosition:f}=(0,le.A)(g,m,l,u,c,n);e.setCamera({focalPoint:p,position:f}),e.render();const v=r+n,w={volumeId:t,viewport:e,delta:n,desiredStepIndex:v,currentStepIndex:r,numScrollSteps:a,currentImageId:e.getCurrentImageId()};(v>a||v<0)&&e.getCurrentImageId()?(0,h.A)(X.A,B.Events.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,w):(0,h.A)(X.A,B.Events.VOLUME_VIEWPORT_SCROLL,w)}(e,n,i,o);else{const n=e.getCurrentImageIdIndex();if(n+i>e.getImageIds().length-1||n+i<0){const e={imageIdIndex:n,direction:i};(0,h.A)(X.A,B.Events.STACK_SCROLL_OUT_OF_BOUNDS,e)}e.scroll(i,t.debounceLoading,t.loop)}}async function Lt(e,t={}){const{imageIndex:n,debounceLoading:i,volumeId:o}=t,a=(0,Pe.Ay)(e);if(!a)throw new Error("Element has been disabled");const{viewport:r}=a,{imageIndex:s,numberOfSlices:l}=function(e,t){if(e instanceof Ee.A)return{numberOfSlices:e.getImageIds().length,imageIndex:t?e.getTargetImageIdIndex():e.getCurrentImageIdIndex()};return{numberOfSlices:e.getNumberOfSlices(),imageIndex:e.getSliceIndex()}}(r,i),c=function(e,t){const n=e-1;return Dt(t,0,n)}(l,n);Tt(r,{delta:c-s,debounceLoading:i,volumeId:o})}function _t(e,t,n={}){const i=Y.Ay.getVolume(e);if(!i)throw new Error(`Referenced volume with id ${e} does not exist.`);const{metadata:o,spacing:a,direction:r,dimensions:s}=i,{minX:l,maxX:c,minY:d,maxY:g,minZ:u,maxZ:m}=t,h=[Math.min(l,c),Math.min(d,g),Math.min(u,m)],f=(0,N.A)(i.imageData,h),v=[Math.abs(c-l)+1,Math.abs(g-d)+1,Math.abs(m-u)+1],{targetBuffer:w}=n,I={metadata:o,dimensions:v,spacing:a,origin:f,direction:r,targetBuffer:w,scalarData:"Float32Array"===w?.type?new Float32Array(v[0]*v[1]*v[2]):void 0},A=(0,qe.createLocalVolume)((0,p.A)(),I),S=A.voxelManager.getCompleteScalarDataArray(),b=v[0]*v[1],y=s[0]*s[1],R=i.voxelManager.getCompleteScalarDataArray();for(let e=0;e<v[2];e++)for(let t=0;t<v[1];t++){const n=(0,N.A)(A.imageData,[0,t,e]),o=(0,V.A)(i.imageData,n),a=o[2]*y+o[1]*s[0]+o[0],r=R.slice(a,a+v[0]),l=e*b+t*v[0];S.set(r,l)}return A.voxelManager.setCompleteScalarDataArray(S),A}function Ot(e,t){const{viewUp:n,viewPlaneNormal:i}=t,o=(0,V.p)(e,[0,0,0]),a=W.eR.negate(W.eR.create(),n),r=W.eR.negate(W.eR.create(),i),s=W.eR.cross(W.eR.create(),a,r),l=W.eR.sub(W.eR.create(),(0,V.p)(e,a),o),c=W.eR.sub(W.eR.create(),(0,V.p)(e,r),o);W.eR.normalize(l,l),W.eR.normalize(c,c);return{worldVecRowDir:s,worldVecColDir:a,worldVecSliceDir:r,ijkVecRowDir:W.eR.cross(W.eR.create(),l,c),ijkVecColDir:l,ijkVecSliceDir:c}}var Vt=n(42384),Nt=n(7608);function Ut(e,t,n,i){const[o,a,r]=t,s=o*a;let l=0,c=0,d=0;const[g,u,m]=n.map(Math.round);for(let t=m-i;t<=m+i;t++)if(!(t<0||t>=r))for(let n=u-i;n<=u+i;n++)if(!(n<0||n>=a))for(let a=g-i;a<=g+i;a++){if(a<0||a>=o)continue;const i=e[t*s+n*o+a];l+=i,c+=i*i,d++}if(0===d){const t=m*s+u*o+g;if(t>=0&&t<e.length){return{mean:e[t],stdDev:0,count:1}}return{mean:0,stdDev:0,count:0}}const h=l/d,p=c/d-h*h;return{mean:h,stdDev:Math.sqrt(Math.max(0,p)),count:d}}const kt=new Set(["1.2.840.10008.5.1.4.1.1.1","1.2.840.10008.5.1.4.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.1.1","1.2.840.10008.5.1.4.1.1.1.2","1.2.840.10008.5.1.4.1.1.1.2.1","1.2.840.10008.5.1.4.1.1.1.3","1.2.840.10008.5.1.4.1.1.1.3.1","1.2.840.10008.5.1.4.1.1.12.1","1.2.840.10008.5.1.4.1.1.12.1.1","1.2.840.10008.5.1.4.1.1.12.2","1.2.840.10008.5.1.4.1.1.12.2.1","1.2.840.10008.5.1.4.1.1.12.3"]);function Bt(e){const{PixelSpacing:t,SOPClassUID:n,SequenceOfUltrasoundRegions:i}=e;if(i)return function(e){const{SequenceOfUltrasoundRegions:t}=e,n=Array.isArray(t);if(n&&t.length>1)return void console.warn("Sequence of Ultrasound Regions > one entry. This is not yet implemented, all measurements will be shown in pixels.");const{PhysicalDeltaX:i,PhysicalDeltaY:o}=n?t[0]:t;return{PixelSpacing:[10*i,10*o]}}(e);return kt.has(n)?function(e){const{PixelSpacing:t,ImagerPixelSpacing:n,EstimatedRadiographicMagnificationFactor:i,PixelSpacingCalibrationType:o,PixelSpacingCalibrationDescription:a}=e,r=!0;if(!n)return{PixelSpacing:t,type:B.CalibrationTypes.UNKNOWN,isProjection:r};if(!t)return i?{PixelSpacing:n.map(e=>e/i),type:B.CalibrationTypes.ERMF,isProjection:r}:(console.warn("EstimatedRadiographicMagnificationFactor was not present. Unable to correct ImagerPixelSpacing."),{PixelSpacing:n,type:B.CalibrationTypes.PROJECTION,isProjection:r});return(0,_e.n4)(t,n)?{PixelSpacing:t,type:B.CalibrationTypes.PROJECTION,isProjection:r}:o||a?{PixelSpacing:t,type:B.CalibrationTypes.CALIBRATED,isProjection:r,PixelSpacingCalibrationType:o,PixelSpacingCalibrationDescription:a}:{PixelSpacing:t,type:B.CalibrationTypes.UNKNOWN,isProjection:r}}(e):{PixelSpacing:t,type:B.CalibrationTypes.NOT_APPLICABLE,isProjection:!1}}const Ft=(e,t)=>function(e,t,n){if(!n)throw new Error("getVolume is required, use the utilities export instead ");if(e.modality)return e.modality;if(e.setVolumes){if(!(t=t??e.getVolumeId())||!n)return;return n(t).metadata.Modality}throw new Error("Invalid viewport type")}(e,t,Y.Ay.getVolume)},50134:(e,t,n)=>{function i(e){if(!e)return;const t=e.getSize();for(let n=0;n<t;n++){const t=[];e.getNodeValue(n,t),t[1]=1-t[1],t[2]=1-t[2],t[3]=1-t[3],e.setNodeValue(n,t)}}n.d(t,{A:()=>i})},74638:(e,t,n)=>{function i(e,t,n){return Math.abs(e-t)<=n}function o(e){return"number"==typeof e}function a(e){return e&&"object"==typeof e&&"length"in e&&"number"==typeof e.length&&e.length>0&&"number"==typeof e[0]}function r(e,t,n=1e-5){return typeof e==typeof t&&null!==e&&null!==t&&(o(e)&&o(t)?i(e,t,n):!(!a(e)||!a(t))&&function(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],t[o],n))return!1;return!0}(e,t,n))}n.d(t,{Ay:()=>r,Et:()=>g,Ph:()=>d,WC:()=>c,n4:()=>r});const s=e=>"number"==typeof e?-e:e?.map?e.map(s):!e,l=e=>"number"==typeof e?Math.abs(e):e?.map?e.map(l):e,c=(e,t,n=void 0)=>r(e,s(t),n),d=(e,t,n=void 0)=>r(l(e),l(t),n);function g(e){return Array.isArray(e)?g(e[0]):isFinite(e)&&!isNaN(e)}},7608:(e,t,n)=>{n.r(t),n.d(t,{aiLog:()=>g,coreLog:()=>l,cs3dLog:()=>s,dicomConsistencyLog:()=>m,examplesLog:()=>u,getLogger:()=>r,getRootLogger:()=>a,imageConsistencyLog:()=>h,loaderLog:()=>d,toolsLog:()=>c});var i=n(4367);const o=n.n(i)().noConflict();function a(e){const t=o.getLogger(e[0]);return t.getLogger=(...t)=>a(`${e}.${t.join(".")}`),t}function r(...e){return a(e.join("."))}"undefined"!=typeof window&&(window.log=o);const s=a("cs3d"),l=s.getLogger("core"),c=s.getLogger("tools"),d=s.getLogger("dicomImageLoader"),g=s.getLogger("ai"),u=s.getLogger("examples"),m=r("consistency","dicom"),h=r("consistency","image")},1865:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(74876);function o(e){const t=e[0],{pixelRepresentation:n,bitsAllocated:o,bitsStored:a,highBit:r,photometricInterpretation:s,samplesPerPixel:l}=(0,i.get)("imagePixelModule",t),c=[],d=(0,i.get)("voiLutModule",t);let g;if(d){const{windowWidth:e,windowCenter:t}=d;if(g=d?.voiLUTFunction,Array.isArray(e))for(let n=0;n<e.length;n++)c.push({windowWidth:e[n],windowCenter:t[n]});else c.push({windowWidth:e,windowCenter:t})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:u,seriesInstanceUID:m}=(0,i.get)("generalSeriesModule",t),{imageOrientationPatient:h,pixelSpacing:p,frameOfReferenceUID:f,columns:v,rows:w}=(0,i.get)("imagePlaneModule",t);return{BitsAllocated:o,BitsStored:a,SamplesPerPixel:l,HighBit:r,PhotometricInterpretation:s,PixelRepresentation:n,Modality:u,ImageOrientationPatient:h,PixelSpacing:p,FrameOfReferenceUID:f,Columns:v,Rows:w,voiLut:c,VOILUTFunction:g,SeriesInstanceUID:m}}},52268:(e,t,n)=>{n.r(t),n.d(t,{isPointOnPlane:()=>c,linePlaneIntersection:()=>a,planeDistanceToPoint:()=>l,planeEquation:()=>r,threePlaneIntersection:()=>s});var i=n(3823),o=n(19325);function a(e,t,n){const[i,o,a]=e,[r,s,l]=t,[c,d,g,u]=n,m=r-i,h=s-o,p=l-a,f=-1*(c*i+d*o+g*a-u)/(c*m+d*h+g*p);return[m*f+i,h*f+o,p*f+a]}function r(e,t,n=!1){const[i,o,a]=e,r=i*t[0]+o*t[1]+a*t[2];if(n){const e=Math.sqrt(i*i+o*o+a*a);return[i/e,o/e,a/e,r/e]}return[i,o,a,r]}function s(e,t,n){const[o,a,r,s]=e,[l,c,d,g]=t,[u,m,h,p]=n,f=i.w0.fromValues(o,l,u,a,c,m,r,d,h),v=i.w0.fromValues(s,g,p,a,c,m,r,d,h),w=i.w0.fromValues(o,l,u,s,g,p,r,d,h),I=i.w0.fromValues(o,l,u,a,c,m,s,g,p);return[i.w0.determinant(v)/i.w0.determinant(f),i.w0.determinant(w)/i.w0.determinant(f),i.w0.determinant(I)/i.w0.determinant(f)]}function l(e,t,n=!1){const[i,o,a,r]=e,[s,l,c]=t,d=i*s+o*l+a*c-r,g=Math.abs(d)/Math.sqrt(i*i+o*o+a*a);return(n?Math.sign(d):1)*g}function c(e,t,n=o.EPSILON){return l(t,e)<n}},80500:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(3823);function o(e,t,n,o,a,r){const{min:s,max:l,current:c}=n,d=i.eR.create();i.eR.sub(d,t,e);const g=Math.round((l-s)/a),u=(c-s)/(l-s)*g;let m=Math.round(u),h=[e[0]-o[0]*u*a,e[1]-o[1]*u*a,e[2]-o[2]*u*a];m+=r,m>g?m=g:m<0&&(m=0);const p=m*a;h=[h[0]+o[0]*p,h[1]+o[1]*p,h[2]+o[2]*p];return{newFocalPoint:h,newPosition:[h[0]+d[0],h[1]+d[1],h[2]+d[2]]}}},90537:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(3823),o=n(74876),a=n(42384);function r(e,t){const{imagePositionPatient:n,imageOrientationPatient:r}=o.get("imagePlaneModule",e[0]);if(!t){const e=i.eR.fromValues(r[0],r[1],r[2]),n=i.eR.fromValues(r[3],r[4],r[5]);t=i.eR.create(),i.eR.cross(t,e,n)}const s="wadouri"===e[0].split(":")[0],l=(0,a.A)(e);let c;function d(e){const{imagePositionPatient:a}=o.get("imagePlaneModule",e),r=i.eR.create();return i.eR.sub(r,n,a),i.eR.dot(r,t)}if(s){const t=[e[0],e[Math.floor(e.length/2)]];c=e;d(t[0])-d(t[1])<0&&c.reverse()}else{const t=e.map(e=>({distance:d(e),imageId:e}));t.sort((e,t)=>t.distance-e.distance),c=t.map(e=>e.imageId)}const{imagePositionPatient:g}=o.get("imagePlaneModule",c[0]);return{zSpacing:l,origin:g,sortedImageIds:c}}},85745:(e,t,n)=>{function i(e){const t=e.getSize(),n=[];for(let i=0;i<t;i++){const t=[];e.getNodeValue(i,t),n.push(t)}return n}function o(e,t){t?.length&&(e.removeAllPoints(),t.forEach(t=>{e.addRGBPoint(...t)}))}n.r(t),n.d(t,{getTransferFunctionNodes:()=>i,setTransferFunctionNodes:()=>o})},51919:(e,t,n)=>{n.d(t,{e:()=>o});var i=n(38669);function o(e,t){const{imageData:n}=e.getImageData(),o=e.canvasToWorld(t);return(0,i.A)(n,o)}},94741:(e,t,n)=>{function i(e,t){return e.indexToWorld(t)}n.d(t,{A:()=>i})},38669:(e,t,n)=>{function i(e,t){return e.worldToIndex(t).map(Math.round)}function o(e,t){return e.worldToIndex(t)}n.d(t,{A:()=>i,p:()=>o})},45278:(e,t,n)=>{function i(e,t){const n=t.voxelManager.getScalarData();if(!e.getPointData)return;const i=e.getPointData().getScalars().getData();if(t.color&&t.rgba){const e=new Uint8Array(t.columns*t.rows*3);for(let i=0;i<t.columns*t.rows;i++)e[3*i]=n[4*i],e[3*i+1]=n[4*i+1],e[3*i+2]=n[4*i+2];t.rgba=!1,t.getPixelData=()=>e,i.set(e)}else i.set(n);e.modified()}n.d(t,{J:()=>i})},68136:(e,t,n)=>{n.r(t),n.d(t,{toLowHighRange:()=>r,toWindowLevel:()=>a});var i=n(82501),o=n(58977);function a(e,t){return{windowWidth:Math.abs(t-e)+1,windowCenter:(e+t+1)/2}}function r(e,t,n=i.A.LINEAR){if(n===i.A.LINEAR)return{lower:t-.5-(e-1)/2,upper:t-.5+(e-1)/2};if(n===i.A.LINEAR_EXACT)return{lower:t-e/2,upper:t+e/2};if(n===i.A.SAMPLED_SIGMOID){return{lower:(0,o.i)(.01,t,e),upper:(0,o.i)(.99,t,e)}}throw new Error("Invalid VOI LUT function")}},93952:()=>{},95074:(e,t,n)=>{n(97181),n(85899),n(56442)},74347:(e,t,n)=>{n.d(t,{draw:()=>i.A,drawCircle:()=>o.A,drawHandles:()=>a.A,drawLine:()=>r.A,drawLinkedTextBox:()=>c.A,drawPath:()=>l.A,drawPolyline:()=>s.A,drawRect:()=>d.A,drawRectByCoordinates:()=>g.A});var i=n(18262),o=n(12004),a=(n(85856),n(95074),n(56745)),r=(n(94042),n(92118));var s=n(98812),l=n(17311);n(97181),n(85899),n(56442);var c=n(1595),d=n(97530),g=n(75076);n(26290)},75183:(e,t,n)=>{var i;n.d(t,{A:()=>o}),function(e){e.Interaction="Interaction",e.HandlesUpdated="HandlesUpdated",e.StatsUpdated="StatsUpdated",e.InitialSetup="InitialSetup",e.Completed="Completed",e.InterpolationUpdated="InterpolationUpdated",e.History="History",e.MetadataReferenceModified="MetadataReferenceModified",e.LabelChange="LabelChange"}(i||(i={}));const o=i},10401:(e,t,n)=>{var i;!function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(i||(i={}))},6802:(e,t,n)=>{n.d(t,{O8:()=>i.removeAnnotation,Rh:()=>i.getAnnotations,lC:()=>i.addAnnotation});n(67013),n(2076),n(17343);var i=n(82056);n(97)},59475:(e,t,n)=>{n.d(t,{_6:()=>u});var i=n(15327),o=n(99737),a=n(642),r=n(99341),s=n(49906),l=n(92686),c=n(75419);const d={colorLUT:[],segmentations:[],viewportSegRepresentations:{}};function g(e){const t=a.Ay.newInstance(),n=r.Ay.newInstance();return n.addPoint(0,0),e===o.SegmentationRepresentations.Labelmap?{cfun:t,ofun:n}:{}}const u=new class{constructor(e){this._stackLabelmapImageIdReferenceMap=new Map,this._labelmapImageIdReferenceMap=new Map,e||=i.utilities.uuidv4(),this.state=Object.freeze(i.utilities.deepClone(d)),this.uid=e}getState(){return this.state}updateState(e){const t=i.utilities.deepClone(this.state);e(t),this.state=Object.freeze(t)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this._stackLabelmapImageIdReferenceMap.clear(),this._labelmapImageIdReferenceMap.clear(),this.state=Object.freeze(i.utilities.deepClone(d))}getSegmentation(e){return this.state.segmentations.find(t=>t.segmentationId===e)}updateSegmentation(e,t){this.updateState(n=>{const i=n.segmentations.find(t=>t.segmentationId===e);i?Object.assign(i,t):console.warn(`Segmentation with id ${e} not found. Update aborted.`)}),(0,s.triggerSegmentationModified)(e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.updateState(t=>{const n=i.utilities.deepClone(e);if(n.representationData.Labelmap&&"volumeId"in n.representationData.Labelmap&&!("imageIds"in n.representationData.Labelmap)){const e=this.getLabelmapImageIds(n.representationData);n.representationData.Labelmap.imageIds=e}t.segmentations.push(n)}),(0,c.R)(e.segmentationId)}removeSegmentation(e){this.updateState(t=>{const n=t.segmentations.filter(t=>t.segmentationId!==e);t.segmentations.splice(0,t.segmentations.length,...n)}),(0,s.triggerSegmentationRemoved)(e)}addSegmentationRepresentation(e,t,n,a){if(!(0,i.getEnabledElementByViewportId)(e))return;this.getSegmentationRepresentations(e,{type:n,segmentationId:t}).length>0?console.debug("A segmentation representation of type",n,"already exists in viewport",e,"for segmentation",t):(this.updateState(i=>{i.viewportSegRepresentations[e]||(i.viewportSegRepresentations[e]=[],l.Y.setRenderInactiveSegmentations(e,!0)),n!==o.SegmentationRepresentations.Labelmap?this.addDefaultSegmentationRepresentation(i,e,t,n,a):this.addLabelmapRepresentation(i,e,t,a)}),(0,s.triggerSegmentationRepresentationModified)(e,t,n))}addDefaultSegmentationRepresentation(e,t,n,i,o){const a=e.segmentations.find(e=>e.segmentationId===n);if(!a)return;const r={};Object.keys(a.segments).forEach(e=>{r[Number(e)]={visible:!0}}),e.viewportSegRepresentations[t].push({segmentationId:n,type:i,active:!0,visible:!0,colorLUTIndex:o?.colorLUTIndex||0,segments:r,config:{...g(i),...o}}),this._setActiveSegmentation(e,t,n)}addLabelmapRepresentation(e,t,n,a=g(o.SegmentationRepresentations.Labelmap)){if(!(0,i.getEnabledElementByViewportId)(t))return;const r=this.getSegmentation(n);if(!r)return;const{representationData:s}=r;if(!s.Labelmap)return this.addDefaultSegmentationRepresentation(e,t,n,o.SegmentationRepresentations.Labelmap,a);this.processLabelmapRepresentationAddition(t,n),this.addDefaultSegmentationRepresentation(e,t,n,o.SegmentationRepresentations.Labelmap,a)}async processLabelmapRepresentationAddition(e,t){const n=(0,i.getEnabledElementByViewportId)(e);if(!n)return;const o=this.getSegmentation(t);if(!o)return;const a=n.viewport instanceof i.BaseVolumeViewport,{representationData:r}=o,s="volumeId"in r.Labelmap;n.viewport;a||s||this.updateLabelmapSegmentationImageReferences(e,o.segmentationId)}_updateLabelmapSegmentationReferences(e,t,n,i){const o=t.getCurrentImageId();let a=!1;for(const i of n){t.isReferenceViewable({referencedImageId:i},{asOverlay:!0})&&(a=!0,this._stackLabelmapImageIdReferenceMap.get(e).set(o,i),this._updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:o,labelmapImageId:i}))}return i&&i(t,e,n),a?this._stackLabelmapImageIdReferenceMap.get(e).get(o):void 0}updateLabelmapSegmentationImageReferences(e,t){const n=this.getSegmentation(t);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(t)||this._stackLabelmapImageIdReferenceMap.set(t,new Map);const{representationData:o}=n;if(!o.Labelmap)return;const a=this.getLabelmapImageIds(o),r=(0,i.getEnabledElementByViewportId)(e).viewport;return this._updateLabelmapSegmentationReferences(t,r,a,null)}_updateAllLabelmapSegmentationImageReferences(e,t){const n=this.getSegmentation(t);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(t)||this._stackLabelmapImageIdReferenceMap.set(t,new Map);const{representationData:o}=n;if(!o.Labelmap)return;const a=this.getLabelmapImageIds(o),r=(0,i.getEnabledElementByViewportId)(e).viewport;this._updateLabelmapSegmentationReferences(t,r,a,(e,t,n)=>{e.getImageIds().forEach((i,o)=>{for(const a of n){e.isReferenceViewable({referencedImageId:a,sliceIndex:o},{asOverlay:!0,withNavigation:!0})&&(this._stackLabelmapImageIdReferenceMap.get(t).set(i,a),this._updateLabelmapImageIdReferenceMap({segmentationId:t,referenceImageId:i,labelmapImageId:a}))}})})}getLabelmapImageIds(e){const t=e.Labelmap;let n;if(t.imageIds)n=t.imageIds;else if(!n&&t.volumeId){const e=t.volumeId;n=i.cache.getVolume(e).imageIds}return n}getLabelmapImageIdsForImageId(e,t){const n=this._generateMapKey({segmentationId:t,referenceImageId:e});return this._labelmapImageIdReferenceMap.get(n)}getCurrentLabelmapImageIdsForViewport(e,t){const n=(0,i.getEnabledElementByViewportId)(e);if(!n)return;const o=n.viewport.getCurrentImageId();return this.getLabelmapImageIdsForImageId(o,t)}getCurrentLabelmapImageIdForViewport(e,t){const n=(0,i.getEnabledElementByViewportId)(e);if(!n)return;if(!this._stackLabelmapImageIdReferenceMap.has(t))return;const o=n.viewport.getCurrentImageId();return this._stackLabelmapImageIdReferenceMap.get(t).get(o)}getStackSegmentationImageIdsForViewport(e,t){if(!this.getSegmentation(t))return[];this._updateAllLabelmapSegmentationImageReferences(e,t);const{viewport:n}=(0,i.getEnabledElementByViewportId)(e),o=n.getImageIds(),a=this._stackLabelmapImageIdReferenceMap.get(t);return o.map(e=>a.get(e))}removeSegmentationRepresentationsInternal(e,t){const n=[];return this.updateState(i=>{if(!i.viewportSegRepresentations[e])return;const o=i.viewportSegRepresentations[e];let a=!1;if(!t||Object.values(t).every(e=>void 0===e))n.push(...o),delete i.viewportSegRepresentations[e];else{const{segmentationId:r,type:s}=t;i.viewportSegRepresentations[e]=o.filter(e=>{const t=r&&s&&e.segmentationId===r&&e.type===s||r&&!s&&e.segmentationId===r||!r&&s&&e.type===s;return t&&(n.push(e),e.active&&(a=!0)),!t}),0===i.viewportSegRepresentations[e].length?delete i.viewportSegRepresentations[e]:a&&(i.viewportSegRepresentations[e][0].active=!0)}}),n}removeSegmentationRepresentations(e,t){const n=this.removeSegmentationRepresentationsInternal(e,t);n.forEach(t=>{(0,s.triggerSegmentationRepresentationRemoved)(e,t.segmentationId,t.type)});const i=this.getSegmentationRepresentations(e);return i.length>0&&i[0].active&&(0,s.triggerSegmentationRepresentationModified)(e,i[0].segmentationId,i[0].type),n}removeSegmentationRepresentation(e,t,n){const i=this.removeSegmentationRepresentationsInternal(e,t);return n||i.forEach(({segmentationId:t,type:n})=>{(0,s.triggerSegmentationRepresentationRemoved)(e,t,n)}),i}_updateLabelmapImageIdReferenceMap({segmentationId:e,referenceImageId:t,labelmapImageId:n}){const i=this._generateMapKey({segmentationId:e,referenceImageId:t});if(!this._labelmapImageIdReferenceMap.has(i))return void this._labelmapImageIdReferenceMap.set(i,[n]);const o=this._labelmapImageIdReferenceMap.get(i),a=Array.from(new Set([...o,n]));this._labelmapImageIdReferenceMap.set(i,a)}_setActiveSegmentation(e,t,n){const i=e.viewportSegRepresentations[t];i&&i.forEach(e=>{e.active=e.segmentationId===n})}setActiveSegmentation(e,t){this.updateState(n=>{const i=n.viewportSegRepresentations[e];i&&i.forEach(e=>{e.active=e.segmentationId===t})}),(0,s.triggerSegmentationRepresentationModified)(e,t)}getActiveSegmentation(e){if(!this.state.viewportSegRepresentations[e])return;const t=this.state.viewportSegRepresentations[e].find(e=>e.active);return t?this.getSegmentation(t.segmentationId):void 0}getSegmentationRepresentations(e,t={}){const n=this.state.viewportSegRepresentations[e];return n?t.type||t.segmentationId?n.filter(e=>{const n=!t.type||e.type===t.type,i=!t.segmentationId||e.segmentationId===t.segmentationId;return n&&i}):n:[]}getSegmentationRepresentation(e,t){return this.getSegmentationRepresentations(e,t)[0]}getSegmentationRepresentationVisibility(e,t){const n=this.getSegmentationRepresentation(e,t);return n?.visible}setSegmentationRepresentationVisibility(e,t,n){this.updateState(i=>{const o=this.getSegmentationRepresentations(e,t);o&&o.forEach(e=>{e.visible=n,Object.entries(e.segments).forEach(([e,t])=>{t.visible=n})})}),(0,s.triggerSegmentationRepresentationModified)(e,t.segmentationId,t.type)}addColorLUT(e,t){this.updateState(n=>{n.colorLUT[t]&&console.warn("Color LUT table already exists, overwriting"),n.colorLUT[t]=i.utilities.deepClone(e)})}removeColorLUT(e){this.updateState(t=>{delete t.colorLUT[e]})}_getStackIdForImageIds(e){return e.map(e=>e.slice(-Math.round(.15*e.length))).join("_")}getAllViewportSegmentationRepresentations(){return Object.entries(this.state.viewportSegRepresentations).map(([e,t])=>({viewportId:e,representations:t}))}getSegmentationRepresentationsBySegmentationId(e){const t=[];return Object.entries(this.state.viewportSegRepresentations).forEach(([n,i])=>{const o=i.filter(t=>t.segmentationId===e);o.length>0&&t.push({viewportId:n,representations:o})}),t}_generateMapKey({segmentationId:e,referenceImageId:t}){return`${e}-${t}`}}("DEFAULT")},26228:(e,t,n)=>{n.d(t,{getActiveSegmentation:()=>o});var i=n(67165);n(59475);function o(e){return(0,i.T)(e)}},4714:(e,t,n)=>{n(15327),n(59475),n(70906),n(93952)},30935:(e,t,n)=>{n(59475),n(49906),n(99737),n(15327)},93733:(e,t,n)=>{n.d(t,{getSegmentIndexColor:()=>r,setSegmentIndexColor:()=>s});n(4714);var i=n(50409),o=n(93210),a=n(49906);function r(e,t,n){const a=(0,o.r$)(e,{segmentationId:t});if(!a||0===a.length)return null;const r=a[0],{colorLUTIndex:s}=r,l=(0,i.B)(s);let c=l[n];if(!c){if("number"!=typeof n)return console.warn(`Can't create colour for LUT index ${n}`),null;c=l[n]=[0,0,0,0]}return c}function s(e,t,n,i){const o=r(e,t,n);for(let e=0;e<i.length;e++)o[e]=i[e];(0,a.triggerSegmentationRepresentationModified)(e,t)}},70906:(e,t,n)=>{n(59475)},93210:(e,t,n)=>{n.d(t,{Ut:()=>a,r$:()=>o});var i=n(59475);function o(e,t={}){return i._6.getSegmentationRepresentations(e,t)}function a(e,t){const n=i._6;if(!t.segmentationId||!t.type)throw new Error("getSegmentationRepresentation: No segmentationId or type provided, you need to provide at least one of them");const o=n.getSegmentationRepresentations(e,t);return o?.[0]}},70758:(e,t,n)=>{n(59475)},42568:(e,t,n)=>{n(33283),n(59475)},63427:(e,t,n)=>{n(59475),n(49906),n(53662)},53662:(e,t,n)=>{n(18682),n(684),n(25894),n(93210),n(15327),n(59475),n(67014)},26795:(e,t,n)=>{n.d(t,{getLockedSegmentIndices:()=>o});var i=n(33283);n(49906);function o(e){const t=(0,i.T)(e);if(!t)throw new Error(`No segmentation state found for ${e}`);const{segments:n}=t;return Object.keys(n).filter(e=>n[e].locked).map(e=>parseInt(e))}},98870:(e,t,n)=>{n.d(t,{getCurrentLabelmapImageIdForViewport:()=>i.vl});n(33283),n(70758),n(30935),n(63427),n(53662),n(4714),n(50409),n(70906),n(59475);n(42568),n(58859);var i=n(97577);n(78231);n(93210)},78231:(e,t,n)=>{n(59475)},48145:(e,t,n)=>{n.d(t,{A:()=>o});let i={};const o=i},25072:(e,t,n)=>{var i=n(3823),o=n(15327),a=n(4096),r=n(85817),s=n(27730),l=n(82056),c=n(2076),d=n(29601),g=n(44049),u=n(74347),m=n(85204),h=n(99737),p=n(60810),f=n(93258),v=n(473),w=n(7001),I=n(58640);const{transformWorldToIndex:A}=o.utilities;class S extends r.EC{static{this.toolName="Bidirectional"}constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:b}}){super(e,t),this.isPointNearTool=(e,t,n,i)=>{const a=(0,o.getEnabledElement)(e),{viewport:r}=a,{data:s}=t,{points:l}=s.handles;let c=r.worldToCanvas(l[0]),d=r.worldToCanvas(l[1]),g={start:{x:c[0],y:c[1]},end:{x:d[0],y:d[1]}},u=f.distanceToPoint([g.start.x,g.start.y],[g.end.x,g.end.y],[n[0],n[1]]);return u<=i||(c=r.worldToCanvas(l[2]),d=r.worldToCanvas(l[3]),g={start:{x:c[0],y:c[1]},end:{x:d[0],y:d[1]}},u=f.distanceToPoint([g.start.x,g.start.y],[g.end.x,g.end.y],[n[0],n[1]]),u<=i)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:i}=n;t.highlighted=!0;const a=(0,p.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:a,movingTextBox:!1},this._activateModify(i);const r=(0,o.getEnabledElement)(i),{renderingEngine:s}=r;(0,I.A)(a),(0,w.hideElementCursor)(i),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const i=e.detail,{element:a}=i,r=t.data;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=r.handles.points.findIndex(e=>e===n);const c=(0,p.getViewportIdsWithToolToRender)(a,this.getToolName());(0,w.hideElementCursor)(a),this.editData={annotation:t,viewportIdsToRender:c,handleIndex:s,movingTextBox:l},this._activateModify(a);const d=(0,o.getEnabledElement)(a),{renderingEngine:g}=d;(0,I.A)(c),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:a,viewportIdsToRender:r,newAnnotation:s,hasMoved:c}=this.editData,{data:d}=a;if(s&&!c)return;this.doneEditMemo(),d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,w.resetElementCursor)(n);const{renderingEngine:u}=(0,o.getEnabledElement)(n);if(void 0!==this.editData.handleIndex){const{points:e}=d.handles,t=i.eR.distance(e[0],e[1]);if(i.eR.distance(e[2],e[3])>t){const t=[[...e[2]],[...e[3]]],n=[...e[0]],o=[...e[1]],a=i.Zc.create();i.Zc.set(a,t[1][0]-t[0][0],t[1][1]-t[1][0]);const r=i.Zc.create();i.Zc.set(r,-a[1],a[0]);const s=i.Zc.create();let l;i.Zc.set(s,o[0]-n[0],o[1]-n[0]),l=i.Zc.dot(s,r)>0?[n,o]:[o,n],d.handles.points=[t[0],t[1],l[0],l[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,l.removeAnnotation)(a.annotationUID),(0,I.A)(r),s&&(0,g.triggerAnnotationCompleted)(a),this.editData=null,this.isDrawing=!1},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{currentPoints:n,element:a}=t,r=(0,o.getEnabledElement)(a),{viewport:s}=r,{worldToCanvas:l}=s,{annotation:c,viewportIdsToRender:d,handleIndex:u,newAnnotation:m}=this.editData;this.createMemo(a,c,{newAnnotation:m});const{data:p}=c,f=n.world;p.handles.points[u]=[...f];const v=p.handles.points.map(l),w={start:{x:v[0][0],y:v[0][1]},end:{x:v[1][0],y:v[1][1]}},A=(v[2][0],v[2][1],v[3][0],v[3][1],i.Zc.distance(v[0],v[1])/3),S=w.start.x-w.end.x,b=w.start.y-w.end.y,y=Math.sqrt(S*S+b*b),R=S/y,x=b/y,M=(w.start.x+w.end.x)/2,E=(w.start.y+w.end.y)/2,P=M+A*x,C=E-A*R,D=M-A*x,T=E+A*R;p.handles.points[2]=s.canvasToWorld([P,C]),p.handles.points[3]=s.canvasToWorld([D,T]),c.invalidated=!0,(0,I.A)(d),(0,g.triggerAnnotationModified)(c,a,h.ChangeTypes.HandlesUpdated),this.editData.hasMoved=!0},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:o,handleIndex:a,movingTextBox:r,newAnnotation:s}=this.editData;this.createMemo(n,i,{newAnnotation:s});const{data:l}=i;if(r){const{deltaPoints:e}=t,n=e.world,{textBox:i}=l.handles,{worldPosition:o}=i;o[0]+=n[0],o[1]+=n[1],o[2]+=n[2],i.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach(e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}),i.invalidated=!0}else this._dragModifyHandle(e),i.invalidated=!0;(0,I.A)(o),i.invalidated&&(0,g.triggerAnnotationModified)(i,n,h.ChangeTypes.HandlesUpdated)},this._dragModifyHandle=e=>{const t=e.detail,{currentPoints:n,element:a}=t,r=(0,o.getEnabledElement)(a),{viewport:s}=r,{annotation:l,handleIndex:c}=this.editData,{data:d}=l,g=n.world,u=[s.worldToCanvas(d.handles.points[0]),s.worldToCanvas(d.handles.points[1]),s.worldToCanvas(d.handles.points[2]),s.worldToCanvas(d.handles.points[3])],m={start:{x:u[0][0],y:u[0][1]},end:{x:u[1][0],y:u[1][1]}},h={start:{x:u[2][0],y:u[2][1]},end:{x:u[3][0],y:u[3][1]}},p=[...g],v=s.worldToCanvas(p);if(0===c||1===c){const e=u[0===c?1:0],t=i.Zc.set(i.Zc.create(),v[0]-e[0],v[1]-e[1]),n=i.Zc.set(i.Zc.create(),u[c][0]-e[0],u[c][1]-e[1]);i.Zc.normalize(t,t),i.Zc.normalize(n,n);const o={start:{x:e[0],y:e[1]},end:{x:v[0],y:v[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(o,h))return;const a=e,r=this._getSignedAngle(n,t);let l=u[2][0],g=u[2][1],m=u[3][0],f=u[3][1];l-=a[0],g-=a[1],m-=a[0],f-=a[1];const w=l*Math.cos(r)-g*Math.sin(r),I=l*Math.sin(r)+g*Math.cos(r),A=m*Math.cos(r)-f*Math.sin(r),S=m*Math.sin(r)+f*Math.cos(r);l=w+a[0],g=I+a[1],m=A+a[0],f=S+a[1];const b=s.canvasToWorld([l,g]),y=s.canvasToWorld([m,f]);d.handles.points[c]=p,d.handles.points[2]=b,d.handles.points[3]=y}else{const e=2===c?3:2,t={longLineSegment:{start:m.start,end:m.end},shortLineSegment:{start:h.start,end:h.end}},n=i.Zc.subtract(i.Zc.create(),[t.longLineSegment.end.x,t.longLineSegment.end.y],[t.longLineSegment.start.x,t.longLineSegment.start.y]),o=i.Zc.normalize(i.Zc.create(),n),a=i.Zc.subtract(i.Zc.create(),[v[0],v[1]],[u[c][0],u[c][1]]),r=i.Zc.length(a),l=this._getSignedAngle(o,a),g=Math.cos(l)*r,w=i.Zc.scaleAndAdd(i.Zc.create(),[u[e][0],u[e][1]],o,g);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:v[0],y:v[1]},end:{x:w[0],y:w[1]}},{start:{x:t.longLineSegment.start.x,y:t.longLineSegment.start.y},end:{x:t.longLineSegment.end.x,y:t.longLineSegment.end.y}}))return;if(!f.intersectLine([v[0],v[1]],[w[0],w[1]],[m.start.x,m.start.y],[m.end.x,m.end.y]))return;d.handles.points[e]=s.canvasToWorld(w),d.handles.points[c]=p}},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,w.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:i}=this.editData,{data:o}=t;return t.highlighted=!1,o.handles.activeHandleIndex=null,(0,I.A)(n),i&&(0,g.triggerAnnotationCompleted)(t),this.editData=null,t.annotationUID}},this._activateDraw=e=>{m.wk.isInteractingWithTool=!0,e.addEventListener(h.Events.MOUSE_UP,this._endCallback),e.addEventListener(h.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(h.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(h.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(h.Events.TOUCH_TAP,this._endCallback),e.addEventListener(h.Events.TOUCH_END,this._endCallback),e.addEventListener(h.Events.TOUCH_DRAG,this._dragDrawCallback)},this._deactivateDraw=e=>{m.wk.isInteractingWithTool=!1,e.removeEventListener(h.Events.MOUSE_UP,this._endCallback),e.removeEventListener(h.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(h.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(h.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(h.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(h.Events.TOUCH_END,this._endCallback),e.removeEventListener(h.Events.TOUCH_DRAG,this._dragDrawCallback)},this._activateModify=e=>{m.wk.isInteractingWithTool=!0,e.addEventListener(h.Events.MOUSE_UP,this._endCallback),e.addEventListener(h.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(h.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(h.Events.TOUCH_END,this._endCallback),e.addEventListener(h.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(h.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{m.wk.isInteractingWithTool=!1,e.removeEventListener(h.Events.MOUSE_UP,this._endCallback),e.removeEventListener(h.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(h.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(h.Events.TOUCH_END,this._endCallback),e.removeEventListener(h.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(h.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!0;const{viewport:i}=e,{element:o}=i;let a=(0,l.getAnnotations)(this.getToolName(),o);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(o,a),!a?.length)return n;const r=this.getTargetId(i),s=i.getRenderingEngine(),g={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let o=0;o<a.length;o++){const l=a[o],{annotationUID:m,data:h}=l,{points:p,activeHandleIndex:f}=h.handles,w=p.map(e=>i.worldToCanvas(e));g.annotationUID=m;const{color:I,lineWidth:A,lineDash:S,shadow:b}=this.getAnnotationStyle({annotation:l,styleSpecifier:g});if(h.cachedStats[r]&&null!=h.cachedStats[r].unit?l.invalidated&&this._throttledCalculateCachedStats(l,s,e):(h.cachedStats[r]={length:null,width:null,unit:null},this._calculateCachedStats(l,s,e)),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let y;if(!(0,d.isAnnotationVisible)(m))continue;if((0,c.isAnnotationLocked)(m)||this.editData||null===f||(y=[w[f]]),y){const e="0";(0,u.drawHandles)(t,m,e,y,{color:I})}const R=`${m}-line-1`,x=`${m}-line-2`,M="0";(0,u.drawLine)(t,m,M,w[0],w[1],{color:I,lineDash:S,lineWidth:A,shadow:b},R);const E="1";(0,u.drawLine)(t,m,E,w[2],w[3],{color:I,lineDash:S,lineWidth:A,shadow:b},x),n=!0;const P=this.getLinkedTextBoxStyle(g,l);if(!P.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const C=this.configuration.getTextLines(h,r);if(!C||0===C.length)continue;let D;h.handles.textBox.hasMoved||(D=(0,v.getTextBoxCoordsCanvas)(w),h.handles.textBox.worldPosition=i.canvasToWorld(D));const T=i.worldToCanvas(h.handles.textBox.worldPosition),L="1",_=(0,u.drawLinkedTextBox)(t,m,L,C,T,w,{},P),{x:O,y:V,width:N,height:U}=_;h.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([O,V]),topRight:i.canvasToWorld([O+N,V]),bottomLeft:i.canvasToWorld([O,V+U]),bottomRight:i.canvasToWorld([O+N,V+U])}}return n},this._movingLongAxisWouldPutItThroughShortAxis=(e,t)=>{const n=i.Zc.create();i.Zc.set(n,t.end.x-t.start.x,t.end.y-t.start.y),i.Zc.normalize(n,n);const o={start:{x:t.start.x-10*n[0],y:t.start.y-10*n[1]},end:{x:t.end.x+10*n[0],y:t.end.y+10*n[1]}};return!f.intersectLine([o.start.x,o.start.y],[o.end.x,o.end.y],[e.start.x,e.start.y],[e.end.x,e.end.y])},this._calculateCachedStats=(e,t,n)=>{const{data:i}=e,{element:o}=n.viewport,r=i.handles.points[0],s=i.handles.points[1],l=i.handles.points[2],c=i.handles.points[3],{cachedStats:d}=i,u=Object.keys(d);for(let e=0;e<u.length;e++){const t=u[e],n=this.getTargetImageData(t);if(!n)continue;const{imageData:i,dimensions:o}=n,g=A(i,r),m=A(i,s),h=A(i,l),p=A(i,c),f=[g,m],v=[h,p],{scale:w,unit:I}=(0,a.Op)(n,f),{scale:S,unit:b}=(0,a.Op)(n,v),y=this._calculateLength(r,s)/w,R=this._calculateLength(l,c)/S,x=y>R?y:R,M=y>R?R:y,E=y>R?I:b,P=y>R?b:I;this._isInsideVolume(g,m,h,p,o)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,d[t]={length:x,width:M,unit:E,widthUnit:P}}const m=e.invalidated;return e.invalidated=!1,m&&(0,g.triggerAnnotationModified)(e,o,h.ChangeTypes.StatsUpdated),d},this._isInsideVolume=(e,t,n,i,a)=>o.utilities.indexWithinDimensions(e,a)&&o.utilities.indexWithinDimensions(t,a)&&o.utilities.indexWithinDimensions(n,a)&&o.utilities.indexWithinDimensions(i,a),this._getSignedAngle=(e,t)=>Math.atan2(e[0]*t[1]-e[1]*t[0],e[0]*t[0]+e[1]*t[1]),this._throttledCalculateCachedStats=(0,s.A)(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:i}=t,a=n.world,r=(0,o.getEnabledElement)(i),{viewport:s,renderingEngine:c}=r;this.isDrawing=!0;const d=s.getCamera(),{viewPlaneNormal:g,viewUp:u}=d,m=this.getReferencedImageId(s,a,g,u),h=s.getFrameOfReferenceUID(),f={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...g],viewUp:[...u],FrameOfReferenceUID:h,referencedImageId:m,...s.getViewReference({points:[a]})},data:{handles:{points:[[...a],[...a],[...a],[...a]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};(0,l.addAnnotation)(f,i);const v=(0,p.getViewportIdsWithToolToRender)(i,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:v,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(i),(0,w.hideElementCursor)(i),e.preventDefault(),(0,I.A)(v),f}static{this.hydrate=(e,t,n)=>{const i=(0,o.getEnabledElementByViewportId)(e);if(!i)return;const{FrameOfReferenceUID:a,referencedImageId:r,viewPlaneNormal:s,instance:c,viewport:d}=this.hydrateBase(S,i,t[0],n),[g,u]=t,[m,h]=g,[p,f]=u,v=[m,h,p,f],{toolInstance:w,...A}=n||{},b={annotationUID:n?.annotationUID||o.utilities.uuidv4(),data:{handles:{points:v,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:c.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:a,referencedImageId:r,...A}};return(0,l.addAnnotation)(b,d.element),(0,I.A)([d.id]),b}}_calculateLength(e,t){const n=e[0]-t[0],i=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(n*n+i*i+o*o)}}function b(e,t){const{cachedStats:n,label:i}=e,{length:a,width:r,unit:s}=n[t],l=[];return i&&l.push(i),void 0===a||l.push(`L: ${o.utilities.roundNumber(a)} ${s||s}`,`W: ${o.utilities.roundNumber(r)} ${s}`),l}},48736:(e,t,n)=>{var i=n(15327),o=n(3823),a=n(99737),r=n(17492),s=n(1989),l=n(56789),c=n(33852),d=n(74347),g=n(7001),u=n(58640),m=n(23631),h=n(40905);class p extends m.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE_CIRCLE:l.kr,ERASE_INSIDE_CIRCLE:c.r,FILL_INSIDE_SPHERE:r.Jq,ERASE_INSIDE_SPHERE:s._,THRESHOLD_INSIDE_CIRCLE:l.q,THRESHOLD_INSIDE_SPHERE:r.rd,THRESHOLD_INSIDE_SPHERE_WITH_ISLAND_REMOVAL:r.Sw},defaultStrategy:"FILL_INSIDE_CIRCLE",activeStrategy:"FILL_INSIDE_CIRCLE",brushSize:25,useCenterSegmentIndex:!1,preview:{enabled:!1,previewColors:{0:[255,255,255,128]},previewTimeMs:250,previewMoveDistance:8,dragMoveDistance:4,dragTimeMs:500},actions:{[a.StrategyCallbacks.AcceptPreview]:{method:a.StrategyCallbacks.AcceptPreview,bindings:[{key:"Enter"}]},[a.StrategyCallbacks.RejectPreview]:{method:a.StrategyCallbacks.RejectPreview,bindings:[{key:"Escape"}]},[a.StrategyCallbacks.Interpolate]:{method:a.StrategyCallbacks.Interpolate,bindings:[{key:"i"}],configuration:{useBallStructuringElement:!0,noUseDistanceTransform:!0,noUseExtrapolation:!0}},interpolateExtrapolation:{method:a.StrategyCallbacks.Interpolate,bindings:[{key:"e"}],configuration:{}}}}}){super(e,t),this.onSetToolPassive=e=>{this.disableCursor()},this.onSetToolEnabled=()=>{this.disableCursor()},this.onSetToolDisabled=e=>{this.disableCursor()},this.preMouseDownCallback=e=>{const t=e.detail,{element:n}=t,o=(0,i.getEnabledElement)(n);this._editData=this.createEditData(n),this._activateDraw(n),(0,g.hideElementCursor)(n),e.preventDefault(),this._previewData.isDrag=!1,this._previewData.timerStart=Date.now();const r=this._hoverData||this.createHoverData(n);(0,u.A)(r.viewportIdsToRender);const s=this.getOperationData(n);return this.applyActiveStrategyCallback(o,s,a.StrategyCallbacks.OnInteractionStart),!0},this.mouseMoveCallback=e=>{if(this.mode===a.ToolModes.Active){if(this.updateCursor(e),!this.configuration.preview.enabled)return;const{previewTimeMs:t,previewMoveDistance:n,dragMoveDistance:i}=this.configuration.preview,{currentPoints:a,element:r}=e.detail,{canvas:s}=a,{startPoint:l,timer:c,timerStart:d,isDrag:g}=this._previewData;if(g)return;const u=o.Zc.distance(s,l),m=Date.now()-d;if((u>n||m>t&&u>i)&&(c&&(window.clearTimeout(c),this._previewData.timer=null),g||this.rejectPreview(r)),!this._previewData.timer){const e=window.setTimeout(this.previewCallback,250);Object.assign(this._previewData,{timerStart:Date.now(),timer:e,startPoint:s,element:r})}}},this.previewCallback=()=>{if(this._previewData.isDrag)return void(this._previewData.timer=null);this._previewData.timer=null;const e=this.getOperationData(this._previewData.element),t=(0,i.getEnabledElement)(this._previewData.element);if(!t)return;const{viewport:n}=t,o=this.configuration.activeStrategy,r=(0,h.S)({operationData:e,viewport:n,strategy:o});if(!e)return;const s=this.createMemo(e.segmentationId,r.segmentationVoxelManager);this._previewData.preview=this.applyActiveStrategyCallback((0,i.getEnabledElement)(this._previewData.element),{...e,...r,memo:s},a.StrategyCallbacks.Preview)},this._dragCallback=e=>{const t=e.detail,{element:n,currentPoints:a}=t,r=(0,i.getEnabledElement)(n);this.updateCursor(e);const{viewportIdsToRender:s}=this._hoverData;(0,u.A)(s);const l=o.Zc.distance(a.canvas,this._previewData.startPoint),{dragTimeMs:c,dragMoveDistance:d}=this.configuration.preview;!this._previewData.isDrag&&Date.now()-this._previewData.timerStart<c&&l<d||(this._previewData.timer&&(window.clearTimeout(this._previewData.timer),this._previewData.timer=null),this._previewData.preview=this.applyActiveStrategy(r,this.getOperationData(n)),this._previewData.element=n,this._previewData.timerStart=Date.now()+c,this._previewData.isDrag=!0,this._previewData.startPoint=a.canvas)},this._endCallback=e=>{const t=e.detail,{element:n}=t,o=(0,i.getEnabledElement)(n),r=this.getOperationData(n);this._previewData.preview||this._previewData.isDrag||this.applyActiveStrategy(o,r),this.doneEditMemo(),this._deactivateDraw(n),(0,g.resetElementCursor)(n),this.updateCursor(e),this._editData=null,this.applyActiveStrategyCallback(o,r,a.StrategyCallbacks.OnInteractionEnd),this._previewData.isDrag||this.acceptPreview(n)},this._activateDraw=e=>{e.addEventListener(a.Events.MOUSE_UP,this._endCallback),e.addEventListener(a.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(a.Events.MOUSE_CLICK,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(a.Events.MOUSE_UP,this._endCallback),e.removeEventListener(a.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(a.Events.MOUSE_CLICK,this._endCallback)}}disableCursor(){this._hoverData=void 0,this.rejectPreview()}updateCursor(e){const t=e.detail,{element:n}=t,{currentPoints:i}=t,o=i.canvas;this._hoverData=this.createHoverData(n,o),this._calculateCursor(n,o),this._hoverData&&(0,u.A)(this._hoverData.viewportIdsToRender)}_calculateCursor(e,t){const n=(0,i.getEnabledElement)(e),{viewport:a}=n,{canvasToWorld:r}=a,s=a.getCamera(),{brushSize:l}=this.configuration,c=o.eR.fromValues(s.viewUp[0],s.viewUp[1],s.viewUp[2]),d=o.eR.fromValues(s.viewPlaneNormal[0],s.viewPlaneNormal[1],s.viewPlaneNormal[2]),g=o.eR.create();o.eR.cross(g,c,d);const u=r([t[0],t[1]]),m=o.eR.create(),h=o.eR.create(),p=o.eR.create(),f=o.eR.create();for(let e=0;e<=2;e++)m[e]=u[e]-c[e]*l,h[e]=u[e]+c[e]*l,p[e]=u[e]-g[e]*l,f[e]=u[e]+g[e]*l;if(!this._hoverData)return;const{brushCursor:v}=this._hoverData,{data:w}=v;void 0===w.handles&&(w.handles={}),w.handles.points=[m,h,p,f];const I=this.configuration.activeStrategy,A=this.configuration.strategies[I];"function"==typeof A?.computeInnerCircleRadius&&A.computeInnerCircleRadius({configuration:this.configuration,viewport:a}),w.invalidated=!1}getStatistics(e,t){if(!e)return;const n=(0,i.getEnabledElement)(e);return this.applyActiveStrategyCallback(n,this.getOperationData(e),a.StrategyCallbacks.GetStatistics,t)}rejectPreview(e=this._previewData.element){if(!e)return;this.doneEditMemo();const t=(0,i.getEnabledElement)(e);t&&(this.applyActiveStrategyCallback(t,this.getOperationData(e),a.StrategyCallbacks.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1)}acceptPreview(e=this._previewData.element){e&&super.acceptPreview(e)}interpolate(e,t){if(!e)return;const n=(0,i.getEnabledElement)(e);this._previewData.preview=this.applyActiveStrategyCallback(n,this.getOperationData(e),a.StrategyCallbacks.Interpolate,t.configuration),this._previewData.isDrag=!0}invalidateBrushCursor(){if(void 0===this._hoverData)return;const{data:e}=this._hoverData.brushCursor,{viewport:t}=this._hoverData;e.invalidated=!0;const{segmentColor:n}=this.getActiveSegmentationData(t)||{};this._hoverData.brushCursor.metadata.segmentColor=n}renderAnnotation(e,t){if(!this._hoverData)return;const{viewport:n}=e;if(!this._hoverData.viewportIdsToRender.includes(n.id))return;const i=this._hoverData.brushCursor;if(!0===i.data.invalidated){const{centerCanvas:e}=this._hoverData,{element:t}=n;this._calculateCursor(t,e)}const o=i.metadata;if(!o)return;const a=o.brushCursorUID,r=i.data,{points:s}=r.handles,l=s.map(e=>n.worldToCanvas(e)),c=l[0],g=l[1],u=[Math.floor((c[0]+g[0])/2),Math.floor((c[1]+g[1])/2)],m=Math.abs(c[1]-Math.floor((c[1]+g[1])/2)),h=`rgb(${o.segmentColor?.slice(0,3)||[0,0,0]})`;if(!n.getRenderingEngine())return void console.warn("Rendering Engine has been destroyed");(0,d.drawCircle)(t,a,"0",u,m,{color:h,lineDash:0===this.centerSegmentIndexInfo.segmentIndex?[1,2]:null});const{dynamicRadiusInCanvas:p}=this.configuration?.threshold||{dynamicRadiusInCanvas:0};if(p){const e="1";(0,d.drawCircle)(t,a,e,u,p,{color:h})}}}p.toolName="Brush"},56789:(e,t,n)=>{n.d(t,{kr:()=>v,mu:()=>h,pB:()=>p,q:()=>w});var i=n(3823),o=n(15327),a=n(11683),r=n(72282),s=n(55887),l=n(99737),c=n(11990),d=n(62783);const{transformWorldToIndex:g,isEqual:u}=o.utilities,m={[l.StrategyCallbacks.Initialize]:e=>{const{points:t,viewport:n,segmentationImageData:o}=e;if(!t)return;const s=i.eR.fromValues(0,0,0);t.forEach(e=>{i.eR.add(s,s,e)}),i.eR.scale(s,s,1/t.length),e.centerWorld=s,e.centerIJK=g(o,s);const l=t.map(e=>n.worldToCanvas(e)),[c,d]=(0,a.getCanvasEllipseCorners)(l),u=n.canvasToWorld(c),m=n.canvasToWorld(d),p=t.map(e=>g(o,e)),f=(0,r.getBoundingBoxAroundShapeIJK)(p,o.getDimensions());e.isInObject=h({topLeftWorld:u,bottomRightWorld:m,center:s}),e.isInObjectBoundsIJK=f}};function h(e){const{topLeftWorld:t,bottomRightWorld:n,center:i}=e,o=Math.abs(t[0]-n[0])/2,r=Math.abs(t[1]-n[1])/2,s=Math.abs(t[2]-n[2])/2,l=Math.max(o,r,s);if(u(o,l)&&u(r,l)&&u(s,l)){const e={center:i,radius:l,radius2:l*l};return t=>(0,d.d)(e,t)}const c={center:i,xRadius:o,yRadius:r,zRadius:s},{precalculated:g}=(0,a.precalculatePointInEllipse)(c,{});return g}const p=new s.A("Circle",c.A.regionFill,c.A.setValue,m,c.A.determineSegmentIndex,c.A.preview,c.A.labelmapStatistics),f=new s.A("CircleThreshold",c.A.regionFill,c.A.setValue,m,c.A.determineSegmentIndex,c.A.dynamicThreshold,c.A.threshold,c.A.preview,c.A.islandRemoval,c.A.labelmapStatistics),v=p.strategyFunction,w=f.strategyFunction},10088:(e,t,n)=>{var i=n(3823),o=n(15327),a=n(72282),r=(n(49906),n(40905),n(26384)),s=n(55887),l=n(99737),c=n(11990);const{transformWorldToIndex:d}=o.utilities,g={[l.StrategyCallbacks.Initialize]:e=>{const{points:t,imageVoxelManager:n,viewport:s,segmentationImageData:l,segmentationVoxelManager:c}=e;if(!t)return;const g=i.eR.fromValues(0,0,0);t.forEach(e=>{i.eR.add(g,g,e)}),i.eR.scale(g,g,1/t.length),e.centerWorld=g,e.centerIJK=d(l,g);const{boundsIJK:u,pointInShapeFn:m}=function(e,t,n){let i=t.map(e=>d(n,e));i=i.map(e=>e.map(e=>Math.round(e)));const s=(0,a.getBoundingBoxAroundShapeIJK)(i,n.getDimensions()),l=e instanceof o.StackViewport,c=l||(0,r.l)(i),g=n.getDirection(),u=n.getSpacing(),{viewPlaneNormal:m}=e.getCamera(),h=o.utilities.getSpacingInNormalDirection({direction:g,spacing:u},m),p=(0,a.getBoundingBoxAroundShapeWorld)(t);let[[f,v],[w,I],[A,S]]=p;f-=h,v+=h,w-=h,I+=h,A-=h,S+=h;const b=c?()=>!0:e=>{const[t,n,i]=e;return t>=f&&t<=v&&(n>=w&&n<=I)&&(i>=A&&i<=S)};return{boundsIJK:s,pointInShapeFn:b}}(s,t,l);e.isInObject=m,e.isInObjectBoundsIJK=u}};const u=new s.A("Rectangle",c.A.regionFill,c.A.setValue,g,c.A.determineSegmentIndex,c.A.preview,c.A.labelmapStatistics),m=new s.A("RectangleThreshold",c.A.regionFill,c.A.setValue,g,c.A.determineSegmentIndex,c.A.dynamicThreshold,c.A.threshold,c.A.preview,c.A.islandRemoval,c.A.labelmapStatistics);u.strategyFunction,m.strategyFunction},99522:(e,t,n)=>{n.d(t,{fillInsideCircle:()=>i.kr});n(10088);var i=n(56789)},64485:(e,t,n)=>{n.d(t,{x:()=>a});var i=n(15327),o=(n(82056),n(3823));function a(e,t,n){const a=e.getImageIds();if(!a||!a.length)return;const r=a.map(e=>{const{imagePositionPatient:a}=i.metaData.get("imagePlaneModule",e),r=function(e,t,n){const i=o.eR.create();o.eR.sub(i,e,t);const a=o.eR.dot(i,n);return Math.abs(a)}(t,a,n);return{imageId:e,distance:r}});return r.sort((e,t)=>e.distance-t.distance),r[0].imageId}},76802:()=>{},72282:(e,t,n)=>{n.d(t,{getBoundingBoxAroundShapeIJK:()=>i.g,getBoundingBoxAroundShapeWorld:()=>i.C});n(76802);var i=n(87063)},56534:(e,t,n)=>{n.d(t,{addContourSegmentationAnnotation:()=>o.V,createPolylineHole:()=>a.rK,removeContourSegmentationAnnotation:()=>i.M});n(62854),n(15327),n(6802);var i=n(37354),o=n(85263);n(21536),n(78130),n(3444),n(49941),n(1318);var a=n(65172);n(43185)},46228:(e,t,n)=>{function i(e,t,n){let o=-1;if(t.forEach((t,n)=>{o>=0||t.a==e.b&&(o=n)}),o>=0){const e=t[o];return t.splice(o,1),n.push(e.b),n[0]==e.b?{remainingLines:t,contourPoints:n,type:"CLOSED_PLANAR"}:i(e,t,n)}return{remainingLines:t,contourPoints:n,type:"OPEN_PLANAR"}}function o(e){if(0==e.length)return[];const t=[],n=e.shift();t.push(n.a),t.push(n.b);const a=i(n,e,t);if(0==a.remainingLines.length)return[{type:a.type,contourPoints:a.contourPoints}];{const e=o(a.remainingLines);return e.push({type:a.type,contourPoints:a.contourPoints}),e}}function a(e){return o(e)}n.d(t,{d1:()=>a})},98013:(e,t,n)=>{var i=n(15327);n(3823);const{isEqual:o}=i.utilities},37546:(e,t,n)=>{function i(e,t=!1){const n=e.getPoints(),i=e.getLines(),o=new Array(n.getNumberOfPoints()).fill(0).map((e,t)=>n.getPoint(t).slice()),a=new Array(i.getNumberOfCells()).fill(0).map((e,t)=>{const n=i.getCell(3*t).slice();return{a:n[0],b:n[1]}});if(t)return{points:o,lines:a};const r=[];for(const[e,t]of o.entries()){const n=r.findIndex(e=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]);if(n>=0)a.map(t=>(t.a===e&&(t.a=n),t.b===e&&(t.b=n),t));else{const n=r.length;r.push(t),a.map(t=>(t.a===e&&(t.a=n),t.b===e&&(t.b=n),t))}}return{points:r,lines:a.filter(e=>e.a!==e.b)}}n.d(t,{v:()=>i})},473:(e,t,n)=>{n.d(t,{getTextBoxCoordsCanvas:()=>i.A});var i=n(1239)},4096:(e,t,n)=>{n.d(t,{Op:()=>g});var i=n(15327);const{CalibrationTypes:o}=i.Enums,a="px",r="voxels",s=[1,2,3,4],l=["3,3","4,7"],c={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm",9:"cm/s",12:"degrees"},d="",g=(e,t)=>{const{calibration:n,hasPixelSpacing:g}=e;let u=g?"mm":a;const m=g?"mm":r;let h=u+d,p=1,f="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{unit:u,areaUnit:h,scale:p,volumeUnit:m};if(n.type===o.UNCALIBRATED)return{unit:a,areaUnit:a+d,scale:p,volumeUnit:r};if(n.sequenceOfUltrasoundRegions){let e,o;if(Array.isArray(t)&&2===t.length)[e,o]=t;else if("function"==typeof t){const n=t();e=n[0],o=n[1]}let g=n.sequenceOfUltrasoundRegions.filter(t=>e[0]>=t.regionLocationMinX0&&e[0]<=t.regionLocationMaxX1&&e[1]>=t.regionLocationMinY0&&e[1]<=t.regionLocationMaxY1&&o[0]>=t.regionLocationMinX0&&o[0]<=t.regionLocationMaxX1&&o[1]>=t.regionLocationMinY0&&o[1]<=t.regionLocationMaxY1);if(!g?.length)return{unit:u,areaUnit:h,scale:p,volumeUnit:m};if(g=g.filter(e=>s.includes(e.regionDataType)&&l.includes(`${e.physicalUnitsXDirection},${e.physicalUnitsYDirection}`)),!g.length)return{unit:a,areaUnit:a+d,scale:p,volumeUnit:r};const v=g[0],w=Math.abs(v.physicalDeltaX),I=Math.abs(v.physicalDeltaY);if(!i.utilities.isEqual(w,I,.001))return{unit:a,areaUnit:a+d,scale:p,volumeUnit:r};p=1/w,f="US Region",u=c[v.physicalUnitsXDirection]||"unknown",h=u+d}else n.scale&&(p=n.scale);return[o.ERMF,o.USER,o.ERROR,o.PROJECTION,o.CALIBRATED,o.UNKNOWN].includes(n?.type)&&(f=n.type),{unit:u+(f?` ${f}`:""),areaUnit:h+(f?` ${f}`:""),scale:p,volumeUnit:m+(f?` ${f}`:"")}}},4296:(e,t,n)=>{n.d(t,{l:()=>l});var i=n(15327),o=n(3823),a=n(72282);const{transformWorldToIndex:r}=i.utilities;function s(e,t,n){const[i,s]=e,l=o.eR.fromValues((i[0]+s[0])/2,(i[1]+s[1])/2,(i[2]+s[2])/2),c=o.eR.distance(i,s)/2,{boundsIJK:d,topLeftWorld:g,bottomRightWorld:u}=function(e,t,n,i,s){const l=e.getDimensions(),{row:c,column:d,normal:g}=t,u=o.eR.create(),m=o.eR.create();o.eR.scaleAndAdd(u,i,g,s),o.eR.scaleAndAdd(m,i,g,-s),o.eR.scaleAndAdd(u,u,d,-s),o.eR.scaleAndAdd(m,m,d,s),o.eR.scaleAndAdd(u,u,c,-s),o.eR.scaleAndAdd(m,m,c,s);const h=r(e,u),p=r(e,m),f=n.map(t=>r(e,t)),v=(0,a.getBoundingBoxAroundShapeIJK)([h,p,...f],l);return{boundsIJK:v,topLeftWorld:u,bottomRightWorld:m}}(t,n,e,l,c);return{boundsIJK:d,centerWorld:l,radiusWorld:c,topLeftWorld:g,bottomRightWorld:u}}function l(e,t,n){if(!n)throw new Error("viewport is required in order to calculate the sphere bounds");const i=n.getCamera(),a=o.eR.fromValues(i.viewUp[0],i.viewUp[1],i.viewUp[2]),r=o.eR.fromValues(i.viewPlaneNormal[0],i.viewPlaneNormal[1],i.viewPlaneNormal[2]),l=o.eR.create();o.eR.cross(l,a,r);return s(e,t,{row:l,normal:r,column:o.eR.negate(o.eR.create(),a)})}},39848:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(15327),o=n(77609);function a(e,t){const n=(0,i.getEnabledElement)(e),{renderingEngineId:a,viewportId:r}=n,s=(0,o.getToolGroupForViewport)(r,a);if(!s)return[];const l=[],c=Object.keys(s.toolOptions);for(let e=0;e<c.length;e++){const n=c[e],i=s.toolOptions[n];if(i&&t.includes(i.mode)){const e=s.getToolInstance(n);l.push(e)}}return l}},88638:()=>{},25963:(e,t,n)=>{n(3823)},83923:(e,t,n)=>{n(25963)},28364:(e,t,n)=>{n.d(t,{I:()=>o,t:()=>i});class i{}class o{constructor(e){this.storePointData=e.storePointData}getStatistics(){console.debug("InstanceCalculator getStatistics called")}}},73262:(e,t,n)=>{n.d(t,{BasicStatsCalculator:()=>i.O});var i=n(69013);n(28364)},77081:(e,t,n)=>{n(82216)},11683:(e,t,n)=>{n.d(t,{getCanvasEllipseCorners:()=>o.A,precalculatePointInEllipse:()=>i});const i=(e,t={})=>{const{xRadius:n,yRadius:i,zRadius:o}=e;void 0!==t.invXRadiusSq&&void 0!==t.invYRadiusSq&&void 0!==t.invZRadiusSq||(t.invXRadiusSq=0!==n?1/n**2:0,t.invYRadiusSq=0!==i?1/i**2:0,t.invZRadiusSq=0!==o?1/o**2:0);const{invXRadiusSq:a,invYRadiusSq:r,invZRadiusSq:s}=t,{center:l}=e,[c,d,g]=l;return t.precalculated=e=>{const t=e[0]-c;let n=t*t*a;if(n>1)return!1;const i=e[1]-d;if(n+=i*i*r,n>1)return!1;const o=e[2]-g;return n+=o*o*s,n<=1},t};var o=n(2222)},95527:(e,t,n)=>{n.d(t,{point:()=>i,polyline:()=>o});n(88638),n(73262),n(77081),n(11683),n(93258);var i=n(82216),o=n(92984);n(33657),n(23324),n(83923)},18989:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(73149);function o(e,t,n){return(0,i.A)(e,t,n).distanceSquared}},73149:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(82216);function o(e,t,n){let o;const a=(0,i.distanceToPointSquared)(e,t);if(e[0]===t[0]&&e[1]===t[1]&&(o=e),!o){const i=((n[0]-e[0])*(t[0]-e[0])+(n[1]-e[1])*(t[1]-e[1]))/a;o=i<0?e:i>1?t:[e[0]+i*(t[0]-e[0]),e[1]+i*(t[1]-e[1])]}return{point:[...o],distanceSquared:(0,i.distanceToPointSquared)(n,o)}}},93258:(e,t,n)=>{n.d(t,{distanceToPoint:()=>i.A,distanceToPointSquared:()=>o.A,intersectLine:()=>a.A,isPointOnLineSegment:()=>r.A});var i=n(86978),o=n(18989),a=(n(73149),n(81205)),r=n(91818)},91818:(e,t,n)=>{n.d(t,{A:()=>o});const i=.01;function o(e,t,n){const o=e[0]<=t[0]?e[0]:t[0],a=e[0]>=t[0]?e[0]:t[0],r=e[1]<=t[1]?e[1]:t[1],s=e[1]>=t[1]?e[1]:t[1];if(!(n[0]>=o-i&&n[0]<=a+i&&n[1]>=r-i&&n[1]<=s+i))return!1;const l=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return(l>=0?l:-l)<=i}},82216:(e,t,n)=>{function i(e,t){if(e.length!==t.length)throw Error("Both points should have the same dimensionality");const[n,i,o=0]=e,[a,r,s=0]=t,l=a-n,c=r-i,d=s-o;return l*l+c*c+d*d}function o(e,t){return Math.sqrt(i(e,t))}function a(e,t){const[n,i]=e,[o,a]=t;return[2*o-n,2*a-i]}n.r(t),n.d(t,{distanceToPoint:()=>o,distanceToPointSquared:()=>i,mirror:()=>a})},97792:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(15327),o=n(3823);const a=(e,t,n,a)=>{const{xDir:r,yDir:s,spacing:l}=a,c=(0,i.getEnabledElement)(e),{viewport:d}=c;if(!t.length)return t.push(n),console.log(">>>>> !canvasPoints. :: RETURN"),1;const g=d.canvasToWorld(t[t.length-1]),u=d.canvasToWorld(n),m=o.eR.create();o.eR.subtract(m,u,g);const h=Math.abs(o.eR.dot(m,r)),p=Math.abs(o.eR.dot(m,s)),f=Math.max(Math.floor(h/l[0]),Math.floor(p/l[0]));if(f>1){const e=t[t.length-1],i=o.Zc.dist(e,n),a=o.Zc.create();o.Zc.subtract(a,n,e),o.Zc.set(a,a[0]/i,a[1]/i);const r=i/f;for(let n=1;n<=f;n++)t.push([e[0]+r*a[0]*n,e[1]+r*a[1]*n])}else t.push(n);return f}},56777:(e,t,n)=>{function i(e,t,n,i){let r=!1;const s=e[0]<t[0]?e[0]:t[0],l=e[1]<t[1]?e[1]:t[1],c=e[0]>t[0]?e[0]:t[0],d=e[1]>t[1]?e[1]:t[1],g=n[0]<i[0]?n[0]:i[0],u=n[1]<i[1]?n[1]:i[1],m=n[0]>i[0]?n[0]:i[0],h=n[1]>i[1]?n[1]:i[1];if(s>m||c<g||l>h||d<u)return!1;const p=[o(e,t,n),o(e,t,i),o(n,i,e),o(n,i,t)];return p[0]!==p[1]&&p[2]!==p[3]||((0===p[0]&&a(e,n,t)||0===p[1]&&a(e,i,t)||0===p[2]&&a(n,e,i)||0===p[3]&&a(n,t,i))&&(r=!0),r)}function o(e,t,n){const i=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===i?0:i>0?1:2}function a(e,t,n){return t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1])}n.d(t,{A:()=>i})},68385:(e,t,n)=>{n.d(t,{S:()=>p,Y:()=>f});var i,o,a,r=n(82216),s=n(37135),l=n(46513),c=n(11377),d=n(3823),g=n(10812);function u(e){for(let t=0,n=e.length;t<n;t++){const i=e[t];i.next||(i.next=e[t===n-1?0:t+1])}}function m(e,t){const n=[],c=[],d=new Map;let m=(0,l.A)(t,e[0])?a.Exiting:a.Entering;for(let c=0,u=e.length;c<u;c++){const h=e[c],p=(0,l.A)(t,h),f={type:i.Vertex,coordinates:h,position:p?o.Inside:o.Outside,visited:!1,next:null};n.push(f);const v=e[c===u-1?0:c+1],w=(0,s.A)(t,h,v).map(e=>{const n=e[0],i=t[e[0]],o=t[e[1]],a=(0,g.A)(h,v,i,o);return{sourceLineSegmentId:n,coordinate:a,targetStartPointDistSquared:r.distanceToPointSquared(h,a)}});w.sort((e,t)=>e.targetStartPointDistSquared-t.targetStartPointDistSquared),w.forEach(e=>{const{sourceLineSegmentId:t,coordinate:r}=e,s={type:i.Intersection,coordinates:r,position:o.Edge,direction:m,visited:!1,next:null},l={...s,direction:a.Unknown,cloned:!0};m===a.Entering?s.next=l:l.next=s;let c=d.get(t);c||(c=[],d.set(t,c)),n.push(s),c.push(l),m*=-1})}for(let e=0,n=t.length;e<n;e++){const n=e,o=t[e],a={type:i.Vertex,coordinates:o,visited:!1,next:null};c.push(a);const s=d.get(n);s?.length&&s.map(e=>({intersectionPoint:e,lineSegStartDistSquared:r.distanceToPointSquared(o,e.coordinates)})).sort((e,t)=>e.lineSegStartDistSquared-t.lineSegStartDistSquared).map(({intersectionPoint:e})=>e).forEach(e=>c.push(e))}return u(n),u(c),{targetPolylinePoints:n,sourcePolylinePoints:c}}function h(e){for(let t=0,n=e.length;t<n;t++){const n=e[t];if(!n.visited&&n.position===o.Outside)return n}}function p(e,t){const n=(0,c.A)(e),o=(0,c.A)(t),a=d.eR.dot(o,n);d.Fd.equals(1,a)||(t=t.slice().reverse());const{targetPolylinePoints:r}=m(e,t),s=h(r);if(!s)return e.slice();const l=[s.coordinates];let g=s.next,u=0;const p=e.length+t.length+1e3;for(;g!==s&&u<p;)if(u++,g.type===i.Intersection&&g.cloned)g=g.next;else if(l.push(g.coordinates),g=g.next,!g){console.warn("Broken linked list detected in mergePolylines, breaking loop");break}return u>=p&&console.warn("Maximum iterations reached in mergePolylines, possible infinite loop detected"),l}function f(e,t){const n=(0,c.A)(e),o=(0,c.A)(t),a=d.eR.dot(o,n);d.Fd.equals(-1,a)||(t=t.slice().reverse());const{targetPolylinePoints:r}=m(e,t);let s=null;const l=[];let g=0;const u=2*e.length;for(;(s=h(r))&&g<u;){g++;const n=[s.coordinates];let o=s.next,a=0;const r=e.length+t.length+1e3;for(s.visited=!0;o!==s&&a<r;)if(a++,o.visited=!0,o.type===i.Intersection&&o.cloned)o=o.next;else if(n.push(o.coordinates),o=o.next,!o){console.warn("Broken linked list detected in subtractPolylines, breaking inner loop");break}a>=r&&console.warn("Maximum inner iterations reached in subtractPolylines, possible infinite loop detected"),l.push(n)}return g>=u&&console.warn("Maximum outer iterations reached in subtractPolylines, possible infinite loop detected"),l}!function(e){e[e.Vertex=0]="Vertex",e[e.Intersection=1]="Intersection"}(i||(i={})),function(e){e[e.Outside=-1]="Outside",e[e.Edge=0]="Edge",e[e.Inside=1]="Inside"}(o||(o={})),function(e){e[e.Exiting=-1]="Exiting",e[e.Unknown=0]="Unknown",e[e.Entering=1]="Entering"}(a||(a={}))},46513:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(19246);function o(e,t,n={closed:void 0}){if(e.length<3)return!1;const a=e.length;let r=0;const{closed:s,holes:l}=n;if(l?.length)for(const e of l)if(o(e,t))return!1;const c=!(void 0===s?(0,i.A)(e):s),d=e.length-(c?1:2);for(let n=0;n<=d;n++){const i=e[n],o=e[n===a-1?0:n+1],s=i[0]>=o[0]?i[0]:o[0],l=i[1]>=o[1]?i[1]:o[1],c=i[1]<=o[1]?i[1]:o[1];if(t[0]<=s&&t[1]>=c&&t[1]<l){let e=i[0]===o[0];if(!e){const n=(t[1]-i[1])*(o[0]-i[0])/(o[1]-i[1])+i[0];e=t[0]<=n}r+=e?1:0}}return!!(r%2)}},58754:(e,t,n)=>{function i(e){if(e.length<3)return e.slice();const t=e.map(e=>[e[0],e[1]]).sort((e,t)=>e[0]===t[0]?e[1]-t[1]:e[0]-t[0]);function n(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}const i=[];for(const e of t){for(;i.length>=2&&n(i[i.length-2],i[i.length-1],e)<=0;)i.pop();i.push(e)}const o=[];for(let e=t.length-1;e>=0;e--){const i=t[e];for(;o.length>=2&&n(o[o.length-2],o[o.length-1],i)<=0;)o.pop();o.push(i)}return i.pop(),o.pop(),i.concat(o)}n.d(t,{A:()=>i})},98122:(e,t,n)=>{function i(e,t){let n=e;const i=t?.numDimensions||2,o=3===i;if(!Array.isArray(e[0])){const t=e,a=t.length/i;n=new Array(t.length/i);for(let e=0,r=a;e<r;e++)n[e]=[t[e*i],t[e*i+1]],o&&n[e].push(t[e*i+2])}let a=1/0,r=1/0,s=-1/0,l=-1/0,c=1/0,d=-1/0;for(let e=0,t=n.length;e<t;e++){const[t,i,g]=n[e];a=a<t?a:t,r=r<i?r:i,s=s>t?s:t,l=l>i?l:i,o&&(c=c<g?c:g,d=d>g?d:g)}return o?{minX:a,maxX:s,minY:r,maxY:l,minZ:c,maxZ:d}:{minX:a,maxX:s,minY:r,maxY:l}}n.d(t,{A:()=>i})},86909:(e,t,n)=>{function i(e){const t=e.length;let n=0,i=t-1;for(let o=0;o<t;o++)n+=(e[i][0]+e[o][0])*(e[i][1]-e[o][1]),i=o;return Math.abs(n/2)}n.d(t,{A:()=>i})},32979:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(3823),o=n(56777);function a(e,t,n,a=!0){let r,s;a?(s=e.length-1,r=0):(s=0,r=1);const l=[];for(let i=r;i<e.length;i++){const a=e[s],r=e[i];(0,o.A)(t,n,a,r)&&l.push([s,i]),s=i}if(0===l.length)return;const c=[];l.forEach(n=>{const o=[e[n[0]],e[n[1]]],a=[(o[0][0]+o[1][0])/2,(o[0][1]+o[1][1])/2];c.push(i.Zc.distance(a,t))});const d=Math.min(...c);return{segment:l[c.indexOf(d)],distance:d}}},4338:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(56777);function o(e,t,n,o=!0){let a,r;o?(r=e.length-1,a=0):(r=0,a=1);for(let o=a;o<e.length;o++){const a=e[r],s=e[o];if((0,i.A)(t,n,a,s))return[r,o];r=o}}},50932:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(37135),o=n(10812);function a(e,t,n,a=!0){const r=[],s=(0,i.A)(e,t,n,a);for(let i=0;i<s.length;i++){const a=e[s[i][0]],l=e[s[i][1]],c=(0,o.A)(t,n,a,l);r.push(c)}return r}},37135:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(56777);function o(e,t,n,o=!0){const a=[],r=e.length,s=r-(o?1:2);for(let o=0;o<=s;o++){const s=e[o],l=o===r-1?0:o+1,c=e[l];(0,i.A)(t,n,s,c)&&a.push([o,l])}return a}},10812:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(93258);const o=.01;function a(e,t,n,a){const r=[t[0]-e[0],t[1]-e[1]],s=[a[0]-n[0],a[1]-n[1]],l=s[1]*r[0]-s[0]*r[1];if((l>=0?l:-l)<o){const o=[e[0]<t[0]?e[0]:t[0],e[0]>t[0]?e[0]:t[0],e[1]<t[1]?e[1]:t[1],e[1]>t[1]?e[1]:t[1]],r=[n[0]<a[0]?n[0]:a[0],n[0]>a[0]?n[0]:a[0],n[1]<a[1]?n[1]:a[1],n[1]>a[1]?n[1]:a[1]];if(!(o[0]<=r[1]&&o[1]>=r[0]&&o[2]<=r[3]&&o[3]>=r[2]))return;if(!(i.isPointOnLineSegment(e,t,n)||i.isPointOnLineSegment(e,t,a)||i.isPointOnLineSegment(n,a,e)))return;return[.5*((o[0]>r[0]?o[0]:r[0])+(o[1]<r[1]?o[1]:r[1])),.5*((o[2]>r[2]?o[2]:r[2])+(o[3]<r[3]?o[3]:r[3]))]}let c=e[1]-n[1],d=e[0]-n[0];const g=r[0]*c-r[1]*d;c=(s[0]*c-s[1]*d)/l,d=g/l;return[e[0]+c*r[0],e[1]+c*r[1]]}},11377:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(63113);function o(e){const t=(0,i.A)(e);return[0,0,t/Math.abs(t)]}},43490:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(3823);function o(e){const t=function(e){const t=i.eR.create(),n=e[0];for(let i=0,o=e.length;i<o;i++){const a=e[i],r=e[i===o-1?0:i+1],s=a[0]-n[0],l=a[1]-n[1],c=a[2]-n[2],d=r[0]-n[0],g=r[1]-n[1],u=r[2]-n[2];t[0]+=l*u-c*g,t[1]+=c*d-s*u,t[2]+=s*g-l*d}return i.eR.scale(t,t,.5),t}(e);return i.eR.normalize(t,t)}},61785:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(15327),o=n(3823);const a=.001,r=(e,t)=>{let n,r,s;if(e instanceof i.StackViewport){const t=e.getImageData();if(!t)return;r=t.direction.slice(0,3),s=t.direction.slice(3,6),n=t.spacing}else{const t=e.getImageData(),{direction:i,spacing:l}=t,{viewPlaneNormal:c,viewUp:d}=e.getCamera(),g=i.slice(0,3),u=i.slice(3,6),m=i.slice(6,9),h=o.eR.create();o.eR.cross(h,d,c);const p=Math.abs(o.eR.dot(h,g)),f=Math.abs(o.eR.dot(h,u)),v=Math.abs(o.eR.dot(h,m));let w;if(Math.abs(1-p)<a)w=l[0],r=g;else if(Math.abs(1-f)<a)w=l[1],r=u;else{if(!(Math.abs(1-v)<a))throw new Error("No support yet for oblique plane planar contours");w=l[2],r=m}const I=Math.abs(o.eR.dot(d,g)),A=Math.abs(o.eR.dot(d,u)),S=Math.abs(o.eR.dot(d,m));let b;if(Math.abs(1-I)<a)b=l[0],s=g;else if(Math.abs(1-A)<a)b=l[1],s=u;else{if(!(Math.abs(1-S)<a))throw new Error("No support yet for oblique plane planar contours");b=l[2],s=m}n=[w,b]}return{spacing:[n[0]/t,n[1]/t],xDir:r,yDir:s}}},4239:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(63113);function o(e){return(0,i.A)(e)>=0?1:-1}},405:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(4338);function o(e,t){for(let n=0,o=e.length;n<o;n++){const a=e[n],r=e[n===o-1?0:n+1],s=(0,i.A)(t,a,r);if(2===s?.length)return!0}return!1}},8361:(e,t,n)=>{n.d(t,{i:()=>a});var i=n(46513),o=n(28502);function a(e,t,n={}){const{sharedDimensionIndex:a,projectedPolyline:r}=(0,o.p)(t),{holes:s}=n,l=[];if(s)for(let e=0;e<s.length;e++){const t=s[e],n=[];for(let e=0;e<t.length;e++)n.push([t[e][(a+1)%3],t[e][(a+2)%3]]);l.push(n)}const c=[e[(a+1)%3],e[(a+2)%3]];return(0,i.A)(r,c,{holes:l})}},80514:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(3823);const o=(e,t,n,o)=>{const a=[e[0]-t[0],e[1]-t[1]],r=[n[0]-t[0],n[1]-t[1]],s=a[0]*r[0]+a[1]*r[1];if(s<0)return!1;const l=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(0===l)return!1;const c=s/l,d=[r[0]/l,r[1]/l],g=[d[0]*c,d[1]*c],u=[t[0]+g[0],t[1]+g[1]];return!(i.Zc.distance(e,u)>o)&&!(i.Zc.distance(t,u)>i.Zc.distance(t,n))}},82265:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(3823);const o=(e,t,n)=>i.Zc.dist(e,t)<n},28502:(e,t,n)=>{n.d(t,{p:()=>a});var i=n(15327);const o=1e-6;function a(e){let t;const n=i.utilities.getRandomSampleFromArray(e,50);for(let e=0;e<3;e++)if(n.every((t,n,i)=>Math.abs(t[e]-i[0][e])<o)){t=e;break}if(void 0===t)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const a=[],r=(t+1)%3,s=(t+2)%3;for(let t=0;t<e.length;t++)a.push([e[t][r],e[t][s]]);return{sharedDimensionIndex:t,projectedPolyline:a}}},33657:(e,t,n)=>{n.d(t,{distanceToPoint:()=>i.A});var i=n(87105)},23324:(e,t,n)=>{n(90554),n(35381)},35381:(e,t,n)=>{},13165:(e,t,n)=>{n.d(t,{filterAnnotationsForDisplay:()=>a.A,filterAnnotationsWithinSamePlane:()=>c.W});var i=n(36374),o=n(35489),a=n(94418),r=n(62514),s=n(57063),l=n(30698),c=n(40770);i.A,o.A,r.A,a.A,s.R,l.Y,c.W,s.p},60199:(e,t,n)=>{n.d(t,{H:()=>r});var i=n(3823),o=n(60213);const a=.01;function r(e,t,n={maxMajor:0,maxMinor:0}){const{points:r}=e.polyData,{maxMinor:s,maxMajor:l}=n;let c,d=l*l,g=s*s;for(let e=0;e<r.length;e++)for(let n=e+1;n<r.length;n++){const s=r[e],l=r[n],u=i.eR.sqrDist(s,l);u<d||(u-a<d+a&&c||t.testCenter(s,l)&&(0,o.pW)(s,l,t)&&(d=u-a,c=[e,n],g=0))}if(!c)return;d=Math.sqrt(d+a);const u=r[c[0]],m=r[c[1]],h=i.eR.sub(i.eR.create(),u,m);let p;i.eR.scale(h,h,1/d);for(let e=0;e<r.length;e++)for(let n=e+1;n<r.length;n++){const s=r[e],l=r[n],c=i.eR.sqrDist(s,l);if(c<=g)continue;const d=i.eR.sub(i.eR.create(),s,l);Math.abs(i.eR.dot(d,h))/Math.sqrt(c)>a||t.testCenter(s,l)&&(0,o.pW)(s,l,t)&&(g=c,p=[e,n])}if(!p)return;g=Math.sqrt(g);return{majorAxis:[u,m],minorAxis:[r[p[0]],r[p[1]]],maxMajor:d,maxMinor:g,...e}}},14957:(e,t,n)=>{n(77609),n(48736)},60213:(e,t,n)=>{n.d(t,{On:()=>a,pW:()=>o});n(15327);var i=n(3823);function o(e,t,n){const o=n.toIJK(e),a=n.toIJK(t),r=i.eR.create(),{testIJK:s}=n,l=i.eR.sub(i.eR.create(),o,a),c=Math.round(Math.max(...l.map(Math.abs)));if(c<2)return!0;const d=i.eR.scale(i.eR.create(),l,1/c);for(let e=1;e<c;e++)if(i.eR.scaleAndAdd(r,a,d,e),!s(r))return!1;return!0}function a({dimensions:e,imageData:t,voxelManager:n,segmentIndex:o,containedSegmentIndices:a}){const r=e[0],s=r*e[1];return{testCenter:(e,l)=>{const c=i.eR.add(i.eR.create(),e,l).map(e=>e/2),d=t.worldToIndex(c).map(Math.round),[g,u,m]=d,h=g+u*r+m*s,p=n.getAtIndex(h);return p===o||a?.has(p)},toIJK:e=>t.worldToIndex(e),testIJK:e=>{const[t,i,l]=e,c=Math.round(t)+Math.round(i)*r+Math.round(l)*s,d=n.getAtIndex(c);return d===o||a?.has(d)}}}},94779:(e,t,n)=>{n.d(t,{_:()=>r});var i=n(15327),o=n(56069),a=n(77609);function r(e){e.forEach(e=>{const t=(0,a.getToolGroup)(e);if(!t)return void console.warn(`ToolGroup not available for ${e}`);t.getViewportsInfo().forEach(e=>{const{renderingEngineId:t,viewportId:n}=e,a=(0,i.getRenderingEngine)(t);if(!a)return void console.warn(`RenderingEngine not available for ${t}`);const r=a.getViewport(n);(0,o.A)(r.element)})})}},58640:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(15327),o=n(56069);const a=function(e){e.length&&e.forEach(e=>{const t=(0,i.getEnabledElementByViewportId)(e);if(!t)return void console.warn(`Viewport not available for ${e}`);const{viewport:n}=t;if(!n)return void console.warn(`Viewport not available for ${e}`);const a=n.element;(0,o.A)(a)})}},60810:(e,t,n)=>{n.d(t,{getViewportIdsWithToolToRender:()=>i.A});n(3198),n(9356);var i=n(14543);n(67514)},26605:(e,t,n)=>{var i=n(99178),o=n(15327),a=n(68915);class r{static{this.calculators=new Map}static{this.indices=[]}static{this.mode="collective"}static statsInit(e){const{storePointData:t,indices:n,mode:i}=e;this.mode=i,this.indices=n,this.calculators.clear(),"individual"===this.mode?n.forEach(e=>{this.calculators.set(e,new a.C3({storePointData:t}))}):this.calculators.set(n,new a.C3({storePointData:t}))}static statsCallback(e){const{segmentIndex:t,...n}=e;if(!t)throw new Error("Segment index is required for stats calculation");const i="individual"===this.mode?this.calculators.get(t):this.calculators.get(this.indices);if(!i)throw new Error(`No calculator found for segment ${t}`);i.statsCallback(n)}static getStatistics(e){if("individual"===this.mode){const t={};return this.calculators.forEach((n,i)=>{t[i]=n.getStatistics(e)}),t}return this.calculators.get(this.indices).getStatistics(e)}}n(8582),n(52323),n(4334),n(97492);var s=n(99737),l=n(18682),c=n(93210),d=n(67014),g=n(25894),u=n(684),m=n(68040),h=n(85204),p=n(37590),f=n(77609);const v={[l.A.Labelmap]:u.Ay,[l.A.Contour]:g.A,[l.A.Surface]:d.Ay},w=p.A.toolName;new class{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._getAllViewports=()=>(0,o.getRenderingEngines)().flatMap(e=>e.getViewports()),this._renderFlaggedSegmentations=()=>{this._throwIfDestroyed();Array.from(this._needsRender).forEach(e=>{this._triggerRender(e)}),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}}renderSegmentationsForViewport(e){const t=e?[e]:this._getViewportIdsForSegmentation();this._setViewportsToBeRenderedNextFrame(t)}renderSegmentation(e){const t=this._getViewportIdsForSegmentation(e);this._setViewportsToBeRenderedNextFrame(t)}_getViewportIdsForSegmentation(e){const t=this._getAllViewports(),n=[];for(const i of t){const t=i.id;if(e){const i=(0,c.r$)(t,{segmentationId:e});i?.length>0&&n.push(t)}else{const e=(0,c.r$)(t);e?.length>0&&n.push(t)}}return n}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){e.forEach(e=>{this._needsRender.add(e)}),this._render()}_render(){this._needsRender.size>0&&!1===this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedSegmentations),this._animationFrameSet=!0)}_triggerRender(e){const t=(0,c.r$)(e);if(!t?.length)return;const{viewport:n}=(0,o.getEnabledElementByViewportId)(e)||{};if(!n)return;const i=[],a=t.map(e=>{e.type===s.SegmentationRepresentations.Contour&&this._addPlanarFreeHandToolIfAbsent(n);const t=v[e.type];try{const o=t.render(n,e);i.push(o)}catch(e){console.error(e)}return Promise.resolve({segmentationId:e.segmentationId,type:e.type})});Promise.allSettled(a).then(e=>{const t=e.filter(e=>"fulfilled"===e.status).map(e=>e.value);n.element.addEventListener(o.Enums.Events.IMAGE_RENDERED,function e(n){const{element:i,viewportId:a}=n.detail;i.removeEventListener(o.Enums.Events.IMAGE_RENDERED,e),t.forEach(e=>{const t={viewportId:a,segmentationId:e.segmentationId,type:e.type};(0,o.triggerEvent)(o.eventTarget,s.Events.SEGMENTATION_RENDERED,{...t})})}),n.render()})}_addPlanarFreeHandToolIfAbsent(e){w in h.wk.tools||(0,m.Gx)(p.A);const t=(0,f.getToolGroupForViewport)(e.id);t.hasTool(w)||(t.addTool(w),t.setToolPassive(w))}};n(17014),n(49492),n(73706),n(13276),n(14514),n(22592),n(58640),n(14957);n(25758),n(98870),n(6802),n(92984),n(59452);n(91963);n(3823),n(4296);const{transformWorldToIndex:I}=o.utilities;const{transformWorldToIndex:A}=o.utilities;n(2397),n(67912),n(30722),n(83075),n(38440),n(21345),n(33283),n(49906),n(93952),n(4714),n(59475);n(12853),n(78773),n(88274);var S=n(28906),b=n(87275);class y{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.oriented=e,this.edgeMap=new Map}initialize(){this.edgeMap.clear()}computeEdgeKey(e,t){return this.oriented||e<t?e*t*.5*(e*t+1)+t:t*e*.5*(t*e+1)+e}insertUniqueEdge(e,t,n){const i=this.computeEdgeKey(e,t);let o=this.edgeMap.get(i);return o||(o={key:i,edgeId:this.edgeMap.size,value:n},this.edgeMap.set(i,o)),o}insertEdge(e,t,n){const i=this.computeEdgeKey(e,t),o={key:i,edgeId:this.edgeMap.size,value:n};return this.edgeMap.set(i,o),o}isInsertedEdge(e,t){const n=this.computeEdgeKey(e,t);return this.edgeMap.get(n)}static getEdgePointIds(e){const t=.5*(-1+Math.sqrt(8*e.key+1)),n=e.key-.5*(t+1)*t;return[n,t-n]}}var R={newInstance:function(){return new y((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).oriented)}};const x=[[-1,-1,-1,-1,-1],[0,3,-1,-1,-1],[1,0,-1,-1,-1],[1,3,-1,-1,-1],[2,1,-1,-1,-1],[0,3,2,1,-1],[2,0,-1,-1,-1],[2,3,-1,-1,-1],[3,2,-1,-1,-1],[0,2,-1,-1,-1],[1,0,3,2,-1],[1,2,-1,-1,-1],[3,1,-1,-1,-1],[0,1,-1,-1,-1],[3,0,-1,-1,-1],[-1,-1,-1,-1,-1]],M=[[0,1],[1,3],[2,3],[0,2]];var E={getCase:function(e){return x[e]},getEdge:function(e){return M[e]}};const{vtkErrorMacro:P,vtkDebugMacro:C}=S.m;function D(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=n=>{t.contourValues=n,e.modified()};const n=[],i=[],o=[],a=R.newInstance();e.getPixelScalars=(e,t,o,a,r,s)=>{const[l,c,d]=e;n[0]=d*t[1]*t[0]+c*t[0]+l,n[1]=n[0]+a[r],n[2]=n[0]+a[s],n[3]=n[2]+a[r];for(let e=0;e<4;++e)i[e]=o[n[e]]},e.getPixelPoints=(e,t,n,i,a)=>{const r=e[i],s=e[a];o[0]=t[i]+r*n[i],o[1]=t[a]+s*n[a],o[2]=o[0]+n[i],o[3]=o[1],o[4]=o[0],o[5]=o[1]+n[a],o[6]=o[2],o[7]=o[5]},e.produceLines=(r,s,l,c,d,g,u,m,h,p,f)=>{const v=s[t.slicingMode],w=[1,2,8,4],I=[];let A;e.getPixelScalars(s,l,g,h,p,f);let S=0;for(let e=0;e<4;e++)i[e]>=r&&(S|=w[e]);const b=E.getCase(S);if(b[0]<0)return;e.getPixelPoints(s,c,d,p,f);const y=c[t.slicingMode]+v*d[t.slicingMode];for(let e=0;b[e]>=0;e+=2){m.push(2);for(let s=0;s<2;s++){const l=E.getEdge(b[e+s]);if(A=void 0,t.mergePoints&&(A=a.isInsertedEdge(n[l[0]],n[l[1]])?.value),void 0===A){const e=(r-i[l[0]])/(i[l[1]]-i[l[0]]),s=o.slice(2*l[0],2*(l[0]+1)),c=o.slice(2*l[1],2*(l[1]+1));I[p]=s[0]+e*(c[0]-s[0]),I[f]=s[1]+e*(c[1]-s[1]),I[t.slicingMode]=y,A=u.length/3,u.push(I[0],I[1],I[2]),t.mergePoints&&a.insertEdge(n[l[0]],n[l[1]],A)}m.push(A)}}},e.requestData=(n,i)=>{const o=n[0];if(!o)return void P("Invalid or missing input");if(null==t.slicingMode||t.slicingMode<0||t.slicingMode>2)return void P("Invalid or missing slicing mode");console.time("msquares");const r=o.getOrigin(),s=o.getSpacing(),l=o.getDimensions(),c=o.getExtent(),d=o.computeIncrements(c),g=o.getPointData().getScalars().getData(),[u,m]=function(){let e=0,n=1;return 1===t.slicingMode?(e=0,n=2):0===t.slicingMode&&(e=1,n=2),[e,n]}(),h=[],p=[];let f=Math.round(t.slice);f>=l[t.slicingMode]&&(f=0);const v=[0,0,0];v[t.slicingMode]=f;for(let n=0;n<t.contourValues.length;++n){for(let i=0;i<l[m]-1;++i){v[m]=i;for(let i=0;i<l[u]-1;++i)v[u]=i,e.produceLines(t.contourValues[n],v,l,r,s,g,h,p,d,u,m)}a.initialize()}const w=b.Ay.newInstance();w.getPoints().setData(new Float32Array(h),3),w.getLines().setData(new Uint32Array(p)),i[0]=w,C("Produced output"),console.timeEnd("msquares")}}const T={contourValues:[],slicingMode:2,slice:0,mergePoints:!1};function L(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,T,n),S.m.obj(e,t),S.m.algo(e,t,1,1),S.m.setGet(e,t,["slicingMode","slice","mergePoints"]),S.m.algo(e,t,1,1),D(e,t)}var _={newInstance:S.m.newInstance(L,"vtkImageMarchingSquares"),extend:L},O=n(42008),V=n(58498),N=n(37546),U=n(46228),k=n(60199),B=n(60213);const{VoxelManager:F}=o.utilities,W={createVoxelManager:(e,t)=>F.createScalarVolumeVoxelManager({dimensions:e,scalarData:t}),createDataStructure:e=>{const{scalarData:t,dimensions:n,spacing:i,origin:o,direction:a}=e;return{voxelManager:W.createVoxelManager(n,t),dimensions:n,spacing:i,origin:o,direction:a,scalarData:t}},createVTKImageData:(e,t,n,i,o)=>{const a=V.Ay.newInstance();if(a.setDimensions(e),a.setOrigin(t),a.setDirection(n),a.setSpacing(i),!o)return a;const r=O.Ay.newInstance({name:"Scalars",numberOfComponents:1,values:o});return a.getPointData().setScalars(r),a},processSegmentStatistics:({segVoxelManager:e,imageVoxelManager:t,indices:n,bounds:i,imageData:o})=>{e.forEach(({value:e,pointIJK:i,pointLPS:o,index:a})=>{if(-1===n.indexOf(e))return;const s=t.getAtIndex(a);r.statsCallback({segmentIndex:e,value:s,pointIJK:i,pointLPS:o})},{boundsIJK:i||t.getDefaultBounds(),imageData:o})},performMarchingSquares:(e,t=null,n=null)=>{const i={};null!==t&&(i.slice=t),null!==n&&(i.slicingMode=n);const o=_.newInstance(i);return o.setInputData(e),o.setContourValues([1]),o.setMergePoints(!1),o.getOutputData()},createContoursFromPolyData:(e,t=null)=>{const n=(0,N.v)(e);if(n.points?.length){return{contours:(0,U.d1)(n.lines),polyData:n}}return null},createSegmentsFromIndices:e=>[null,...e.map(e=>({segmentIndex:e}))],getArgsFromInfo:e=>{const{segmentationInfo:t,imageInfo:n}=e;return{segmentation:t&&W.createDataStructure(t),image:n&&W.createDataStructure(n)}},calculateSegmentsStatisticsVolume:e=>{const{mode:t,indices:n,unit:i}=e,{segmentation:o,image:a}=W.getArgsFromInfo(e),{voxelManager:s,spacing:l}=o,{voxelManager:c}=a,d=W.createVTKImageData(o.dimensions,o.origin,o.direction,o.spacing);r.statsInit({storePointData:!1,indices:n,mode:t}),W.processSegmentStatistics({segVoxelManager:s,imageVoxelManager:c,indices:n,imageData:d});return r.getStatistics({spacing:l,mode:t,unit:i})},computeMetabolicStats({segmentationInfo:e,imageInfo:t}){const{scalarData:n,dimensions:i,spacing:o,origin:a,direction:r}=e,{spacing:s,dimensions:l,direction:c,origin:d,scalarData:g}=t,u=W.createVoxelManager(e.dimensions,e.scalarData),m=W.createVoxelManager(l,g);let h=0,p=0;const f=u.getScalarDataLength();for(let e=0;e<f;e++)0!==u.getAtIndex(e)&&(h+=m.getAtIndex(e),p++);return{tmtv:.001*p*o[0]*o[1]*o[2],tlg:(p>0?h/p:0)*p*s[0]*s[1]*s[2]*.001}},calculateSegmentsStatisticsStack:e=>{const{segmentationInfo:t,imageInfo:n,indices:i,mode:o}=e;r.statsInit({storePointData:!0,indices:i,mode:o});for(let e=0;e<t.length;e++){const o=t[e],a=n[e],r=[o.dimensions[0],o.dimensions[1],1],s=W.createVoxelManager(r,o.scalarData),l=W.createVoxelManager(r,a.scalarData),c=W.createVTKImageData(r,o.origin,o.direction,o.spacing);W.processSegmentStatistics({segVoxelManager:s,imageVoxelManager:l,indices:i,imageData:c})}const a=t[0].spacing;return r.getStatistics({spacing:a,mode:o})},getSegmentLargestBidirectionalInternal:e=>{const{segmentationInfo:t,imageInfo:n,indices:i,mode:o,isStack:a}=e;let r;return({segmentation:r}=a?W.getArgsFromInfo({segmentationInfo:t[0]}):W.getArgsFromInfo(e)),a?W.calculateBidirectionalStack({segmentationInfo:t,indices:i,mode:o}):W.calculateVolumetricBidirectional({segmentation:r,indices:i,mode:o})},findLargestBidirectionalFromContours:(e,t,n)=>{let i;for(const n of e){const e=(0,k.H)(n,t,i);e&&(i=e)}return i?{segmentIndex:n,majorAxis:i.majorAxis,minorAxis:i.minorAxis,maxMajor:i.maxMajor,maxMinor:i.maxMinor}:null},calculateBidirectionalStack:({segmentationInfo:e,indices:t,mode:n})=>{const i=W.createSegmentsFromIndices(t);let o=[];for(let t=0;t<e.length;t++){const n=e[t],a=n.dimensions,r=n.scalarData,{spacing:s,direction:l,origin:c}=n,d=W.createVoxelManager(a,r),g=a[0]*a[1];for(let e=1;e<i.length;e++){const t=i[e];if(!t)continue;const n=t.segmentIndex;if(W.isSliceEmptyForSegmentVolume(0,r,g,n))continue;const u=[],m=new Uint8Array(r.length);for(let e=0;e<r.length;e++)m[e]=r[e]===n?1:0;const h=O.Ay.newInstance({name:"Pixels",numberOfComponents:1,values:m}),p=W.createVTKImageData(a,c,l,[s[0],s[1],1]);p.getPointData().setScalars(h);try{const e=W.performMarchingSquares(p,null,2),t=W.createContoursFromPolyData(e);t&&u.push(t)}catch(e){console.warn(e)}const f=(0,B.On)({dimensions:a,imageData:p,voxelManager:d,segmentIndex:n}),v=W.findLargestBidirectionalFromContours(u,f,n);v&&o.push(v)}}return o},calculateVolumetricBidirectional:({segmentation:e,indices:t,mode:n})=>{const{voxelManager:i,dimensions:o,origin:a,direction:r,spacing:s}=e,l=W.createVTKImageData(o,a,r,s),c=W.generateContourSetsFromLabelmapVolume({segmentation:e,indices:t,imageData:l,mode:n}),d=[];for(let e=0;e<c.length;e++){const t=c[e],{segmentIndex:n}=t.segment,a=t.sliceContours,r=(0,B.On)({dimensions:o,imageData:l,voxelManager:i,segmentIndex:n}),s=W.findLargestBidirectionalFromContours(a,r,n);s&&d.push(s)}return d},generateContourSetsFromLabelmapVolume:e=>{const{segmentation:t,indices:n}=e,{dimensions:i,scalarData:o,origin:a,direction:r,spacing:s}=t;let l=e.imageData;l||(l=W.createVTKImageData(i,a,r,s));const c=i[2],d=i[0]*i[1],g=W.createSegmentsFromIndices(n);for(let e=0;e<c;e++)for(let t=0;t<i[1];t++){const n=t*i[0]+e*d;o[n]=0,o[n+i[0]-1]=0}const u=[],m=g.length;for(let e=0;e<m;e++){const t=g[e];if(!t)continue;const n=t.segmentIndex,i=[],a=O.Ay.newInstance({name:"Scalars",numberOfComponents:1,size:d*c,dataType:"Uint8Array"});for(let e=0;e<c;e++){if(W.isSliceEmptyForSegmentVolume(e,o,d,n))continue;const t=e*d;try{for(let e=0;e<d;e++){o[e+t]===n?a.setValue(e+t,1):a.setValue(e,0)}const r=V.Ay.newInstance();r.shallowCopy(l),r.getPointData().setScalars(a);const s=W.performMarchingSquares(r,e),c=W.createContoursFromPolyData(s,e);c&&i.push(c)}catch(t){console.warn(e),console.warn(t)}}const r={sliceContours:i,segment:t};u.push(r)}return u},isSliceEmptyForSegmentVolume:(e,t,n,i)=>{const o=e*n,a=o+n;for(let e=o;e<a;e++)if(t[e]===i)return!1;return!0}};(0,i.p)(W)},62612:(e,t,n)=>{n.d(t,{Ay:()=>i});var i={AttributeCopyOperations:{COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},AttributeLimitTypes:{MAX:0,EXACT:1,NOLIMIT:2},AttributeTypes:{SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},CellGhostTypes:{DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},DesiredOutputPrecision:{DEFAULT:0,SINGLE:1,DOUBLE:2},PointGhostTypes:{DUPLICATEPOINT:1,HIDDENPOINT:2},ghostArrayName:"vtkGhostType"}},58498:(e,t,n)=>{n.d(t,{Ay:()=>m});var i=n(28906),o=n(16632),a=n(21734),r=n(69147),s=n(24964),l=n(85278),c=n(3823);const{vtkErrorMacro:d}=i.m;const g={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:l.e.EMPTY};function u(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,g,n),r.Ay.extend(e,t,n),t.direction?Array.isArray(t.direction)&&(t.direction=new Float64Array(t.direction.slice(0,9))):t.direction=c.w0.identity(new Float64Array(9)),t.indexToWorld=new Float64Array(16),t.worldToIndex=new Float64Array(16),i.m.get(e,t,["indexToWorld","worldToIndex"]),i.m.setGetArray(e,t,["origin","spacing"],3),i.m.setGetArray(e,t,["direction"],9),i.m.getArray(e,t,["extent"],6),function(e,t){t.classHierarchy.push("vtkImageData"),e.setExtent=function(){if(t.deleted)return d("instance deleted - cannot call any method"),!1;for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];const a=1===i.length?i[0]:i;if(6!==a.length)return!1;const r=t.extent.some((e,t)=>e!==a[t]);return r&&(t.extent=a.slice(),t.dataDescription=s.A.getDataDescriptionFromExtent(t.extent),e.modified()),r},e.setDimensions=function(){let n,i,o;if(t.deleted)d("instance deleted - cannot call any method");else{if(1===arguments.length){const e=arguments.length<=0?void 0:arguments[0];n=e[0],i=e[1],o=e[2]}else{if(3!==arguments.length)return void d("Bad dimension specification");n=arguments.length<=0?void 0:arguments[0],i=arguments.length<=1?void 0:arguments[1],o=arguments.length<=2?void 0:arguments[2]}e.setExtent(0,n-1,0,i-1,0,o-1)}},e.getDimensions=()=>[t.extent[1]-t.extent[0]+1,t.extent[3]-t.extent[2]+1,t.extent[5]-t.extent[4]+1],e.getNumberOfCells=()=>{const t=e.getDimensions();let n=1;for(let e=0;e<3;e++){if(0===t[e])return 0;t[e]>1&&(n*=t[e]-1)}return n},e.getNumberOfPoints=()=>{const t=e.getDimensions();return t[0]*t[1]*t[2]},e.getPoint=n=>{const i=e.getDimensions();if(0===i[0]||0===i[1]||0===i[2])return d("Requesting a point from an empty image."),null;const o=new Float64Array(3);switch(t.dataDescription){case l.e.EMPTY:return null;case l.e.SINGLE_POINT:break;case l.e.X_LINE:o[0]=n;break;case l.e.Y_LINE:o[1]=n;break;case l.e.Z_LINE:o[2]=n;break;case l.e.XY_PLANE:o[0]=n%i[0],o[1]=n/i[0];break;case l.e.YZ_PLANE:o[1]=n%i[1],o[2]=n/i[1];break;case l.e.XZ_PLANE:o[0]=n%i[0],o[2]=n/i[0];break;case l.e.XYZ_GRID:o[0]=n%i[0],o[1]=n/i[0]%i[1],o[2]=n/(i[0]*i[1]);break;default:d("Invalid dataDescription")}const a=[0,0,0];return e.indexToWorld(o,a),a},e.getBounds=()=>e.extentToBounds(e.getSpatialExtent()),e.extentToBounds=e=>a.Ay.transformBounds(e,t.indexToWorld),e.getSpatialExtent=()=>a.Ay.inflate([...t.extent],.5),e.computeTransforms=()=>{c.pB.fromTranslation(t.indexToWorld,t.origin),t.indexToWorld[0]=t.direction[0],t.indexToWorld[1]=t.direction[1],t.indexToWorld[2]=t.direction[2],t.indexToWorld[4]=t.direction[3],t.indexToWorld[5]=t.direction[4],t.indexToWorld[6]=t.direction[5],t.indexToWorld[8]=t.direction[6],t.indexToWorld[9]=t.direction[7],t.indexToWorld[10]=t.direction[8],c.pB.scale(t.indexToWorld,t.indexToWorld,t.spacing),c.pB.invert(t.worldToIndex,t.indexToWorld)},e.indexToWorld=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c.eR.transformMat4(n,e,t.indexToWorld),n},e.indexToWorldVec3=e.indexToWorld,e.worldToIndex=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c.eR.transformMat4(n,e,t.worldToIndex),n},e.worldToIndexVec3=e.worldToIndex,e.indexToWorldBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return a.Ay.transformBounds(e,t.indexToWorld,n)},e.worldToIndexBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return a.Ay.transformBounds(e,t.worldToIndex,n)},e.onModified(e.computeTransforms),e.computeTransforms(),e.getCenter=()=>a.Ay.getCenter(e.getBounds()),e.computeHistogram=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=[0,0,0,0,0,0];e.worldToIndexBounds(t,i);const r=[0,0,0],s=[0,0,0];a.Ay.computeCornerPoints(i,r,s),(0,o.b)(r,r),(0,o.b)(s,s);const l=e.getDimensions();(0,o.c)(r,[0,0,0],[l[0]-1,l[1]-1,l[2]-1],r),(0,o.c)(s,[0,0,0],[l[0]-1,l[1]-1,l[2]-1],s);const c=l[0],d=l[0]*l[1],g=e.getPointData().getScalars().getData();let u=-1/0,m=1/0,h=0,p=0,f=0;for(let e=r[2];e<=s[2];e++)for(let t=r[1];t<=s[1];t++){let o=r[0]+t*c+e*d;for(let a=r[0];a<=s[0];a++){if(!n||n([a,t,e],i)){const e=g[o];e>u&&(u=e),e<m&&(m=e),h+=e*e,p+=e,f+=1}++o}}const v=f>0?p/f:0,w=f?Math.abs(h/f-v*v):0;return{minimum:m,maximum:u,average:v,variance:w,sigma:Math.sqrt(w),count:f}},e.computeIncrements=function(e){const t=[];let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let i=0;i<3;++i)t[i]=n,n*=e[2*i+1]-e[2*i]+1;return t},e.computeOffsetIndex=t=>{let[n,i,o]=t;const a=e.getExtent(),r=e.getPointData().getScalars().getNumberOfComponents(),s=e.computeIncrements(a,r);return Math.floor((Math.round(n)-a[0])*s[0]+(Math.round(i)-a[2])*s[1]+(Math.round(o)-a[4])*s[2])},e.getOffsetIndexFromWorld=t=>{const n=e.getExtent(),i=e.worldToIndex(t);for(let e=0;e<3;++e)if(i[e]<n[2*e]||i[e]>n[2*e+1])return d(`GetScalarPointer: Pixel ${i} is not in memory. Current extent = ${n}`),NaN;return e.computeOffsetIndex(i)},e.getScalarValueFromWorld=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e.getPointData().getScalars().getNumberOfComponents();if(n<0||n>=i)return d(`GetScalarPointer: Scalar Component ${n} is not within bounds. Current Scalar numberOfComponents: ${i}`),NaN;const o=e.getOffsetIndexFromWorld(t);return Number.isNaN(o)?o:e.getPointData().getScalars().getComponent(o,n)}}(e,t)}var m={newInstance:i.m.newInstance(u,"vtkImageData"),extend:u}},642:(e,t,n)=>{n.d(t,{Ay:()=>w});var i=n(28906),o=n(16632),a=n(80993),r=n(25128);const{ColorSpace:s,Scale:l}=r.Ay,{ScalarMappingTarget:c}=a.Ay,{vtkDebugMacro:d,vtkErrorMacro:g,vtkWarningMacro:u}=i.m;function m(e,t){const n=e[0],i=e[1],o=e[2],a=Math.sqrt(n*n+i*i+o*o),r=a>.001?Math.acos(n/a):0,s=r>.001?Math.atan2(o,i):0;t[0]=a,t[1]=r,t[2]=s}function h(e,t){if(e[0]>=t-.1)return e[2];const n=e[1]*Math.sqrt(t*t-e[0]*e[0])/(e[0]*Math.sin(e[1]));return e[2]>-.3*Math.PI?e[2]+n:e[2]-n}function p(e,t,n,i){const a=[],r=[];(0,o.N)(t,a),(0,o.N)(n,r);const s=[],l=[];m(a,s),m(r,l);let c=e;if(s[1]>.05&&l[1]>.05&&function(e,t){let n=e-t;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}(s[2],l[2])>.33*Math.PI){let t=Math.max(s[0],l[0]);t=Math.max(88,t),e<.5?(l[0]=t,l[1]=0,l[2]=0,c*=2):(s[0]=t,s[1]=0,s[2]=0,c=2*c-1)}s[1]<.05&&l[1]>.05?s[2]=h(l,s[0]):l[1]<.05&&s[1]>.05&&(l[2]=h(s,l[0]));const d=[];d[0]=(1-c)*s[0]+c*l[0],d[1]=(1-c)*s[1]+c*l[1],d[2]=(1-c)*s[2]+c*l[2];const g=[];!function(e,t){const n=e[0],i=e[1],o=e[2];t[0]=n*Math.cos(i),t[1]=n*Math.sin(i)*Math.cos(o),t[2]=n*Math.sin(i)*Math.sin(o)}(d,g),(0,o.O)(g,i)}const f={clamping:!0,colorSpace:s.RGB,hSVWrap:!0,scale:l.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,f,n),a.Ay.extend(e,t,n),t.table=[],t.nodes=[],t.nanColor=[.5,0,0,1],t.belowRangeColor=[0,0,0,1],t.aboveRangeColor=[1,1,1,1],t.buildTime={},i.m.obj(t.buildTime),i.m.get(e,t,["buildTime","mappingRange"]),i.m.setGet(e,t,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:s},{type:"enum",name:"scale",enum:l}]),i.m.setArray(e,t,["nanColor","belowRangeColor","aboveRangeColor"],4),i.m.getArray(e,t,["nanColor","belowRangeColor","aboveRangeColor"]),function(e,t){t.classHierarchy.push("vtkColorTransferFunction"),e.getSize=()=>t.nodes.length,e.addRGBPoint=(t,n,i,o)=>e.addRGBPointLong(t,n,i,o,.5,0),e.addRGBPointLong=function(n,i,o,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(r<0||r>1)return g("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return g("Sharpness outside range [0.0, 1.0]"),-1;t.allowDuplicateScalars||e.removePoint(n);const l={x:n,r:i,g:o,b:a,midpoint:r,sharpness:s};t.nodes.push(l),e.sortAndUpdateRange();let c=0;for(;c<t.nodes.length&&t.nodes[c].x!==n;c++);return c<t.nodes.length?c:-1},e.addHSVPoint=(t,n,i,o)=>e.addHSVPointLong(t,n,i,o,.5,0),e.addHSVPointLong=function(t,n,i,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const l=[],c=[n,i,a];return(0,o.h)(c,l),e.addRGBPoint(t,l[0],l[1],l[2],r,s)},e.setNodes=n=>{if(t.nodes!==n){const i=JSON.stringify(t.nodes);t.nodes=n;const o=JSON.stringify(t.nodes);if(e.sortAndUpdateRange()||i!==o)return e.modified(),!0}return!1},e.sortAndUpdateRange=()=>{const n=JSON.stringify(t.nodes);t.nodes.sort((e,t)=>e.x-t.x);const i=JSON.stringify(t.nodes),o=e.updateRange();return o||n===i?o:(e.modified(),!0)},e.updateRange=()=>{const n=[2];n[0]=t.mappingRange[0],n[1]=t.mappingRange[1];const i=t.nodes.length;return i?(t.mappingRange[0]=t.nodes[0].x,t.mappingRange[1]=t.nodes[i-1].x):(t.mappingRange[0]=0,t.mappingRange[1]=0),(n[0]!==t.mappingRange[0]||n[1]!==t.mappingRange[1])&&(e.modified(),!0)},e.removePoint=n=>{let i=0;for(;i<t.nodes.length&&t.nodes[i].x!==n;i++);const o=i;if(i>=t.nodes.length)return-1;let a=!1;return t.nodes.splice(i,1),0!==i&&i!==t.nodes.length||(a=e.updateRange()),a||e.modified(),o},e.movePoint=(n,i)=>{if(n!==i){e.removePoint(i);for(let o=0;o<t.nodes.length;o++)if(t.nodes[o].x===n){t.nodes[o].x=i,e.sortAndUpdateRange();break}}},e.removeAllPoints=()=>{t.nodes=[],e.sortAndUpdateRange()},e.addRGBSegment=(n,i,o,a,r,s,l,c)=>{e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n&&t.nodes[e].x<=r?t.nodes.splice(e,1):e++;e.addRGBPointLong(n,i,o,a,.5,0),e.addRGBPointLong(r,s,l,c,.5,0),e.modified()},e.addHSVSegment=(t,n,i,a,r,s,l,c)=>{const d=[n,i,a],g=[s,l,c],u=[],m=[];(0,o.h)(d,u),(0,o.h)(g,m),e.addRGBSegment(t,u[0],u[1],u[2],r,m[0],m[1],m[2])},e.mapValue=t=>{const n=[];return e.getColor(t,n),[Math.floor(255*n[0]+.5),Math.floor(255*n[1]+.5),Math.floor(255*n[2]+.5),255]},e.getColor=(n,i)=>{if(t.indexedLookup){const t=e.getSize(),o=e.getAnnotatedValueIndexInternal(n);if(o<0||0===t){const t=e.getNanColorByReference();i[0]=t[0],i[1]=t[1],i[2]=t[2]}else{const n=[];e.getNodeValue(o%t,n),i[0]=n[1],i[1]=n[2],i[2]=n[3]}return}e.getTable(n,n,1,i)},e.getRedValue=t=>{const n=[];return e.getColor(t,n),n[0]},e.getGreenValue=t=>{const n=[];return e.getColor(t,n),n[1]},e.getBlueValue=t=>{const n=[];return e.getColor(t,n),n[2]},e.getTable=(n,i,a,r)=>{const c=Number(n),d=Number(i);if((0,o.i)(c)||(0,o.i)(d)){for(let e=0;e<a;e++)r[3*e+0]=t.nanColor[0],r[3*e+1]=t.nanColor[1],r[3*e+2]=t.nanColor[2];return}let u=0;const m=t.nodes.length;let h=0,f=0,v=0;0!==m&&(h=t.nodes[m-1].r,f=t.nodes[m-1].g,v=t.nodes[m-1].b);let w=0,I=0,A=0;const S=[0,0,0],b=[0,0,0];let y=0,R=0;const x=[];let M=t.scale===l.LOG10;M&&(M=t.mappingRange[0]>0);let E=0,P=0,C=0;M&&(E=Math.log10(c),P=Math.log10(d));for(let n=0;n<a;n++){const i=3*n;if(a>1?M?(C=E+n/(a-1)*(P-E),w=10**C):w=c+n/(a-1)*(d-c):M?(C=.5*(E+P),w=10**C):w=.5*(c+d),t.discretize){const e=t.mappingRange;if(w>=e[0]&&w<=e[1]){const n=t.numberOfValues,i=e[1]-e[0];if(n<=1)w=e[0]+i/2;else{const t=(w-e[0])/i,a=(0,o.K)(n*t);w=e[0]+a/(n-1)*i}}}for(;u<m&&w>t.nodes[u].x;)u++,u<m&&(I=t.nodes[u-1].x,A=t.nodes[u].x,M&&(I=Math.log10(I),A=Math.log10(A)),S[0]=t.nodes[u-1].r,b[0]=t.nodes[u].r,S[1]=t.nodes[u-1].g,b[1]=t.nodes[u].g,S[2]=t.nodes[u-1].b,b[2]=t.nodes[u].b,y=t.nodes[u-1].midpoint,R=t.nodes[u-1].sharpness,y<1e-5&&(y=1e-5),y>.99999&&(y=.99999));if(w>t.mappingRange[1])r[i]=0,r[i+1]=0,r[i+2]=0,t.clamping&&(e.getUseAboveRangeColor()?(r[i]=t.aboveRangeColor[0],r[i+1]=t.aboveRangeColor[1],r[i+2]=t.aboveRangeColor[2]):(r[i]=h,r[i+1]=f,r[i+2]=v));else if(w<t.mappingRange[0]||(0,o.L)(w)&&w<0)r[i]=0,r[i+1]=0,r[i+2]=0,t.clamping&&(e.getUseBelowRangeColor()?(r[i]=t.belowRangeColor[0],r[i+1]=t.belowRangeColor[1],r[i+2]=t.belowRangeColor[2]):m>0&&(r[i]=t.nodes[0].r,r[i+1]=t.nodes[0].g,r[i+2]=t.nodes[0].b));else if(0===u&&(Math.abs(w-c)<1e-6||t.discretize))m>0?(r[i]=t.nodes[0].r,r[i+1]=t.nodes[0].g,r[i+2]=t.nodes[0].b):(r[i]=0,r[i+1]=0,r[i+2]=0);else{let e=0;if(e=M?(C-I)/(A-I):(w-I)/(A-I),e=e<y?.5*e/y:.5+.5*(e-y)/(1-y),R>.99){if(e<.5){r[i]=S[0],r[i+1]=S[1],r[i+2]=S[2];continue}r[i]=b[0],r[i+1]=b[1],r[i+2]=b[2];continue}if(R<.01){if(t.colorSpace===s.RGB)r[i]=(1-e)*S[0]+e*b[0],r[i+1]=(1-e)*S[1]+e*b[1],r[i+2]=(1-e)*S[2]+e*b[2];else if(t.colorSpace===s.HSV){const n=[],a=[];(0,o.M)(S,n),(0,o.M)(b,a),t.hSVWrap&&(n[0]-a[0]>.5||a[0]-n[0]>.5)&&(n[0]>a[0]?n[0]-=1:a[0]-=1);const s=[];s[0]=(1-e)*n[0]+e*a[0],s[0]<0&&(s[0]+=1),s[1]=(1-e)*n[1]+e*a[1],s[2]=(1-e)*n[2]+e*a[2],(0,o.h)(s,x),r[i]=x[0],r[i+1]=x[1],r[i+2]=x[2]}else if(t.colorSpace===s.LAB){const t=[],n=[];(0,o.N)(S,t),(0,o.N)(b,n);const a=[];a[0]=(1-e)*t[0]+e*n[0],a[1]=(1-e)*t[1]+e*n[1],a[2]=(1-e)*t[2]+e*n[2],(0,o.O)(a,x),r[i]=x[0],r[i+1]=x[1],r[i+2]=x[2]}else t.colorSpace===s.DIVERGING?(p(e,S,b,x),r[i]=x[0],r[i+1]=x[1],r[i+2]=x[2]):g("ColorSpace set to invalid value.",t.colorSpace);continue}e<.5?e=.5*(2*e)**(1+10*R):e>.5&&(e=1-.5*(2*(1-e))**(1+10*R));const n=e*e,a=n*e,l=2*a-3*n+1,c=-2*a+3*n,d=a-2*n+e,u=a-n;let m,h;if(t.colorSpace===s.RGB)for(let e=0;e<3;e++)m=b[e]-S[e],h=(1-R)*m,r[i+e]=l*S[e]+c*b[e]+d*h+u*h;else if(t.colorSpace===s.HSV){const e=[],n=[];(0,o.M)(S,e),(0,o.M)(b,n),t.hSVWrap&&(e[0]-n[0]>.5||n[0]-e[0]>.5)&&(e[0]>n[0]?e[0]-=1:n[0]-=1);const a=[];for(let t=0;t<3;t++)m=n[t]-e[t],h=(1-R)*m,a[t]=l*e[t]+c*n[t]+d*h+u*h,0===t&&a[t]<0&&(a[t]+=1);(0,o.h)(a,x),r[i]=x[0],r[i+1]=x[1],r[i+2]=x[2]}else if(t.colorSpace===s.LAB){const e=[],t=[];(0,o.N)(S,e),(0,o.N)(b,t);const n=[];for(let i=0;i<3;i++)m=t[i]-e[i],h=(1-R)*m,n[i]=l*e[i]+c*t[i]+d*h+u*h;(0,o.O)(n,x),r[i]=x[0],r[i+1]=x[1],r[i+2]=x[2]}else t.colorSpace===s.DIVERGING?(p(e,S,b,x),r[i]=x[0],r[i+1]=x[1],r[i+2]=x[2]):g("ColorSpace set to invalid value.");for(let e=0;e<3;e++)r[i+e]=r[i+e]<0?0:r[i+e],r[i+e]=r[i+e]>1?1:r[i+e]}}},e.getUint8Table=function(n,i,o){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.getMTime()<=t.buildTime&&t.tableSize===o&&t.tableWithAlpha!==a)return t.table;if(0===t.nodes.length)return g("Attempting to lookup a value with no points in the function"),t.table;const r=a?4:3;t.tableSize===o&&t.tableWithAlpha===a||(t.table=new Uint8Array(o*r),t.tableSize=o,t.tableWithAlpha=a);const s=[];e.getTable(n,i,o,s);for(let e=0;e<o;e++)t.table[e*r+0]=Math.floor(255*s[3*e+0]+.5),t.table[e*r+1]=Math.floor(255*s[3*e+1]+.5),t.table[e*r+2]=Math.floor(255*s[3*e+2]+.5),a&&(t.table[e*r+3]=255);return t.buildTime.modified(),t.table},e.buildFunctionFromArray=n=>{e.removeAllPoints();const i=n.getNumberOfComponents();for(let e=0;e<n.getNumberOfTuples();e++)switch(i){case 3:t.nodes.push({x:e,r:n.getComponent(e,0),g:n.getComponent(e,1),b:n.getComponent(e,2),midpoint:.5,sharpness:0});break;case 4:t.nodes.push({x:n.getComponent(e,0),r:n.getComponent(e,1),g:n.getComponent(e,2),b:n.getComponent(e,3),midpoint:.5,sharpness:0});break;case 5:t.nodes.push({x:e,r:n.getComponent(e,0),g:n.getComponent(e,1),b:n.getComponent(e,2),midpoint:n.getComponent(e,4),sharpness:n.getComponent(e,5)});break;case 6:t.nodes.push({x:n.getComponent(e,0),r:n.getComponent(e,1),g:n.getComponent(e,2),b:n.getComponent(e,3),midpoint:n.getComponent(e,4),sharpness:n.getComponent(e,5)})}e.sortAndUpdateRange()},e.buildFunctionFromTable=(n,i,o,a)=>{let r=0;e.removeAllPoints(),o>1&&(r=(i-n)/(o-1));for(let e=0;e<o;e++){const i={x:n+r*e,r:a[3*e],g:a[3*e+1],b:a[3*e+2],sharpness:0,midpoint:.5};t.nodes.push(i)}e.sortAndUpdateRange()},e.getNodeValue=(e,n)=>e<0||e>=t.nodes.length?(g("Index out of range!"),-1):(n[0]=t.nodes[e].x,n[1]=t.nodes[e].r,n[2]=t.nodes[e].g,n[3]=t.nodes[e].b,n[4]=t.nodes[e].midpoint,n[5]=t.nodes[e].sharpness,1),e.setNodeValue=(n,i)=>{if(n<0||n>=t.nodes.length)return g("Index out of range!"),-1;const o=t.nodes[n].x;return t.nodes[n].x=i[0],t.nodes[n].r=i[1],t.nodes[n].g=i[2],t.nodes[n].b=i[3],t.nodes[n].midpoint=i[4],t.nodes[n].sharpness=i[5],o!==i[0]?e.sortAndUpdateRange():e.modified(),1},e.getNumberOfAvailableColors=()=>{if(t.indexedLookup&&e.getSize())return e.getSize();if(t.tableSize)return t.tableSize;const n=t.nodes?.length??0;return Math.max(4094,n)},e.getIndexedColor=(t,n)=>{const i=e.getSize();if(i>0&&t>=0){const o=[];e.getNodeValue(t%i,o);for(let e=0;e<3;++e)n[e]=o[e+1];return void(n[3]=1)}const o=e.getNanColorByReference();n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=1},e.fillFromDataPointer=(t,n)=>{if(!(t<=0)&&n){e.removeAllPoints();for(let i=0;i<t;i++)e.addRGBPoint(n[4*i],n[4*i+1],n[4*i+2],n[4*i+3])}},e.setMappingRange=(n,i)=>{const o=[n,i],a=e.getRange();if(a[1]===o[1]&&a[0]===o[0])return;if(o[1]===o[0])return void g("attempt to set zero width color range");const r=(o[1]-o[0])/(a[1]-a[0]),s=o[0]-a[0]*r;for(let e=0;e<t.nodes.length;++e)t.nodes[e].x=t.nodes[e].x*r+s;t.mappingRange[0]=o[0],t.mappingRange[1]=o[1],e.modified()},e.adjustRange=n=>{const i=e.getRange(),o=[];i[0]<n[0]?(e.getColor(n[0],o),e.addRGBPoint(n[0],o[0],o[1],o[2])):(e.getColor(i[0],o),e.addRGBPoint(n[0],o[0],o[1],o[2])),i[1]>n[1]?(e.getColor(n[1],o),e.addRGBPoint(n[1],o[0],o[1],o[2])):(e.getColor(i[1],o),e.addRGBPoint(n[1],o[0],o[1],o[2])),e.sortAndUpdateRange();for(let e=0;e<t.nodes.length;)t.nodes[e].x>=n[0]&&t.nodes[e].x<=n[1]?t.nodes.splice(e,1):++e;return 1},e.estimateMinNumberOfSamples=(t,n)=>{const i=e.findMinimumXDistance();return Math.ceil((n-t)/i)},e.findMinimumXDistance=()=>{if(t.nodes.length<2)return-1;let e=Number.MAX_VALUE;for(let n=0;n<t.nodes.length-1;n++){const i=t.nodes[n+1].x-t.nodes[n].x;i<e&&(e=i)}return e},e.mapScalarsThroughTable=(n,i,o,a)=>{0!==e.getSize()?t.indexedLookup?e.mapDataIndexed(n,i,o,a):e.mapData(n,i,o,a):d("Transfer Function Has No Points!")},e.mapData=(t,n,i,o)=>{if(0===e.getSize())return void u("Transfer Function Has No Points!");const a=Math.floor(255*e.getAlpha()+.5),r=t.getNumberOfTuples(),s=t.getNumberOfComponents(),l=n.getData(),d=t.getData(),g=[];if(i===c.RGBA)for(let t=0;t<r;t++){const n=d[t*s+o];e.getColor(n,g),l[4*t]=Math.floor(255*g[0]+.5),l[4*t+1]=Math.floor(255*g[1]+.5),l[4*t+2]=Math.floor(255*g[2]+.5),l[4*t+3]=a}if(i===c.RGB)for(let t=0;t<r;t++){const n=d[t*s+o];e.getColor(n,g),l[3*t]=Math.floor(255*g[0]+.5),l[3*t+1]=Math.floor(255*g[1]+.5),l[3*t+2]=Math.floor(255*g[2]+.5)}if(i===c.LUMINANCE)for(let t=0;t<r;t++){const n=d[t*s+o];e.getColor(n,g),l[t]=Math.floor(76.5*g[0]+150.45*g[1]+28.05*g[2]+.5)}if(i===c.LUMINANCE_ALPHA)for(let t=0;t<r;t++){const n=d[t*s+o];e.getColor(n,g),l[2*t]=Math.floor(76.5*g[0]+150.45*g[1]+28.05*g[2]+.5),l[2*t+1]=a}},e.applyColorMap=n=>{const i=JSON.stringify(t.colorSpace);n.ColorSpace&&(t.colorSpace=s[n.ColorSpace.toUpperCase()],void 0===t.colorSpace&&(g(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),t.colorSpace=s.RGB));let o=i!==JSON.stringify(t.colorSpace);const a=o||JSON.stringify(t.nanColor);if(n.NanColor)for(t.nanColor=[].concat(n.NanColor);t.nanColor.length<4;)t.nanColor.push(1);o=o||a!==JSON.stringify(t.nanColor);const r=o||JSON.stringify(t.nodes);if(n.RGBPoints){const e=n.RGBPoints.length;t.nodes=[];const i=.5,o=0;for(let a=0;a<e;a+=4)t.nodes.push({x:n.RGBPoints[a],r:n.RGBPoints[a+1],g:n.RGBPoints[a+2],b:n.RGBPoints[a+3],midpoint:i,sharpness:o})}const l=e.sortAndUpdateRange(),c=!l&&(o||r!==JSON.stringify(t.nodes));return c&&e.modified(),l||c}}(e,t)}var w={newInstance:i.m.newInstance(v,"vtkColorTransferFunction"),extend:v,...r.Ay}},9175:(e,t,n)=>{n.r(t),n.d(t,{add:()=>d,angle:()=>B,bezier:()=>T,ceil:()=>h,clone:()=>a,copy:()=>l,create:()=>o,cross:()=>P,dist:()=>K,distance:()=>S,div:()=>$,divide:()=>m,dot:()=>E,equals:()=>j,exactEquals:()=>G,floor:()=>p,forEach:()=>X,fromValues:()=>s,hermite:()=>D,inverse:()=>x,len:()=>Y,length:()=>r,lerp:()=>C,max:()=>v,min:()=>f,mul:()=>H,multiply:()=>u,negate:()=>R,normalize:()=>M,random:()=>L,rotateX:()=>N,rotateY:()=>U,rotateZ:()=>k,round:()=>w,scale:()=>I,scaleAndAdd:()=>A,set:()=>c,sqrDist:()=>Z,sqrLen:()=>J,squaredDistance:()=>b,squaredLength:()=>y,str:()=>W,sub:()=>z,subtract:()=>g,transformMat3:()=>O,transformMat4:()=>_,transformQuat:()=>V,zero:()=>F});var i=n(24457);function o(){var e=new i.ARRAY_TYPE(3);return i.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function a(e){var t=new i.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function r(e){var t=e[0],n=e[1],i=e[2];return Math.hypot(t,n,i)}function s(e,t,n){var o=new i.ARRAY_TYPE(3);return o[0]=e,o[1]=t,o[2]=n,o}function l(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function c(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}function d(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function g(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function u(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function m(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function h(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function p(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function f(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function v(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function w(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function I(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function A(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function S(e,t){var n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return Math.hypot(n,i,o)}function b(e,t){var n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return n*n+i*i+o*o}function y(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function R(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function x(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function M(e,t){var n=t[0],i=t[1],o=t[2],a=n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function E(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function P(e,t,n){var i=t[0],o=t[1],a=t[2],r=n[0],s=n[1],l=n[2];return e[0]=o*l-a*s,e[1]=a*r-i*l,e[2]=i*s-o*r,e}function C(e,t,n,i){var o=t[0],a=t[1],r=t[2];return e[0]=o+i*(n[0]-o),e[1]=a+i*(n[1]-a),e[2]=r+i*(n[2]-r),e}function D(e,t,n,i,o,a){var r=a*a,s=r*(2*a-3)+1,l=r*(a-2)+a,c=r*(a-1),d=r*(3-2*a);return e[0]=t[0]*s+n[0]*l+i[0]*c+o[0]*d,e[1]=t[1]*s+n[1]*l+i[1]*c+o[1]*d,e[2]=t[2]*s+n[2]*l+i[2]*c+o[2]*d,e}function T(e,t,n,i,o,a){var r=1-a,s=r*r,l=a*a,c=s*r,d=3*a*s,g=3*l*r,u=l*a;return e[0]=t[0]*c+n[0]*d+i[0]*g+o[0]*u,e[1]=t[1]*c+n[1]*d+i[1]*g+o[1]*u,e[2]=t[2]*c+n[2]*d+i[2]*g+o[2]*u,e}function L(e,t){t=t||1;var n=2*i.RANDOM()*Math.PI,o=2*i.RANDOM()-1,a=Math.sqrt(1-o*o)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=o*t,e}function _(e,t,n){var i=t[0],o=t[1],a=t[2],r=n[3]*i+n[7]*o+n[11]*a+n[15];return r=r||1,e[0]=(n[0]*i+n[4]*o+n[8]*a+n[12])/r,e[1]=(n[1]*i+n[5]*o+n[9]*a+n[13])/r,e[2]=(n[2]*i+n[6]*o+n[10]*a+n[14])/r,e}function O(e,t,n){var i=t[0],o=t[1],a=t[2];return e[0]=i*n[0]+o*n[3]+a*n[6],e[1]=i*n[1]+o*n[4]+a*n[7],e[2]=i*n[2]+o*n[5]+a*n[8],e}function V(e,t,n){var i=n[0],o=n[1],a=n[2],r=n[3],s=t[0],l=t[1],c=t[2],d=o*c-a*l,g=a*s-i*c,u=i*l-o*s,m=o*u-a*g,h=a*d-i*u,p=i*g-o*d,f=2*r;return d*=f,g*=f,u*=f,m*=2,h*=2,p*=2,e[0]=s+d+m,e[1]=l+g+h,e[2]=c+u+p,e}function N(e,t,n,i){var o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],a[0]=o[0],a[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),a[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function U(e,t,n,i){var o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],a[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),a[1]=o[1],a[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function k(e,t,n,i){var o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],a[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),a[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),a[2]=o[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function B(e,t){var n=e[0],i=e[1],o=e[2],a=t[0],r=t[1],s=t[2],l=Math.sqrt(n*n+i*i+o*o)*Math.sqrt(a*a+r*r+s*s),c=l&&E(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function F(e){return e[0]=0,e[1]=0,e[2]=0,e}function W(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function G(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function j(e,t){var n=e[0],o=e[1],a=e[2],r=t[0],s=t[1],l=t[2];return Math.abs(n-r)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(o-s)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(a-l)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))}var q,z=g,H=u,$=m,K=S,Z=b,Y=r,J=y,X=(q=o(),function(e,t,n,i,o,a){var r,s;for(t||(t=3),n||(n=0),s=i?Math.min(i*t+n,e.length):e.length,r=n;r<s;r+=t)q[0]=e[r],q[1]=e[r+1],q[2]=e[r+2],o(q,q,a),e[r]=q[0],e[r+1]=q[1],e[r+2]=q[2];return e})},44779:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(43183);function o(){return(0,i.A)(arguments)}},20919:(e,t,n)=>{function i(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}n.d(t,{A:()=>i})}}]);
//# sourceMappingURL=3791.bundle.f2df8107bcb4f46f3fed.js.map