/*! For license information please see 1443.bundle.e47597af1d8373dc1d43.js.LICENSE.txt */
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[1443],{34279:(e,t,n)=>{"use strict";n.d(t,{fX:()=>s,X6:()=>ra,f_:()=>ia,ql:()=>aa,QX:()=>na,_$:()=>c});var a={};n.r(a),n.d(a,{fillSegmentation:()=>et,generateSegmentation:()=>Je,generateToolState:()=>Ze});var r={};n.r(r),n.d(r,{createFromDICOMSegBuffer:()=>_n,generateLabelMaps2DFrom3D:()=>mn,generateSegmentation:()=>ln,generateToolState:()=>vn});var i={};n.r(i),n.d(i,{generateToolState:()=>Fn});var o={};n.r(o),n.d(o,{generateContourSetsFromLabelmap:()=>Hn,generateRTSSFromAnnotations:()=>zn,generateRTSSFromSegmentations:()=>Bn});var s={};n.r(s),n.d(s,{s:()=>Ee});var c={};n.r(c),n.d(c,{vk:()=>sa});var u=n(5842);const d=e=>Array.isArray(e)?e:[e],l=e=>t=>t.ConceptNameCodeSequence.CodeMeaning===e;var m=n(81429);const{TID1500:g,addAccessors:p}=u.BF,{StructuredReport:f}=u.h4,{Normalizer:S}=u.z8,{TID1500MeasurementReport:h,TID1501MeasurementGroup:I}=g,{DicomMetaDictionary:O}=u.p,D={CodingSchemeDesignator:"DCM",CodeValue:"121071"},T={CodingSchemeDesignator:"SCT",CodeValue:"363698007"},R={CodingSchemeDesignator:"SRT",CodeValue:"G-C0E3"},C=(e,t,n)=>{const{ConceptNameCodeSequence:a}=e;if(!a)return;const{CodingSchemeDesignator:r,CodeValue:i}=a;return r==t.CodingSchemeDesignator&&i==t.CodeValue||n&&r==n.CodingSchemeDesignator&&i==n.CodeValue};function y(e,t,n){const a=t[e],r=E.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[e];if(!(a&&a.data&&a.data.length&&r))return;const i=a.data.map(e=>function(e,t,n){const a=n.getTID300RepresentationArguments(e);return a.ReferencedSOPSequence=t,new n.TID300Representation(a)}(e,n,r));return new I(i)}class E{static getSetupMeasurementData(e){const{ContentSequence:t}=e,n=d(t),a=n.find(e=>C(e,D)),r=n.filter(e=>C(e,T,R))||[],i=n.find(e=>"NUM"===e.ValueType),o=d(i.ContentSequence).find(e=>"SCOORD"===e.ValueType),{ReferencedSOPSequence:s}=o.ContentSequence,{ReferencedSOPInstanceUID:c,ReferencedFrameNumber:u}=s,l={sopInstanceUid:c,frameIndex:u||1,complete:!0,finding:a?p(a.ConceptCodeSequence):void 0,findingSites:r.map(e=>p(e.ConceptCodeSequence))};l.finding&&(l.description=l.finding.CodeMeaning);const m=l.findingSites&&l.findingSites[0];return m&&(l.location=m[0]&&m[0].CodeMeaning||m.CodeMeaning),{defaultState:l,findingGroup:a,findingSiteGroups:r,NUMGroup:i,SCOORDGroup:o,ReferencedSOPSequence:s,ReferencedSOPInstanceUID:c,ReferencedFrameNumber:u}}static generateReport(e,t,n){let a=[];const r=Object.keys(e)[0];if(!r)throw new Error("No measurements provided.");const i=t.get("generalSeriesModule",r),{studyInstanceUID:o,seriesInstanceUID:s}=i;Object.keys(e).forEach(n=>{const r=t.get("sopCommonModule",n),i=t.get("frameNumber",n),o=e[n],s=Object.keys(o),c={ReferencedSOPClassUID:r.sopClassUID,ReferencedSOPInstanceUID:r.sopInstanceUID};S.isMultiframeSOPClassUID(r.sopClassUID)&&(c.ReferencedFrameNumber=i);const u=[];s.forEach(e=>{const t=y(e,o,c);t&&u.push(t)}),a=a.concat(u)});const c=new h({TID1501MeasurementGroups:a},n),u=new Uint8Array(2);u[1]=1;const d={StudyInstanceUID:o,SeriesInstanceUID:s},l={FileMetaInformationVersion:{Value:[u.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[O.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}};d._meta=l,d._vrMap={PixelData:"OW"};const m=new f([d]),g=c.contentItem(d);return m.dataset=Object.assign(m.dataset,g),m.dataset._meta=l,m.dataset.SpecificCharacterSet="ISO_IR 192",m}static generateToolState(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("1500"!==e.ContentTemplateSequence.TemplateIdentifier)throw new Error("This package can currently only interpret DICOM SR TID 1500");const n=d(e.ContentSequence).find(l("Imaging Measurements")),a=d(n.ContentSequence).filter(l("Measurement Group")),r={},i=E.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE,o=[];return Object.keys(i).forEach(e=>{o.push(i[e]),r[e]=[]}),a.forEach(n=>{const a=d(n.ContentSequence).find(e=>"Tracking Identifier"===e.ConceptNameCodeSequence.CodeMeaning).TextValue,i=t.getToolClass?t.getToolClass(n,e,o):o.find(e=>e.isValidCornerstoneTrackingIdentifier(a));if(i){const e=i.getMeasurementData(n);console.log(`=== ${i.toolType} ===`),console.log(e),r[i.toolType].push(e)}}),r}static registerTool(e){E.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE[e.utilityToolType]=e,E.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[e.toolType]=e,E.MEASUREMENT_BY_TOOLTYPE[e.toolType]=e.utilityToolType}}E.MEASUREMENT_BY_TOOLTYPE={},E.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE={},E.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE={};var x="cornerstoneTools@^4.0.0";const{Length:M}=u.BF.TID300,N="Length";class A{static getMeasurementData(e){const{defaultState:t,NUMGroup:n,SCOORDGroup:a}=E.getSetupMeasurementData(e),r={...t,length:n.MeasuredValueSequence.NumericValue,toolType:A.toolType,handles:{start:{},end:{},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};return[r.handles.start.x,r.handles.start.y,r.handles.end.x,r.handles.end.y]=a.GraphicData,r}static getTID300RepresentationArguments(e){const{handles:t,finding:n,findingSites:a}=e;return{point1:t.start,point2:t.end,distance:e.length,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Length",finding:n,findingSites:a||[]}}}A.toolType=N,A.utilityToolType=N,A.TID300Representation=M,A.isValidCornerstoneTrackingIdentifier=e=>{if(!e.includes(":"))return!1;const[t,n]=e.split(":");return t===x&&n===N},E.registerTool(A);const{Polyline:P}=u.BF.TID300;class v{static getMeasurementData(e){const{defaultState:t,SCOORDGroup:n,NUMGroup:a}=E.getSetupMeasurementData(e),r={...t,toolType:v.toolType,handles:{points:[],textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},cachedStats:{area:a?a.MeasuredValueSequence.NumericValue:0},color:void 0,invalidated:!0},{GraphicData:i}=n;for(let e=0;e<i.length;e+=2)r.handles.points.push({x:i[e],y:i[e+1]});return r}static getTID300RepresentationArguments(e){const{handles:t,finding:n,findingSites:a,cachedStats:r={}}=e,{points:i}=t,{area:o=0,perimeter:s=0}=r;return{points:i,area:o,perimeter:s,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:FreehandRoi",finding:n,findingSites:a||[]}}}v.toolType="FreehandRoi",v.utilityToolType="FreehandRoi",v.TID300Representation=P,v.isValidCornerstoneTrackingIdentifier=e=>{if(!e.includes(":"))return!1;const[t,n]=e.split(":");return t===x&&n===v.toolType},E.registerTool(v);const{Bidirectional:_}=u.BF.TID300,w="Bidirectional";class b{static getMeasurementData(e){const{ContentSequence:t}=e,n=d(t).find(e=>"121071"===e.ConceptNameCodeSequence.CodeValue),a=d(t).filter(e=>"G-C0E3"===e.ConceptNameCodeSequence.CodeValue),r=d(t).find(e=>"Long Axis"===e.ConceptNameCodeSequence.CodeMeaning),i=d(r.ContentSequence).find(e=>"SCOORD"===e.ValueType),o=d(t).find(e=>"Short Axis"===e.ConceptNameCodeSequence.CodeMeaning),s=d(o.ContentSequence).find(e=>"SCOORD"===e.ValueType),{ReferencedSOPSequence:c}=i.ContentSequence,{ReferencedSOPInstanceUID:u,ReferencedFrameNumber:l}=c,m=String(r.MeasuredValueSequence.NumericValue),g=String(o.MeasuredValueSequence.NumericValue),p=Math.max(i.GraphicData[0],i.GraphicData[2],s.GraphicData[0],s.GraphicData[2]),f=Math.max(i.GraphicData[1],i.GraphicData[3],s.GraphicData[1],s.GraphicData[3]);return{sopInstanceUid:u,frameIndex:l||1,toolType:b.toolType,active:!1,handles:{start:{x:i.GraphicData[0],y:i.GraphicData[1],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:0},end:{x:i.GraphicData[2],y:i.GraphicData[3],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:1},perpendicularStart:{x:s.GraphicData[0],y:s.GraphicData[1],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:2},perpendicularEnd:{x:s.GraphicData[2],y:s.GraphicData[3],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:3},textBox:{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0,x:p+10,y:f+10}},invalidated:!1,isCreating:!1,longestDiameter:m,shortestDiameter:g,toolName:"Bidirectional",visible:!0,finding:n?n.ConceptCodeSequence:void 0,findingSites:a.map(e=>e.ConceptCodeSequence)}}static getTID300RepresentationArguments(e){const{start:t,end:n,perpendicularStart:a,perpendicularEnd:r}=e.handles,{shortestDiameter:i,longestDiameter:o,finding:s,findingSites:c}=e;return{longAxis:{point1:t,point2:n},shortAxis:{point1:a,point2:r},longAxisLength:o,shortAxisLength:i,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Bidirectional",finding:s,findingSites:c||[]}}}b.toolType=w,b.utilityToolType=w,b.TID300Representation=_,b.isValidCornerstoneTrackingIdentifier=e=>{if(!e.includes(":"))return!1;const[t,n]=e.split(":");return t===x&&n===w},E.registerTool(b);const{Ellipse:F}=u.BF.TID300,U="EllipticalRoi";class G{static getMeasurementData(e){const{defaultState:t,NUMGroup:n,SCOORDGroup:a}=E.getSetupMeasurementData(e),{GraphicData:r}=a,i=[{x:r[0],y:r[1]},{x:r[2],y:r[3]}],o=[{x:r[4],y:r[5]},{x:r[6],y:r[7]}],s=Math.sqrt(Math.pow(o[0].x-o[1].x,2)+Math.pow(o[0].y-o[1].y,2)),c=(o[1].x-o[0].x)/s,u=(o[1].y-o[0].y)/s,d=s/2,l={x:i[0].x+c*d,y:i[0].y+u*d},m={x:i[1].x-c*d,y:i[1].y-u*d};return{...t,toolType:G.toolType,active:!1,cachedStats:{area:n?n.MeasuredValueSequence.NumericValue:0},handles:{end:{x:l.x,y:l.y,highlight:!1,active:!1},initialRotation:0,start:{x:m.x,y:m.y,highlight:!1,active:!1},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,visible:!0}}static getTID300RepresentationArguments(e){const{cachedStats:t={},handles:n,finding:a,findingSites:r}=e,{start:i,end:o}=n,{area:s}=t,c=Math.abs(i.x-o.x)/2,u=Math.abs(i.y-o.y)/2,d=[],l={x:(i.x+o.x)/2,y:(i.y+o.y)/2};c>u?(d.push({x:l.x-c,y:l.y}),d.push({x:l.x+c,y:l.y}),d.push({x:l.x,y:l.y-u}),d.push({x:l.x,y:l.y+u})):(d.push({x:l.x,y:l.y-u}),d.push({x:l.x,y:l.y+u}),d.push({x:l.x-c,y:l.y}),d.push({x:l.x+c,y:l.y}));return{area:s,points:d,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:EllipticalRoi",finding:a,findingSites:r||[]}}}G.toolType=U,G.utilityToolType=U,G.TID300Representation=F,G.isValidCornerstoneTrackingIdentifier=e=>{if(!e.includes(":"))return!1;const[t,n]=e.split(":");return t===x&&n===U},E.registerTool(G);const{Circle:V}=u.BF.TID300,q="CircleRoi";class L{static getMeasurementData(e){const{defaultState:t,NUMGroup:n,SCOORDGroup:a}=E.getSetupMeasurementData(e),{GraphicData:r}=a,i={x:r[0],y:r[1]},o={x:r[2],y:r[3]};return{...t,toolType:L.toolType,active:!1,cachedStats:{area:n?n.MeasuredValueSequence.NumericValue:0,radius:0,perimeter:0},handles:{end:{...o,highlight:!1,active:!1},initialRotation:0,start:{...i,highlight:!1,active:!1},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,visible:!0}}static getTID300RepresentationArguments(e){const{cachedStats:t={},handles:n,finding:a,findingSites:r}=e,{start:i,end:o}=n,{area:s,radius:c}=t,u=2*Math.PI*c,d=[];d.push(i),d.push(o);return{area:s,perimeter:u,radius:c,points:d,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:CircleRoi",finding:a,findingSites:r||[]}}}L.toolType=q,L.utilityToolType=q,L.TID300Representation=V,L.isValidCornerstoneTrackingIdentifier=e=>{if(!e.includes(":"))return!1;const[t,n]=e.split(":");return t===x&&n===q},E.registerTool(L);const{Point:k}=u.BF.TID300,B="ArrowAnnotate",z="CORNERSTONEFREETEXT";class j{static getMeasurementData(e){const{defaultState:t,SCOORDGroup:n,findingGroup:a}=E.getSetupMeasurementData(e),r=a.ConceptCodeSequence.CodeMeaning,{GraphicData:i}=n;return{...t,toolType:j.toolType,active:!1,handles:{start:{x:i[0],y:i[1],highlight:!0,active:!1},end:{x:4==i.length?i[2]:i[0]+20,y:4==i.length?i[3]:i[1]+20,highlight:!0,active:!1},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,text:r,visible:!0}}static getTID300RepresentationArguments(e){const t=[e.handles.start,e.handles.end],{findingSites:n}=e;let{finding:a}=e;const r={points:t,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:ArrowAnnotate",findingSites:n||[]};return a&&a.CodeValue===z||(a={CodeValue:z,CodingSchemeDesignator:"CST4",CodeMeaning:e.text}),r.finding=a,r}}j.toolType=B,j.utilityToolType=B,j.TID300Representation=k,j.isValidCornerstoneTrackingIdentifier=e=>{if(!e.includes(":"))return!1;const[t,n]=e.split(":");return t===x&&n===B},E.registerTool(j);const{CobbAngle:H}=u.BF.TID300,W="CobbAngle";class ${static getMeasurementData(e){const{defaultState:t,NUMGroup:n,SCOORDGroup:a}=E.getSetupMeasurementData(e),r={...t,rAngle:n.MeasuredValueSequence.NumericValue,toolType:$.toolType,handles:{start:{},end:{},start2:{highlight:!0,drawnIndependently:!0},end2:{highlight:!0,drawnIndependently:!0},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};return[r.handles.start.x,r.handles.start.y,r.handles.end.x,r.handles.end.y,r.handles.start2.x,r.handles.start2.y,r.handles.end2.x,r.handles.end2.y]=a.GraphicData,r}static getTID300RepresentationArguments(e){const{handles:t,finding:n,findingSites:a}=e;return{point1:t.start,point2:t.end,point3:t.start2,point4:t.end2,rAngle:e.rAngle,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:CobbAngle",finding:n,findingSites:a||[]}}}$.toolType=W,$.utilityToolType=W,$.TID300Representation=H,$.isValidCornerstoneTrackingIdentifier=e=>{if(!e.includes(":"))return!1;const[t,n]=e.split(":");return t===x&&n===W},E.registerTool($);const{Angle:Y}=u.BF.TID300,K="Angle";class X{static getMeasurementData(e){const{defaultState:t,NUMGroup:n,SCOORDGroup:a}=E.getSetupMeasurementData(e),r={...t,rAngle:n.MeasuredValueSequence.NumericValue,toolType:X.toolType,handles:{start:{},middle:{},end:{},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};return[r.handles.start.x,r.handles.start.y,r.handles.middle.x,r.handles.middle.y,r.handles.middle.x,r.handles.middle.y,r.handles.end.x,r.handles.end.y]=a.GraphicData,r}static getTID300RepresentationArguments(e){const{handles:t,finding:n,findingSites:a}=e;return{point1:t.start,point2:t.middle,point3:t.middle,point4:t.end,rAngle:e.rAngle,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Angle",finding:n,findingSites:a||[]}}}X.toolType=K,X.utilityToolType=K,X.TID300Representation=Y,X.isValidCornerstoneTrackingIdentifier=e=>{if(!e.includes(":"))return!1;const[t,n]=e.split(":");return t===x&&n===K},E.registerTool(X);const{Polyline:Q}=u.BF.TID300;class J{static getMeasurementData(e){const{defaultState:t,SCOORDGroup:n,NUMGroup:a}=E.getSetupMeasurementData(e),r={...t,toolType:J.toolType,handles:{start:{},end:{},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},initialRotation:0},cachedStats:{area:a?a.MeasuredValueSequence.NumericValue:0},color:void 0,invalidated:!0},i={};return[r.handles.start.x,r.handles.start.y,i.x,i.y,r.handles.end.x,r.handles.end.y]=n.GraphicData,r}static getTID300RepresentationArguments(e){const{finding:t,findingSites:n,cachedStats:a={},handles:r}=e,{start:i,end:o}=r,s=[i,{x:i.x,y:o.y},o,{x:o.x,y:i.y}],{area:c,perimeter:u}=a;return{points:s,area:c,perimeter:u,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:RectangleRoi",finding:t,findingSites:n||[]}}}J.toolType="RectangleRoi",J.utilityToolType="RectangleRoi",J.TID300Representation=Q,J.isValidCornerstoneTrackingIdentifier=e=>{if(!e.includes(":"))return!1;const[t,n]=e.split(":");return t===x&&n===J.toolType},E.registerTool(J);var Z=n(3293),ee=n.n(Z);const{DicomMessage:te,DicomMetaDictionary:ne}=u.p,{Normalizer:ae}=u.z8;function re(e,t,n){const a=[];if(t){const t=e[0].data.byteArray.buffer,n=te.readFile(t),r=ne.naturalizeDataset(n.dict);r._meta=ne.namifyDataset(n.meta),a.push(r)}else for(let t=0;t<e.length;t++){const n=e[t].data.byteArray.buffer,r=te.readFile(n),i=ne.naturalizeDataset(r.dict);i._meta=ne.namifyDataset(r.meta),a.push(i)}return n?.SpecificCharacterSet&&a.forEach(e=>e.SpecificCharacterSet=n.SpecificCharacterSet),ae.normalizeToDataset(a)}const{rotateDirectionCosinesInPlane:ie,flipImageOrientationPatient:oe,flipMatrix2D:se,rotateMatrix902D:ce}=u.BF.orientation,{datasetToBlob:ue,BitArray:de,DicomMessage:le,DicomMetaDictionary:me}=u.BF,{Normalizer:ge}=u.z8,{Segmentation:pe}=u.h4,fe={generateSegmentation:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0};const{toolState:a,segments:r}=t,i=e[0],o={x:i.columns,y:i.rows,z:e.length};o.xy=o.x*o.y;if(!function(e,t){let n=0;for(let e=0;e<t.length;e++)t[e]&&n++;return n}(0,r))throw new Error("No segments to export!");const s=i.imageId.includes("?frame"),c=function(e,t,n){const a=re(e,t);return new pe([a],n)}(e,s,n),{referencedFramesPerSegment:u,segmentIndicies:d}=function(e,t,n){const a=[],r=[];for(let e=0;e<n.length;e++)n[e]&&(a.push(e),r.push([]));for(let n=0;n<t.length;n++){const i=e[t[n].imageId];for(let e=0;e<a.length;e++){const t=a[e];i&&i.brush&&i.brush.data&&i.brush.data[t]&&i.brush.data[t].pixelData&&r[e].push(n)}}return{referencedFramesPerSegment:r,segmentIndicies:a}}(a,e,r);let l=0;for(let e=0;e<u.length;e++)l+=u[e].length;c.setNumberOfFrames(l);for(let t=0;t<d.length;t++){const n=d[t],i=u[t],s=i.map(e=>e+1),l=r[n];c.addSegment(l,Se(n,i,a,e,o),s)}c.bitPackPixelData();return ue(c.dataset)},generateToolState:function(e,t,n){const a=le.readFile(t),r=me.naturalizeDataset(a.dict);r._meta=me.namifyDataset(a.meta);const i=ge.normalizeToDataset([r]),o=n.get("imagePlaneModule",e[0]);o||console.warn("Insufficient metadata, imagePlaneModule missing.");const s=function(e){const t=[];t[0]=e,t[1]=oe.h(e),t[2]=oe.v(e);const n=ie(e,Math.PI/2);return t[3]=n,t[4]=oe.h(n),t[5]=oe.v(n),t[6]=ie(e,Math.PI),t[7]=ie(e,1.5*Math.PI),t}(Array.isArray(o.rowCosines)?[...o.rowCosines,...o.columnCosines]:[o.rowCosines.x,o.rowCosines.y,o.rowCosines.z,o.columnCosines.x,o.columnCosines.y,o.columnCosines.z]),c=i.SharedFunctionalGroupsSequence,d=c.PlaneOrientationSequence?c.PlaneOrientationSequence.ImageOrientationPatient:void 0,l=i.Columns*i.Rows,m=function(e){const t=[],n=e.SegmentSequence;if(Array.isArray(n))for(let e=0;e<n.length;e++)t.push(n[e]);else t.push(n);return{seriesInstanceUid:e.ReferencedSeriesSequence.SeriesInstanceUID,data:t}}(i),g=function(e){const t=e.SegmentationType;if("BINARY"===t)return de.unpack(e.PixelData);const n=new Uint8Array(e.PixelData),a=e.MaximumFractionalValue,r=void 0===n.find(e=>0!==e&&e!==a);if(!r)return void u.Rm.warn("This is a fractional segmentation, which is not currently supported.");return u.Rm.warn("This segmentation object is actually binary... processing as such."),n}(i),p=i.PerFrameFunctionalGroupsSequence,f={};let S=!0;for(let t=0;t<p.length;t++){const a=p[t],r=d||a.PlaneOrientationSequence.ImageOrientationPatient,o=Oe(ee()(new Uint8Array(g.buffer,t*l,l),[i.Rows,i.Columns]),r,s);if(!o){console.warn("This segmentation object is not in-plane with the source data. Bailing out of IO. It'd be better to render this with vtkjs. "),S=!1;break}const u=a.SegmentIdentificationSequence.ReferencedSegmentNumber-1;let m;m=c.DerivationImageSequence&&c.DerivationImageSequence.SourceImageSequence?c.DerivationImageSequence.SourceImageSequence[t]:a.DerivationImageSequence.SourceImageSequence;he(f,Ie(m,e,n),u,o)}if(!S)return;return{toolState:f,segMetadata:m}}};function Se(e,t,n,a,r){const i=new Uint8Array(r.xy*t.length);let o=0;for(let r=0;r<t.length;r++){const s=n[a[t[r]].imageId].brush.data[e].pixelData;for(let e=0;e<s.length;e++)i[o]=s[e],o++}return i}function he(e,t,n,a){e[t]?e[t].brush?e[t].brush.data||(e[t].brush.data=[]):(e[t].brush={},e[t].brush.data=[]):(e[t]={},e[t].brush={},e[t].brush.data=[]),e[t].brush.data[n]={};const r=e[t].brush.data[n];r.pixelData=new Uint8Array(a.data.length);const i=r.pixelData;for(let e=0;e<i.length;e++)a.data[e]?i[e]=1:i[e]=0}function Ie(e,t,n){const{ReferencedSOPInstanceUID:a,ReferencedFrameNumber:r}=e;return r?function(e,t,n,a){const r=n.find(n=>{const r=a.get("sopCommonModule",n);if(!r)return;const i=Number(n.split("frame=")[1]);return r.sopInstanceUID===e&&i===t-1});return r}(a,r,t,n):function(e,t,n){return t.find(t=>{const a=n.get("sopCommonModule",t);if(a)return a.sopInstanceUID===e})}(a,t,n)}function Oe(e,t,n){return Te(t,n[0])?e:Te(t,n[1])?se.v(e):Te(t,n[2])?se.h(e):Te(t,n[3])?ce(e):Te(t,n[4])?se.h(ce(e)):Te(t,n[5])?se.v(ce(e)):Te(t,n[6])?ce(ce(e)):Te(t,n[7])?ce(ce(ce(e))):void 0}const De=1e-5;function Te(e,t){return Math.abs(e[0]-t[0])<De&&Math.abs(e[1]-t[1])<De&&Math.abs(e[2]-t[2])<De&&Math.abs(e[3]-t[3])<De&&Math.abs(e[4]-t[4])<De&&Math.abs(e[5]-t[5])<De}const{nearlyEqual:Re}=u.BF.orientation;function Ce(e,t,n){if(e.length!==t.length)return!1;for(let a=0;a<e.length;++a)if(!Re(e[a],t[a],n))return!1;return!0}function ye(e,t,n,a){const{SharedFunctionalGroupsSequence:r,PerFrameFunctionalGroupsSequence:i}=e,o=r.PlaneOrientationSequence?r.PlaneOrientationSequence.ImageOrientationPatient:void 0,s=i[0],c=o||s.PlaneOrientationSequence.ImageOrientationPatient;return t.some(e=>Ce(c,e,a))?"Planar":function(e,t,n){const a=Math.abs(e[0]*t[0]+e[1]*t[1]+e[2]*t[2]),r=Math.abs(e[3]*t[3]+e[4]*t[4]+e[5]*t[5]);return(a<n||Math.abs(a-1)<n)&&(r<n||Math.abs(r-1)<n)}(c,t[0],a)&&n.includes(e.Rows)&&n.includes(e.Columns)?"Perpendicular":"Oblique"}var Ee;!function(e){e.SEGMENTATION_LOAD_PROGRESS="CORNERSTONE_ADAPTER_SEGMENTATION_LOAD_PROGRESS"}(Ee||(Ee={}));const{rotateDirectionCosinesInPlane:xe,flipImageOrientationPatient:Me,flipMatrix2D:Ne,rotateMatrix902D:Ae}=u.BF.orientation,{BitArray:Pe,DicomMessage:ve,DicomMetaDictionary:_e}=u.p,{Normalizer:we}=u.z8,{Segmentation:be}=u.h4,{encode:Fe,decode:Ue}=u.BF.compression,Ge={includeSliceSpacing:!0,rleEncode:!1};function Ve(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=Object.assign({},Ge,n),r=Array.isArray(t)?t:[t];let i=0;const o=[];for(let e=0;e<r.length;e++){const t=r[e],{labelmaps2D:n,metadata:a}=t,s=[];for(let e=1;e<a.length;e++)a[e]&&(s[e]=[]);for(let e=0;e<n.length;e++){const t=n[e];if(n[e]){const{segmentsOnLabelmap:n}=t;n.forEach(t=>{0!==t&&(s[t].push(e),i++)})}}o[e]=s}e.setNumberOfFrames(i);for(let t=0;t<r.length;t++){const n=o[t],a=r[t],{metadata:i}=a;for(let t=1;t<n.length;t++){const r=n[t];if(r){const n=r.map(e=>e+1),o=i[t],s=qe(a,r);e.addSegmentFromLabelmap(o,s,t,n)}}}if(a.rleEncode){const t=Fe(e.dataset.PixelData,i,e.dataset.Rows,e.dataset.Columns);e.assignToDataset({BitsAllocated:"8",BitsStored:"8",HighBit:"7",SegmentationType:"FRACTIONAL",SegmentationFractionalType:"PROBABILITY",MaximumFractionalValue:"255"}),e.dataset._meta.TransferSyntaxUID={Value:["1.2.840.10008.1.2.5"],vr:"UI"},e.dataset.SpecificCharacterSet="ISO_IR 192",e.dataset._vrMap.PixelData="OB",e.dataset.PixelData=t}else e.bitPackPixelData();return e}function qe(e,t){const{labelmaps2D:n}=e,a=[];for(let e=0;e<t.length;e++){const r=t[e];a.push(n[r].pixelData)}return a}function Le(e,t,n,a,r,i){let o;if(!e)return o;const{FrameOfReferenceUID:s,PerFrameFunctionalGroupsSequence:c,SourceImageSequence:u,ReferencedSeriesSequence:d}=e;if(!c||0===c.length)return o;const l=c[t];if(!l)return o;let m;if(l.DerivationImageSequence){let e=l.DerivationImageSequence;Array.isArray(e)&&(e=0!==e.length?e[0]:void 0),e&&(m=e.SourceImageSequence,Array.isArray(m)&&(m=0!==m.length?m[0]:void 0))}else u&&0!==u.length&&(console.warn("DerivationImageSequence not present, using SourceImageSequence assuming SEG has the same geometry as the source image."),m=u[t]);if(m&&(o=function(e,t){const{ReferencedSOPInstanceUID:n,ReferencedFrameNumber:a}=e,r=t[n];if(!r)return void console.warn(`No imageId found for SOPInstanceUID: ${n}`);if(void 0!==a)return r.includes("frames/")?r.replace(/frames\/\d+/,`frames/${a}`):r.includes("frame=")?r.replace(/frame=\d+/,"frame="+(a-1)):r.includes("wadors:")?`${r}/frames/${a}`:`${r}?frame=${a-1}`;return r}(m,i)),void 0===o&&d){o=function(e,t,n,a,r,i){if(!e||!n.PlanePositionSequence?.[0]?.ImagePositionPatient)return;const o=n.PlanePositionSequence[0].ImagePositionPatient;for(let n of a){const a=r.get("instance",n);if(!a)continue;const s=He(a);if(a.ImagePositionPatient&&a.FrameOfReferenceUID===t&&a.SeriesInstanceUID===e)if(s){const e=r.get("imagePlaneModule",n)?.imagePositionPatient;if(e&&Ce(o,e,i))return n}else if(Ce(o,a.ImagePositionPatient,i))return n}return}((Array.isArray(d)?d[0]:d).SeriesInstanceUID,s,l,n,a,r)}return o}function ke(e,t,n,a,r,i,o,s,c,u,d,l){const{SharedFunctionalGroupsSequence:m,PerFrameFunctionalGroupsSequence:g,Rows:p,Columns:f}=r,S=m.PlaneOrientationSequence?m.PlaneOrientationSequence.ImageOrientationPatient:void 0,h=f*p,I=h*i.length*u.BYTES_PER_ELEMENT;let O=1,D=0,T=n[D].slice(0),R=structuredClone(t[D]),C=r.SegmentSequence.length;for(let d=1;d<=C;++d){for(let m=0,C=g.length;m<C;++m){const C=g[m],y=Be(r,m);if(void 0===y)throw new Error("Could not retrieve the segment index. Aborting segmentation loading.");if(y!==d)continue;const E=S||C.PlaneOrientationSequence.ImageOrientationPatient,x=Ke(a,m*h,h),M=$e(ee()(x,[p,f]),E,o,c);if(!M)throw new Error("Individual SEG frames are out of plane with respect to the first SEG frame. This is not yet supported. Aborting segmentation loading.");const N=Le(r,m,i,s,c,l);if(!N){console.warn("Image not present in stack, can't import frame : "+m+".");continue}const A=s.get("instance",N);if(p!==A.Rows||f!==A.Columns)throw new Error("Individual SEG frames have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported. Aborting segmentation loading. ");const P=i.findIndex(e=>e===N),v=new u(T,h*P*u.BYTES_PER_ELEMENT,h),_=M.data;let w=!1;for(let e=0,a=M.data.length;e<a;++e)if(_[e]){if(0!==v[e]){D++,D>=O&&(n[D]=new ArrayBuffer(I),t[D]=[],O++),T=n[D].slice(0),R=structuredClone(t[D]),m=0;break}v[e]=y,w=!0}w&&(R[P]||(R[P]=[]),R[P].push(y),e[P]||(e[P]=[]),e[P].push(y))}n[D]=T.slice(0),t[D]=structuredClone(R),D=0,T=n[D].slice(0),R=structuredClone(t[D])}}const Be=(e,t)=>{const{PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:a}=e,r=n[t];return r&&r.SegmentIdentificationSequence?r.SegmentIdentificationSequence.ReferencedSegmentNumber:a.SegmentIdentificationSequence?a.SegmentIdentificationSequence.ReferencedSegmentNumber:void 0};function ze(e,t,n,a,r,i,o,s,c,u,d,l,m,g,p){const{SharedFunctionalGroupsSequence:f,PerFrameFunctionalGroupsSequence:S,Rows:h,Columns:I}=r,O=f.PlaneOrientationSequence?f.PlaneOrientationSequence.ImageOrientationPatient:void 0,D=I*h;let T=0;const R=S.length,C=Math.ceil(R/10),y=p&&g;let E=!1;return new Promise(t=>{!function f(){for(let t=Math.min(T+C,R);T<t;++T){const t=S[T],g=O||t.PlaneOrientationSequence.ImageOrientationPatient,p=Ke(a,T*D,D),f=$e(ee()(p,[h,I]),g,o,c);if(!f)throw new Error("Individual SEG frames are out of plane with respect to the first SEG frame. This is not yet supported. Aborting segmentation loading.");const R=Be(r,T);if(void 0===R)throw new Error("Could not retrieve the segment index. Aborting segmentation loading.");d.has(R)||d.set(R,{});const C=Le(r,T,i,s,c,l);if(!C){console.warn("Image not present in stack, can't import frame : "+T+".");continue}const y=m.metadata[C];if(h!==y.Rows||I!==y.Columns)throw new Error("Individual SEG frames have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported. Aborting segmentation loading. ");const x=m.indices[C],M=D*x*u.BYTES_PER_ELEMENT,N=new u(n[0],M,D),A=f.data,P=[];for(let t=0,n=f.data.length;t<n;++t)if(A[t]){for(let e=t;e<n;++e)A[e]&&(E||0===N[e]||(E=!0),N[e]=R,P.push(e));e[x]||(e[x]=[]),e[x].push(R);break}const v=d.get(R);v[x]=P,d.set(R,v)}if(y){const e=Math.round(T/R*100);p(g,Ee.SEGMENTATION_LOAD_PROGRESS,{percentComplete:e})}T<R?setTimeout(f,0):t(E)}()})}function je(e,t){const n=e.SegmentationType;let a;if(a=Array.isArray(e.PixelData)?e.PixelData[0]:e.PixelData,void 0===a&&u.Rm.error("This segmentation pixelData is undefined."),"BINARY"===n)return function(e,t){for(var n=new Uint8Array(e),a=[],r=8*t,i=Math.ceil(8*n.length/r),o=0;o<i;o++){var s=o*r,c=Math.min(s+r,8*n.length),u=Math.floor(s/8),d=Math.ceil(c/8),l=n.slice(u,d),m=Pe.unpack(l);a.push(m)}return a}(a,t.maxBytesPerChunk);if("LABELMAP"===n)return 8===e.BitsStored?new Uint8Array(a):16===e.BitsStored?new Uint16Array(a):new Uint8Array(a);const r=new Uint8Array(a),i=e.MaximumFractionalValue;return void 0===r.find(e=>0!==e&&e!==i)?(u.Rm.warn("This segmentation object is actually binary... processing as such."),r):void 0}function He(e){return e&&e.NumberOfFrames>1}function We(e){const t=[];t[0]=e,t[1]=Me.h(e),t[2]=Me.v(e);const n=xe(e,Math.PI/2);return t[3]=n,t[4]=Me.h(n),t[5]=Me.v(n),t[6]=xe(e,Math.PI),t[7]=xe(e,1.5*Math.PI),t}function $e(e,t,n,a){return Ce(t,n[0],a)?e:Ce(t,n[1],a)?Ne.v(e):Ce(t,n[2],a)?Ne.h(e):Ce(t,n[3],a)?Ae(e):Ce(t,n[4],a)?Ae(Ne.h(e)):Ce(t,n[5],a)?Ae(Ne.v(e)):Ce(t,n[6],a)?Ae(Ae(e)):Ce(t,n[7],a)?Ae(Ae(Ae(e))):void 0}function Ye(e,t){const n=e.SegmentSequence;let a=[];return a=Array.isArray(n)?[void 0,...n]:[void 0,n],{seriesInstanceUid:t,data:a}}function Ke(e,t,n){const a=function(e,t,n){var a=e.reduce((e,t)=>e+t.length,0);if(t<0||t+n>a)throw new Error("Offset and length out of bounds");var r=0,i=t;for(;i>=e[r].length;)i-=e[r].length,r++;var o=r,s=i+n;for(;s>e[o].length;)s-=e[o].length,o++;return{start:{chunkIndex:r,offset:i},end:{chunkIndex:o,offset:s}}}(e,t,n);if(a.start.chunkIndex===a.end.chunkIndex)return new Uint8Array(e[a.start.chunkIndex].buffer,a.start.offset,n);{let t=new Uint8Array(n),r=0;for(let n=a.start.chunkIndex;n<=a.end.chunkIndex;n++){let i=n===a.start.chunkIndex?a.start.offset:0,o=n===a.end.chunkIndex?a.end.offset:e[n].length;t.set(new Uint8Array(e[n].buffer,i,o-i),r),r+=o-i}return t}}function Xe(e,t,n,a){let r=0,i=0,o=0,s=0,c=0,u=0,d=0;for(const[l,m]of Object.entries(e)){const e=Number(l);if(!m||0===m.length)continue;const g=a[e],p=n.get("imagePlaneModule",g);if(!p){console.debug("Missing imagePlaneModule metadata for centroid calculation");continue}const{imagePositionPatient:f,rowCosines:S,columnCosines:h,rowPixelSpacing:I,columnPixelSpacing:O}=p;for(const n of m){const a=Math.floor(n/t.Rows),l=n%t.Rows;r+=l,i+=a,o+=e;s+=f[0]+l*S[0]*O+a*h[0]*I,c+=f[1]+l*S[1]*O+a*h[1]*I,u+=f[2]+l*S[2]*O+a*h[2]*I,d++}}return{image:{x:Math.floor(r/d),y:Math.floor(i/d),z:Math.floor(o/d)},world:{x:s/d,y:c/d,z:u/d},count:d}}const Qe={generateSegmentation:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Ve(function(e,t,n){const a=re(e,t);return new be([a],n)}(e,He(e[0]),n),t,n)},generateToolState:async function(e,t,n,a){const{skipOverlapping:r=!1,tolerance:i=.001,TypedArrayConstructor:o=Uint8Array,maxBytesPerChunk:s=199e6,eventTarget:c=null,triggerEvent:u=null}=a,d=ve.readFile(t),l=_e.naturalizeDataset(d.dict);l._meta=_e.namifyDataset(d.meta);const m=we.normalizeToDataset([l]),g=n.get("imagePlaneModule",e[0]),p=n.get("generalSeriesModule",e[0]).seriesInstanceUID;g||console.warn("Insufficient metadata, imagePlaneModule missing.");const f=We(Array.isArray(g.rowCosines)?[...g.rowCosines,...g.columnCosines]:[g.rowCosines.x,g.rowCosines.y,g.rowCosines.z,g.columnCosines.x,g.columnCosines.y,g.columnCosines.z]),S=m.Columns*m.Rows,h=Ye(m,p);let I,O;if("1.2.840.10008.1.2.5"===m._meta.TransferSyntaxUID.Value[0]){const e=Array.isArray(m.PixelData)?m.PixelData:[m.PixelData];if(I=Ue(e,m.Rows,m.Columns),1===m.BitsStored)return void console.warn("No implementation for rle + bitbacking.");O=[I]}else if(O=je(m,{maxBytesPerChunk:s}),!O)throw new Error("Fractional segmentations are not yet supported");const D=ye(m,f,[g.rows,g.columns,e.length],i),T=e.reduce((e,t)=>{const{sopInstanceUID:a}=n.get("generalImageModule",t);return e[a]=t,e},{});let R,C=!1;switch(r||(C=function(e,t,n,a,r,i,o,s){const{SharedFunctionalGroupsSequence:c,PerFrameFunctionalGroupsSequence:u,SegmentSequence:d,Rows:l,Columns:m}=t;if(d.length<2)return!1;const g=c.PlaneOrientationSequence?c.PlaneOrientationSequence.ImageOrientationPatient:void 0,p=m*l,f=u.length;let S=new Map;for(let e=0;e<f;++e){if(void 0===Be(t,e)){console.warn("Could not retrieve the segment index for frame segment "+e+", skipping this frame.");continue}const a=Le(t,e,n,r,i,s);if(!a){console.warn("Image not present in stack, can't import frame : "+e+".");continue}const o=n.findIndex(e=>e===a);if(S.has(o)){let t=S.get(o);t.includes(e)||(t.push(e),S.set(o,t))}else S.set(o,[e])}for(let[,t]of S.entries()){let n=new o(p).fill(0);for(let r=0;r<t.length;++r){const o=t[r],s=u[o],c=g||s.PlaneOrientationSequence.ImageOrientationPatient,d=Ke(e,o*p,p),f=$e(ee()(d,[l,m]),c,a,i);if(!f){console.warn("Individual SEG frames are out of plane with respect to the first SEG frame, this is not yet supported, skipping this frame.");continue}const S=f.data;for(let e=0,t=S.length;e<t;++e)if(0!==S[e]&&(n[e]++,n[e]>1))return!0}}return!1}(O,m,e,f,n,i,o,T)),D){case"Planar":R=C?ke:ze;break;case"Perpendicular":throw new Error("Segmentations orthogonal to the acquisition plane of the source data are not yet supported.");case"Oblique":throw new Error("Segmentations oblique to the acquisition plane of the source data are not yet supported.")}const y=[];y[0]=[];const E=[],x=S*e.length*o.BYTES_PER_ELEMENT,M=[];M[0]=new ArrayBuffer(x);const N=e.reduce((e,t,a)=>(e.indices[t]=a,e.metadata[t]=n.get("instance",t),e),{indices:{},metadata:{}}),A=new Map,P=await R(E,y,M,O,m,e,f,n,i,o,A,T,N,c,u),v=new Map;return A.forEach((t,a)=>{const r=Xe(t,m,n,e);v.set(a,r)}),{labelmapBufferArray:M,segMetadata:h,segmentsOnFrame:E,segmentsOnFrameArray:y,centroids:v,overlappingSegments:P}},fillSegmentation:Ve};function Je(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;return 4===a?Qe.generateSegmentation(e,t,n):3===a?fe.generateSegmentation(e,t,n):void console.warn(`No generateSegmentation adapter for cornerstone version ${a}, exiting.`)}function Ze(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4;return 4===i?Qe.generateToolState(e,t,n,a,r):3===i?fe.generateToolState(e,t,n):void console.warn(`No generateToolState adapter for cornerstone version ${i}, exiting.`)}function et(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(4===a)return Qe.fillSegmentation(e,t,n);console.warn(`No generateSegmentation adapter for cornerstone version ${a}, exiting.`)}const{DicomMessage:tt,DicomMetaDictionary:nt}=u.p,{Normalizer:at}=u.z8;function rt(e,t,n,a,r,i){let o;if(!e)return o;const{FrameOfReferenceUID:s,PerFrameFunctionalGroupsSequence:c,SourceImageSequence:u,ReferencedSeriesSequence:d}=e;if(!c||0===c.length)return o;const l=c[t];if(!l)return o;let m;if(l.DerivationImageSequence){let e=l.DerivationImageSequence;Array.isArray(e)&&(e=0!==e.length?e[0]:void 0),e&&(m=e.SourceImageSequence,Array.isArray(m)&&(m=0!==m.length?m[0]:void 0))}else u&&0!==u.length&&(console.warn("DerivationImageSequence not present, using SourceImageSequence assuming SEG has the same geometry as the source image."),m=u[t]);if(m&&(o=function(e,t){const{ReferencedSOPInstanceUID:n,ReferencedFrameNumber:a}=e;return a?function(e,t,n){const a=n[e];if(!a)return;const r=Number(a.split("frame=")[1]);return r===t-1?a:void 0}(n,a,t):t[n]}(m,i)),void 0===o&&d){o=function(e,t,n,a,r,i){if(void 0===e||void 0===n.PlanePositionSequence||void 0===n.PlanePositionSequence[0]||void 0===n.PlanePositionSequence[0].ImagePositionPatient)return;for(let o=0;o<a.length;++o){const s=r.get("instance",a[o]);if(void 0!==s&&void 0!==s.ImagePositionPatient&&s.FrameOfReferenceUID===t&&s.SeriesInstanceUID===e&&Ce(n.PlanePositionSequence[0].ImagePositionPatient,s.ImagePositionPatient,i))return a[o]}}((Array.isArray(d)?d[0]:d).SeriesInstanceUID,s,l,n,a,r)}return o}const it={Length:A,FreehandRoi:v,Bidirectional:b,EllipticalRoi:G,CircleRoi:L,ArrowAnnotate:j,MeasurementReport:E,CobbAngle:$,Angle:X,RectangleRoi:J},ot={Segmentation:a},st={ParametricMap:{generateToolState:async function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001;const r=tt.readFile(t),i=nt.naturalizeDataset(r.dict);i._meta=nt.namifyDataset(r.meta);const o=at.normalizeToDataset([i]),s=n.get("imagePlaneModule",e[0]);s||console.warn("Insufficient metadata, imagePlaneModule missing.");const c=[Array.isArray(s.rowCosines)?[...s.rowCosines,...s.columnCosines]:[s.rowCosines.x,s.rowCosines.y,s.rowCosines.z,s.columnCosines.x,s.columnCosines.y,s.columnCosines.z]],d=function(e){let t,n;if(e.PixelData){t=(16===e.BitsAllocated?[Uint16Array,Int16Array]:[Uint32Array,Int32Array])[e.PixelRepresentation??0],n=e.PixelData}else e.FloatPixelData?(t=Float32Array,n=e.FloatPixelData):e.DoubleFloatPixelData&&(t=Float64Array,n=e.DoubleFloatPixelData);void 0===n&&u.Rm.error("This parametric map pixel data is undefined.");Array.isArray(n)&&(n=n[0]);return new t(n)}(o),l=ye(o,c,[s.rows,s.columns,e.length],a),m=e.reduce((e,t)=>{const{sopInstanceUID:a}=n.get("generalImageModule",t);return e[a]=t,e},{});if("Planar"!==l){throw new Error(`Parametric maps ${{Perpendicular:"orthogonal",Oblique:"oblique"}[l]} to the acquisition plane of the source data are not yet supported.`)}const g=e.reduce((e,t,a)=>(e.indices[t]=a,e.metadata[t]=n.get("instance",t),e),{indices:{},metadata:{}});return await function(e,t,n,a,r,i,o){const s=new e.constructor(e.length),{PerFrameFunctionalGroupsSequence:c,Rows:u,Columns:d}=t,l=d*u,m=c.length;for(let c=0;c<m;c++){const m=new e.constructor(e.buffer,c*l,l),g=rt(t,c,n,a,r,i);if(!g){console.warn("Image not present in stack, can't import frame : "+c+".");continue}const p=o.metadata[g];if(u!==p.Rows||d!==p.Columns)throw new Error("Parametric map have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported.");const f=l*o.indices[g]*s.BYTES_PER_ELEMENT;new s.constructor(s.buffer,f,l).set(m)}return s}(d,o,e,n,a,m,g),{pixelData:d}}}};var ct=n(15327),ut="Cornerstone3DTools@^0.1.0";const dt=["PatientName","PatientID","PatientBirthDate","PatientBirthTime","PatientID","IssuerOfPatientID","OtherPatientIDs","OtherPatientIDsSequence","PatientSex","PatientIdentityRemoved","DeidentificationMethodCodeSequence","StudyDate","StudyTime","StudyStatusID","StudyPriorityID","StudyInstanceUID","StudyDescription","AccessionNumber","StudyID","ReferringPhysicianName","BodyPartExamined","TimezoneOffsetFromUTC"];const lt=["SeriesInstanceUID","SeriesNumber","SeriesDescription","Modality","SeriesDate","SeriesTime"];function mt(e){const t={_meta:e._meta,_vrMap:e._vrMap};for(const n of lt){const a=e[n];void 0!==a&&(t[n]=a)}return t}const gt={CodingSchemeDesignator:"CORNERSTONEJS",codeValues:{CORNERSTONEFREETEXT:"CORNERSTONEFREETEXT"}},pt="none";var ft;const{TID1500:St,addAccessors:ht}=u.BF,{StructuredReport:It}=u.h4,{Normalizer:Ot}=u.z8,{TID1500MeasurementReport:Dt,TID1501MeasurementGroup:Tt}=St,{DicomMetaDictionary:Rt}=u.p,Ct={CodingSchemeDesignator:"DCM",CodeValue:"121071"},yt={CodingSchemeDesignator:"SCT",CodeValue:"363698007"},Et={CodingSchemeDesignator:"SRT",CodeValue:"G-C0E3"};class xt{static getTID300ContentItem(e,t,n,a){const r=n.getTID300RepresentationArguments(e,a);r.ReferencedSOPSequence=t;return new n.TID300Representation(r)}static getMeasurementGroup(e,t,n,a){const r=t[e],i=this.measurementAdapterByToolType.get(e);if(!(r&&r.data&&r.data.length&&i))return;const o=r.data.map(e=>this.getTID300ContentItem(e,n,i,a));return new Tt(o)}static getCornerstoneLabelFromDefaultState(e){const{findingSites:t=[],finding:n}=e,a=gt.codeValues.CORNERSTONEFREETEXT,r=t.find(e=>e.CodeValue===a);return r?r.CodeMeaning:n&&n.CodeValue===a?n.CodeMeaning:void 0}static generateDatasetMeta(){const e=new Uint8Array(2);e[1]=1;return{FileMetaInformationVersion:{Value:[e.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[Rt.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}}}static processSCOORDGroup(e){let{SCOORDGroup:t,toolType:n,sopInstanceUIDToImageIdMap:a,metadata:r}=e;const{ReferencedSOPSequence:i}=t.ContentSequence,{ReferencedSOPInstanceUID:o,ReferencedFrameNumber:s}=i,c=a[o],u=r.get("imagePlaneModule",c);return{SCOORDGroup:t,ReferencedSOPSequence:i,ReferencedSOPInstanceUID:o,ReferencedFrameNumber:s,state:{description:void 0,sopInstanceUid:o,annotation:{annotationUID:Rt.uid(),metadata:{toolName:n,referencedImageId:c,FrameOfReferenceUID:u.frameOfReferenceUID,label:""}}}}}static processSCOORD3DGroup(e){let{SCOORD3DGroup:t,toolType:n}=e;return{SCOORD3DGroup:t,FrameOfReferenceUID:t.ReferencedFrameOfReferenceUID,state:{description:void 0,annotation:{annotationUID:Rt.uid(),metadata:{toolName:n,FrameOfReferenceUID:t.ReferencedFrameOfReferenceUID,label:""}}}}}static getSpatialCoordinatesState(e){let{NUMGroup:t,sopInstanceUIDToImageIdMap:n,metadata:a,toolType:r}=e;const i=d(t.ContentSequence).find(e=>"SCOORD"===e.ValueType),o=d(t.ContentSequence).find(e=>"SCOORD3D"===e.ValueType);if(i)return this.processSCOORDGroup({SCOORDGroup:i,toolType:r,metadata:a,sopInstanceUIDToImageIdMap:n});if(o)return this.processSCOORD3DGroup({SCOORD3DGroup:o,toolType:r});throw new Error("No spatial coordinates group found.")}static processSpatialCoordinatesGroup(e){let{NUMGroup:t,sopInstanceUIDToImageIdMap:n,metadata:a,findingGroup:r,findingSiteGroups:i,toolType:o}=e;const{state:s,SCOORDGroup:c,ReferencedSOPSequence:u,ReferencedSOPInstanceUID:d,ReferencedFrameNumber:l,SCOORD3DGroup:m,FrameOfReferenceUID:g}=this.getSpatialCoordinatesState({NUMGroup:t,sopInstanceUIDToImageIdMap:n,metadata:a,toolType:o}),p={...s,finding:r?ht(r.ConceptCodeSequence):void 0,findingSites:i.map(e=>ht(e.ConceptCodeSequence))};return p.finding&&(p.description=p.finding.CodeMeaning),p.annotation.metadata.label=xt.getCornerstoneLabelFromDefaultState(p),{defaultState:p,NUMGroup:t,SCOORDGroup:c,ReferencedSOPSequence:u,ReferencedSOPInstanceUID:d,ReferencedFrameNumber:l,SCOORD3DGroup:m,FrameOfReferenceUID:g}}static getSetupMeasurementData(e,t,n,a){const{ContentSequence:r}=e,i=d(r),o=i.find(e=>this.codeValueMatch(e,Ct)),s=i.filter(e=>this.codeValueMatch(e,yt,Et))||[],c=i.find(e=>"NUM"===e.ValueType);return this.processSpatialCoordinatesGroup({NUMGroup:c,sopInstanceUIDToImageIdMap:t,metadata:n,findingGroup:o,findingSiteGroups:s,toolType:a})}static generateReferencedSOPSequence(e){let{toolData:t,toolTypes:n,metadataProvider:a,imageId:r,sopInstanceUIDsToSeriesInstanceUIDMap:i,derivationSourceDatasets:o}=e;const s=r===pt?this.getImageIdFromVolume({toolData:t,toolTypes:n}):r,c=a.get("sopCommonModule",s),u=a.get("instance",s),{sopInstanceUID:d,sopClassUID:l}=c,{SeriesInstanceUID:m}=u;if(i[d]=m,!o.find(e=>e.SeriesInstanceUID===m)){const e=xt.generateDerivationSourceDataset(u);o.push(e)}const g=a.get("frameNumber",s),p={ReferencedSOPClassUID:l,ReferencedSOPInstanceUID:d,ReferencedFrameNumber:void 0};return(u&&u.NumberOfFrames&&u.NumberOfFrames>1||Ot.isMultiframeSOPClassUID(l))&&(p.ReferencedFrameNumber=g),p}static getImageIdFromVolume(e){let{toolData:t,toolTypes:n}=e;const a=t?.[n?.[0]]?.data?.[0],r=a?.metadata?.volumeId;return ct.cache.getVolume(r).imageIds[0]}static generateReport(e,t,n,a){let r=[];const i={},o=[],s=xt.generateDatasetMeta();let c=!1;Object.keys(e).forEach(a=>{const s=e[a],u=Object.keys(s),d=this.generateReferencedSOPSequence({toolData:s,toolTypes:u,metadataProvider:t,imageId:a,sopInstanceUIDsToSeriesInstanceUIDMap:i,derivationSourceDatasets:o});a===pt&&(c=!0);const l=[];u.forEach(e=>{const t=this.getMeasurementGroup(e,s,d,n);t&&l.push(t)}),r=r.concat(l)});const u=new Dt({TID1501MeasurementGroups:r},a),d=new It(o,a),l=u.contentItem(o,{...a,sopInstanceUIDsToSeriesInstanceUIDMap:i});return d.dataset=Object.assign(d.dataset,l),d.dataset._meta=s,d.SpecificCharacterSet="ISO_IR 192",c&&(d.dataset.SOPClassUID=Rt.sopClassUIDsByName.Comprehensive3DSR),d}static generateToolState(e,t,n,a,r){if("1500"!==e.ContentTemplateSequence.TemplateIdentifier)throw new Error("This package can currently only interpret DICOM SR TID 1500");const i=d(e.ContentSequence).find(l("Imaging Measurements")),o=d(i.ContentSequence).filter(l("Measurement Group")),s={};return o.forEach(i=>{try{const o=d(i.ContentSequence),c=o.find(e=>"Tracking Identifier"===e.ConceptNameCodeSequence.CodeMeaning),{TextValue:u}=c,l=o.find(e=>"Tracking Unique Identifier"===e.ConceptNameCodeSequence.CodeMeaning),m=l?.UID,g=r?.getToolClass?.(i,e,this.measurementAdapterByToolType)||this.getAdapterForTrackingIdentifier(u);if(g){const e=g.getMeasurementData(i,t,n,a,u);e.TrackingUniqueIdentifier=m,console.log(`=== ${g.toolType} ===`),console.log(e),s[g.toolType]||=[],s[g.toolType].push(e)}}catch(e){console.warn("Unable to generate tool state for",i,e)}}),s}static registerTool(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.toolType;if(this.measurementAdapterByToolType.has(n)){if(!t)throw new Error(`The registered tool name ${n} already exists in adapters, use a different toolType or use replace`);"function"==typeof t&&t(this.measurementAdapterByToolType.get(n))}this.measurementAdapterByToolType.set(e.toolType,e),this.measurementAdapterByTrackingIdentifier.set(e.trackingIdentifierTextValue,e)}static registerTrackingIdentifier(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];for(const t of n)this.measurementAdapterByTrackingIdentifier.set(t,e)}static getAdapterForTrackingIdentifier(e){const t=this.measurementAdapterByTrackingIdentifier.get(e);if(t)return t;for(const t of[...this.measurementAdapterByToolType.values()])if(t.isValidCornerstoneTrackingIdentifier(e))return this.measurementAdapterByTrackingIdentifier.set(e,t),t}}(ft=xt).CORNERSTONE_3D_TAG=ut,ft.measurementAdapterByToolType=new Map,ft.measurementAdapterByTrackingIdentifier=new Map,ft.codeValueMatch=(e,t,n)=>{const{ConceptNameCodeSequence:a}=e;if(!a)return;const{CodingSchemeDesignator:r,CodeValue:i}=a;return r==t.CodingSchemeDesignator&&i==t.CodeValue||n&&r==n.CodingSchemeDesignator&&i==n.CodeValue},ft.generateDerivationSourceDataset=e=>({...function(e){const t={_meta:e._meta,_vrMap:e._vrMap};for(const n of dt){const a=e[n];void 0!==a&&(t[n]=a)}return t}(e),...mt(e)});class Mt{static init(e,t,n){if(this.toolType=e,Mt.toolType)throw new Error(`Base adapter tool type set to ${this.toolType} while setting ${e}`);if(this.parentType=n?.parentType,this.trackingIdentifiers=new Set,this.TID300Representation=t,this.parentType){this.trackingIdentifierTextValue=`${ut}:${this.parentType}:${this.toolType}`;const e=`${ut}:${this.toolType}`;this.trackingIdentifiers.add(e)}else this.trackingIdentifierTextValue=`${ut}:${e}`;this.trackingIdentifiers.add(this.trackingIdentifierTextValue),xt.registerTool(this)}static registerLegacy(){this.trackingIdentifiers.add(`cornerstoneTools@^4.0.0:${this.toolType}`)}static registerSubType(e,t,n){const a=Object.create(e);return a.init(t,e.TID300Representation,{parentType:e.parentType||e.toolType,replace:n}),a}static isValidCornerstoneTrackingIdentifier(e){return!!this.trackingIdentifiers.has(e)||!!e.includes(":")&&e.startsWith(this.trackingIdentifierTextValue)}static getMeasurementData(e,t,n,a,r){const{defaultState:i,ReferencedFrameNumber:o}=xt.getSetupMeasurementData(e,t,a,this.toolType);return i.annotation.data={cachedStats:{},frameNumber:o,seriesLevel:r?.indexOf(":Series")>0},i}static getTID300RepresentationArguments(e,t){const{data:n,metadata:a}=e,{finding:r,findingSites:i}=e,{referencedImageId:o}=a;if(!o)return this.getTID300RepresentationArgumentsSCOORD3D(e);const{handles:{points:s=[]}}=n;return{points:s.map(e=>{const n=t(o,e);return{x:n[0],y:n[1]}}),trackingIdentifierTextValue:this.trackingIdentifierTextValue,findingSites:i||[],finding:r}}static getTID300RepresentationArgumentsSCOORD3D(e){const{data:t,finding:n,findingSites:a}=e,{handles:{points:r=[]}}=t,i=r[0];return{points:[{x:i[0],y:i[1],z:i[2]}],trackingIdentifierTextValue:this.trackingIdentifierTextValue,findingSites:a||[],finding:n}}}var Nt;const{Point:At}=u.BF.TID300,{codeValues:Pt}=gt;class vt extends Mt{static getMeasurementData(e,t,n,a,r){const{defaultState:i,SCOORDGroup:o,SCOORD3DGroup:s,ReferencedFrameNumber:c}=xt.getSetupMeasurementData(e,t,a,vt.toolType),u=i.annotation.metadata.referencedImageId,d=i.annotation.metadata.label;if(o)return this.getMeasurementDataFromScoord({SCOORDGroup:o,referencedImageId:u,metadata:a,imageToWorldCoords:n,defaultState:i,text:d,ReferencedFrameNumber:c});if(s)return this.getMeasurementDataFromScoord3D({SCOORD3DGroup:s,defaultState:i,text:d});throw new Error("Can't get measurement data with missing SCOORD and SCOORD3D groups.")}static getMeasurementDataFromScoord3D(e){let{SCOORD3DGroup:t,defaultState:n,text:a}=e;const{GraphicData:r}=t,i=[];for(let e=0;e<r.length;e+=3){const t=[r[e],r[e+1],r[e+2]];i.push(t)}const o=n;return o.annotation.data={text:a,handles:{arrowFirst:!0,points:[i[0],i[1]],activeHandleIndex:0,textBox:{hasMoved:!1}}},o}static getMeasurementDataFromScoord(e){let{SCOORDGroup:t,referencedImageId:n,metadata:a,imageToWorldCoords:r,defaultState:i,text:o,ReferencedFrameNumber:s}=e;const{GraphicData:c}=t,u=[];for(let e=0;e<c.length;e+=2){const t=r(n,[c[e],c[e+1]]);u.push(t)}if(1===u.length){const e=a.get("imagePixelModule",n);let t=10,i=10;if(e){const{columns:n,rows:a}=e;t=n/10,i=a/10}const o=r(n,[c[0]+t,c[1]+i]);u.push(o)}const d=i;return d.annotation.data={text:o,handles:{arrowFirst:!0,points:[u[0],u[1]],activeHandleIndex:0,textBox:{hasMoved:!1}},frameNumber:s},d}static getTID300RepresentationArguments(e,t){const{data:n,metadata:a,findingSites:r}=e;let{finding:i}=e;const{referencedImageId:o}=a;if(!o)return this.getTID300RepresentationArgumentsSCOORD3D(e);const{points:s,arrowFirst:c}=n.handles;let u,d;c?(u=s[0],d=s[1]):(u=s[1],d=s[0]);const l=t(o,u),m=t(o,d),g={points:[{x:l[0],y:l[1]},{x:m[0],y:m[1]}],trackingIdentifierTextValue:this.trackingIdentifierTextValue,findingSites:r||[],finding:i,use3DSpatialCoordinates:!1};return i&&i.CodeValue===Pt.CORNERSTONEFREETEXT||(i={CodeValue:Pt.CORNERSTONEFREETEXT,CodingSchemeDesignator:gt.CodingSchemeDesignator,CodeMeaning:n.text}),g}static getTID300RepresentationArgumentsSCOORD3D(e){const{data:t,findingSites:n,metadata:a}=e;let{finding:r}=e;const{points:i,arrowFirst:o}=t.handles;let s,c;o?(s=i[0],c=i[1]):(s=i[1],c=i[0]);const u=s,d=c,l={points:[{x:u[0],y:u[1],z:u[2]},{x:d[0],y:d[1],z:d[2]}],trackingIdentifierTextValue:this.trackingIdentifierTextValue,findingSites:n||[],finding:r,ReferencedFrameOfReferenceUID:a.FrameOfReferenceUID,use3DSpatialCoordinates:!0};return r&&r.CodeValue===Pt.CORNERSTONEFREETEXT||(r={CodeValue:Pt.CORNERSTONEFREETEXT,CodingSchemeDesignator:gt.CodingSchemeDesignator,CodeMeaning:t.text}),l}}var _t;(Nt=vt).init("ArrowAnnotate",At),Nt.registerLegacy();const{Bidirectional:wt}=u.BF.TID300;class bt extends Mt{static getMeasurementData(e,t,n,a){const{defaultState:r,ReferencedFrameNumber:i}=xt.getSetupMeasurementData(e,t,a,bt.toolType),o=r.annotation.metadata.referencedImageId,{ContentSequence:s}=e,c=d(s).find(e=>"Long Axis"===e.ConceptNameCodeSequence.CodeMeaning),u=d(s).find(e=>"Short Axis"===e.ConceptNameCodeSequence.CodeMeaning),l=d(c.ContentSequence).find(e=>"SCOORD"===e.ValueType),m=d(u.ContentSequence).find(e=>"SCOORD"===e.ValueType);return l&&m?this.getMeasurementDataFromScoord({longAxisNUMGroup:c,shortAxisNUMGroup:u,longAxisSCOORDGroup:l,shortAxisSCOORDGroup:m,referencedImageId:o,imageToWorldCoords:n,ReferencedFrameNumber:i,defaultState:r}):this.getMeasurementDataFromScoord3d({longAxisNUMGroup:c,shortAxisNUMGroup:u,defaultState:r})}static getMeasurementDataFromScoord(e){let{longAxisNUMGroup:t,shortAxisNUMGroup:n,longAxisSCOORDGroup:a,shortAxisSCOORDGroup:r,referencedImageId:i,imageToWorldCoords:o,ReferencedFrameNumber:s,defaultState:c}=e;const u=[];[a,r].forEach(e=>{const{GraphicData:t}=e;for(let e=0;e<t.length;e+=2){const n=o(i,[t[e],t[e+1]]);u.push(n)}});const d=c;return d.annotation.data={handles:{points:[u[0],u[1],u[2],u[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{[`imageId:${i}`]:{length:t.MeasuredValueSequence.NumericValue,width:n.MeasuredValueSequence.NumericValue}},frameNumber:s},d}static getMeasurementDataFromScoord3d(e){let{longAxisNUMGroup:t,shortAxisNUMGroup:n,defaultState:a}=e;const r=[];[d(t.ContentSequence).find(e=>"SCOORD3D"===e.ValueType),d(n.ContentSequence).find(e=>"SCOORD3D"===e.ValueType)].forEach(e=>{const{GraphicData:t}=e;for(let e=0;e<t.length;e+=3){const n=[t[e],t[e+1],t[e+2]];r.push(n)}});const i=a;return i.annotation.data={handles:{points:[r[0],r[1],r[2],r[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{}},i}static getTID300RepresentationArguments(e,t){const{data:n,finding:a,findingSites:r,metadata:i}=e,{cachedStats:o={},handles:s}=n,{referencedImageId:c}=i,{points:u}=s,d=[u[0],u[1]],l=[u[2],u[3]];let m,g;if(Math.sqrt(Math.pow(d[0][0]-d[1][0],2)+Math.pow(d[0][1]-d[1][1],2)+Math.pow(d[0][2]-d[1][2],2))>Math.sqrt(Math.pow(l[0][0]-l[1][0],2)+Math.pow(l[0][1]-l[1][1],2)+Math.pow(l[0][2]-l[1][2],2))?(m=d,g=l):(m=l,g=d),!c)return this.getTID300RepresentationArgumentsSCOORD3D({tool:e,shortAxisPoints:m,longAxisPoints:g});const p=t(c,m[0]),f=t(c,m[1]),S=t(c,g[0]),h=t(c,g[1]),{length:I,width:O}=o[`imageId:${c}`]||{};return{longAxis:{point1:{x:p[0],y:p[1]},point2:{x:f[0],y:f[1]}},shortAxis:{point1:{x:S[0],y:S[1]},point2:{x:h[0],y:h[1]}},longAxisLength:I,shortAxisLength:O,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:a,findingSites:r||[],use3DSpatialCoordinates:!1}}static getTID300RepresentationArgumentsSCOORD3D(e){let{tool:t,shortAxisPoints:n,longAxisPoints:a}=e;const{data:r,finding:i,findingSites:o,metadata:s}=t,{cachedStats:c={}}=r,u=n[0],d=n[1],l=a[0],m=a[1],g=Object.keys(c)[0],{length:p,width:f}=g?c[g]:{};return{longAxis:{point1:{x:u[0],y:u[1],z:u[2]},point2:{x:d[0],y:d[1],z:d[2]}},shortAxis:{point1:{x:l[0],y:l[1],z:l[2]},point2:{x:m[0],y:m[1],z:m[2]}},longAxisLength:p,shortAxisLength:f,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:i,findingSites:o||[],ReferencedFrameOfReferenceUID:s.FrameOfReferenceUID,use3DSpatialCoordinates:!0}}}var Ft;(_t=bt).init("Bidirectional",wt),_t.registerLegacy();const{CobbAngle:Ut}=u.BF.TID300;class Gt extends Mt{static getMeasurementData(e,t,n,a){const{defaultState:r,NUMGroup:i,SCOORDGroup:o,SCOORD3DGroup:s,ReferencedFrameNumber:c}=xt.getSetupMeasurementData(e,t,a,Gt.toolType);if(o)return this.getMeasurementDataFromScoord({defaultState:r,SCOORDGroup:o,imageToWorldCoords:n,NUMGroup:i,ReferencedFrameNumber:c});if(s)return this.getMeasurementDataFromScoord3D({defaultState:r,SCOORD3DGroup:s});throw new Error("Can't get measurement data with missing SCOORD and SCOORD3D groups.")}static getMeasurementDataFromScoord(e){let{defaultState:t,SCOORDGroup:n,imageToWorldCoords:a,NUMGroup:r,ReferencedFrameNumber:i}=e;const o=t.annotation.metadata.referencedImageId,{GraphicData:s}=n,c=[];for(let e=0;e<s.length;e+=2){const t=a(o,[s[e],s[e+1]]);c.push(t)}const u=t;return u.annotation.data={handles:{points:[c[0],c[1],c[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{[`imageId:${o}`]:{angle:r?r.MeasuredValueSequence.NumericValue:null}},frameNumber:i},u}static getMeasurementDataFromScoord3D(e){let{defaultState:t,SCOORD3DGroup:n}=e;const{GraphicData:a}=n,r=[];for(let e=0;e<a.length;e+=3){const t=[a[e],a[e+1],a[e+2]];r.push(t)}const i=t;return i.annotation.data={handles:{points:[r[0],r[1],r[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{}},i}static getTID300RepresentationArguments(e,t){const{data:n,finding:a,findingSites:r,metadata:i}=e,{cachedStats:o={},handles:s}=n,{referencedImageId:c}=i;if(!c)return this.getTID300RepresentationArgumentsSCOORD3D(e);const u=t(c,s.points[0]),d=t(c,s.points[1]),l=t(c,s.points[2]),m={x:u[0],y:u[1]},g={x:d[0],y:d[1]},p=g,f={x:l[0],y:l[1]},{angle:S}=o[`imageId:${c}`]||{};return{point1:m,point2:g,point3:p,point4:f,rAngle:S,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:a,findingSites:r||[],use3DSpatialCoordinates:!1}}static getTID300RepresentationArgumentsSCOORD3D(e){const{data:t,finding:n,findingSites:a,metadata:r}=e,{cachedStats:i={},handles:o}=t,s=o.points[0],c=o.points[1],u=o.points[2],d={x:s[0],y:s[1],z:s[2]},l={x:c[0],y:c[1],z:c[2]},m=l,g={x:u[0],y:u[1],z:u[2]},p=Object.keys(i)[0],{angle:f}=p?i[p]:{};return{point1:d,point2:l,point3:m,point4:g,rAngle:f,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:n,findingSites:a||[],ReferencedFrameOfReferenceUID:r.FrameOfReferenceUID,use3DSpatialCoordinates:!0}}}var Vt;(Ft=Gt).init("Angle",Ut),Ft.registerLegacy();const{CobbAngle:qt}=u.BF.TID300;class Lt extends Mt{static getMeasurementData(e,t,n,a){const{defaultState:r,NUMGroup:i,SCOORDGroup:o,SCOORD3DGroup:s,ReferencedFrameNumber:c}=xt.getSetupMeasurementData(e,t,a,Lt.toolType);if(o)return this.getMeasurementDataFromScoord({defaultState:r,SCOORDGroup:o,imageToWorldCoords:n,NUMGroup:i,ReferencedFrameNumber:c});if(s)return this.getMeasurementDataFromScoord3D({defaultState:r,SCOORD3DGroup:s});throw new Error("Can't get measurement data with missing SCOORD and SCOORD3D groups.")}static getMeasurementDataFromScoord(e){let{defaultState:t,SCOORDGroup:n,imageToWorldCoords:a,NUMGroup:r,ReferencedFrameNumber:i}=e;const o=t.annotation.metadata.referencedImageId,{GraphicData:s}=n,c=[];for(let e=0;e<s.length;e+=2){const t=a(o,[s[e],s[e+1]]);c.push(t)}const u=t;return u.annotation.data={handles:{points:[c[0],c[1],c[2],c[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{[`imageId:${o}`]:{angle:r?r.MeasuredValueSequence.NumericValue:null}},frameNumber:i},u}static getMeasurementDataFromScoord3D(e){let{defaultState:t,SCOORD3DGroup:n}=e;const{GraphicData:a}=n,r=[];for(let e=0;e<a.length;e+=3){const t=[a[e],a[e+1],a[e+2]];r.push(t)}const i=t;return i.annotation.data={handles:{points:[r[0],r[1],r[2],r[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{}},i}static getTID300RepresentationArguments(e,t){const{data:n,finding:a,findingSites:r,metadata:i}=e,{cachedStats:o={},handles:s}=n,{referencedImageId:c}=i;if(!c)return this.getTID300RepresentationArgumentsSCOORD3D(e);const u=t(c,s.points[0]),d=t(c,s.points[1]),l=t(c,s.points[2]),m=t(c,s.points[3]),g={x:u[0],y:u[1]},p={x:d[0],y:d[1]},f={x:l[0],y:l[1]},S={x:m[0],y:m[1]},{angle:h}=o[`imageId:${c}`]||{};return{point1:g,point2:p,point3:f,point4:S,rAngle:h,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:a,findingSites:r||[],use3DSpatialCoordinates:!1}}static getTID300RepresentationArgumentsSCOORD3D(e){const{data:t,finding:n,findingSites:a,metadata:r}=e,{cachedStats:i={},handles:o}=t,s=o.points[0],c=o.points[1],u=o.points[2],d=o.points[3],l={x:s[0],y:s[1],z:s[2]},m={x:c[0],y:c[1],z:c[2]},g={x:u[0],y:u[1],z:u[2]},p={x:d[0],y:d[1],z:d[2]},f=Object.keys(i)[0],{angle:S}=f?i[f]:{};return{point1:l,point2:m,point3:g,point4:p,rAngle:S,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:n,findingSites:a||[],ReferencedFrameOfReferenceUID:r.FrameOfReferenceUID,use3DSpatialCoordinates:!0}}}var kt;(Vt=Lt).init("CobbAngle",qt),Vt.registerLegacy();const{Circle:Bt}=u.BF.TID300;class zt extends Mt{static getMeasurementData(e,t,n,a){const{defaultState:r,NUMGroup:i,SCOORDGroup:o,SCOORD3DGroup:s,ReferencedFrameNumber:c}=xt.getSetupMeasurementData(e,t,a,zt.toolType);if(o)return this.getMeasurementDataFromScoord({defaultState:r,SCOORDGroup:o,imageToWorldCoords:n,NUMGroup:i,ReferencedFrameNumber:c});if(s)return this.getMeasurementDataFromScoord3D({defaultState:r,SCOORD3DGroup:s});throw new Error("Can't get measurement data with missing SCOORD and SCOORD3D groups.")}static getMeasurementDataFromScoord(e){let{defaultState:t,SCOORDGroup:n,imageToWorldCoords:a,NUMGroup:r,ReferencedFrameNumber:i}=e;const o=t.annotation.metadata.referencedImageId,{GraphicData:s}=n,c=[];for(let e=0;e<s.length;e+=2){const t=a(o,[s[e],s[e+1]]);c.push(t)}const u=t;return u.annotation.data={handles:{points:[...c],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{[`imageId:${o}`]:{area:r?r.MeasuredValueSequence.NumericValue:0,radius:0,perimeter:0}},frameNumber:i},u}static getMeasurementDataFromScoord3D(e){let{defaultState:t,SCOORD3DGroup:n}=e;const{GraphicData:a}=n,r=[];for(let e=0;e<a.length;e+=3){const t=[a[e],a[e+1],a[e+2]];r.push(t)}const i=t;return i.annotation.data={handles:{points:[...r],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{}},i}static getTID300RepresentationArguments(e,t){const{data:n,finding:a,findingSites:r,metadata:i}=e,{cachedStats:o={},handles:s}=n,{referencedImageId:c}=i;if(!c)return this.getTID300RepresentationArgumentsSCOORD3D(e);const u=t(c,s.points[0]),d=t(c,s.points[1]),l=[];l.push({x:u[0],y:u[1]}),l.push({x:d[0],y:d[1]});const{area:m,radius:g}=o[`imageId:${c}`]||{};return{area:m,perimeter:2*Math.PI*g,radius:g,points:l,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:a,findingSites:r||[],use3DSpatialCoordinates:!1}}static getTID300RepresentationArgumentsSCOORD3D(e){const{data:t,finding:n,findingSites:a,metadata:r}=e,{cachedStats:i={},handles:o}=t,s=o.points[0],c=o.points[1],u=[];u.push({x:s[0],y:s[1],z:s[2]}),u.push({x:c[0],y:c[1],z:s[2]});const d=Object.keys(i)[0],{area:l,radius:m}=d?i[d]:{};return{area:l,perimeter:2*Math.PI*m,radius:m,points:u,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:n,findingSites:a||[],ReferencedFrameOfReferenceUID:r.FrameOfReferenceUID,use3DSpatialCoordinates:!0}}}(kt=zt).init("CircleROI",Bt),kt.registerLegacy();var jt=n(3823);const{Ellipse:Ht}=u.BF.TID300,Wt=1e-4;class $t extends Mt{static getMeasurementData(e,t,n,a){const{defaultState:r,NUMGroup:i,SCOORDGroup:o,SCOORD3DGroup:s,ReferencedFrameNumber:c}=xt.getSetupMeasurementData(e,t,a,$t.toolType);if(o)return this.getMeasurementDataFromScoord({defaultState:r,SCOORDGroup:o,imageToWorldCoords:n,metadata:a,NUMGroup:i,ReferencedFrameNumber:c});if(s)return this.getMeasurementDataFromScoord3D({defaultState:r,SCOORD3DGroup:s});throw new Error("Can't get measurement data with missing SCOORD and SCOORD3D groups.")}static getMeasurementDataFromScoord(e){let{defaultState:t,SCOORDGroup:n,imageToWorldCoords:a,metadata:r,NUMGroup:i,ReferencedFrameNumber:o}=e;const s=t.annotation.metadata.referencedImageId,{GraphicData:c}=n,u=[];for(let e=0;e<c.length;e+=2){const t=a(s,[c[e],c[e+1]]);u.push(t)}const d=jt.eR.fromValues(...u[0]),l=jt.eR.fromValues(...u[1]),m=jt.eR.fromValues(...u[2]),g=jt.eR.fromValues(...u[3]),p=jt.eR.create();jt.eR.sub(p,l,d),jt.eR.normalize(p,p);const f=jt.eR.create();jt.eR.sub(f,g,m),jt.eR.normalize(f,f);const S=r.get("imagePlaneModule",s);if(!S)throw new Error("imageId does not have imagePlaneModule metadata");const{columnCosines:h}=S,I=jt.eR.fromValues(h[0],h[1],h[2]),O=jt.eR.dot(I,p),D=jt.eR.dot(I,f),T=Math.abs(O),R=Math.abs(D);let C=[];Math.abs(T-1)<Wt?C=[u[0],u[1],u[2],u[3]]:Math.abs(R-1)<Wt?C=[u[2],u[3],u[0],u[1]]:console.warn("OBLIQUE ELLIPSE NOT YET SUPPORTED");const y=t;return y.annotation.data={handles:{points:[...C],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{[`imageId:${s}`]:{area:i?i.MeasuredValueSequence.NumericValue:0}},frameNumber:o},y}static getMeasurementDataFromScoord3D(e){let{defaultState:t,SCOORD3DGroup:n}=e;const{GraphicData:a}=n,r=[];for(let e=0;e<a.length;e+=3){const t=[a[e],a[e+1],a[e+2]];r.push(t)}const i=jt.eR.fromValues(...r[0]),o=jt.eR.fromValues(...r[1]),s=jt.eR.fromValues(...r[2]),c=jt.eR.fromValues(...r[3]),u=jt.eR.create();jt.eR.sub(u,o,i),jt.eR.normalize(u,u);const d=jt.eR.create();jt.eR.sub(d,c,s),jt.eR.normalize(d,d);const l=t;return l.annotation.data={handles:{points:[i,o,s,c],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{}},l}static getTID300RepresentationArguments(e,t){const{data:n,finding:a,findingSites:r,metadata:i}=e,{cachedStats:o={},handles:s}=n,c=n.initialRotation||0,{referencedImageId:u}=i;if(!u)return this.getTID300RepresentationArgumentsSCOORD3D(e);let d,l,m,g;90==c||270==c?(l=t(u,s.points[2]),d=t(u,s.points[3]),m=t(u,s.points[0]),g=t(u,s.points[1])):(d=t(u,s.points[0]),l=t(u,s.points[1]),m=t(u,s.points[2]),g=t(u,s.points[3]));const p=[];Math.abs(d[1]-l[1])>Math.abs(m[0]-g[0])?(p.push({x:d[0],y:d[1]}),p.push({x:l[0],y:l[1]}),p.push({x:m[0],y:m[1]}),p.push({x:g[0],y:g[1]})):(p.push({x:m[0],y:m[1]}),p.push({x:g[0],y:g[1]}),p.push({x:d[0],y:d[1]}),p.push({x:l[0],y:l[1]}));const{area:f}=o[`imageId:${u}`]||{};return{area:f,points:p,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:a,findingSites:r||[],use3DSpatialCoordinates:!1}}static getTID300RepresentationArgumentsSCOORD3D(e){const{data:t,finding:n,findingSites:a,metadata:r}=e,{cachedStats:i,handles:o}=t,s=t.initialRotation||0;let c,u,d,l;90==s||270==s?(u=o.points[2],c=o.points[3],d=o.points[0],l=o.points[1]):(c=o.points[0],u=o.points[1],d=o.points[2],l=o.points[3]);const m=[];Math.sqrt((c[0]-u[0])**2+(c[1]-u[1])**2+(c[2]-u[2])**2)>Math.sqrt((d[0]-l[0])**2+(d[1]-l[1])**2+(d[2]-l[2])**2)?(m.push({x:c[0],y:c[1],z:c[2]}),m.push({x:u[0],y:u[1],z:u[2]}),m.push({x:d[0],y:d[1],z:d[2]}),m.push({x:l[0],y:l[1],z:l[2]})):(m.push({x:d[0],y:d[1],z:d[2]}),m.push({x:l[0],y:l[1],z:l[2]}),m.push({x:c[0],y:c[1],z:c[2]}),m.push({x:u[0],y:u[1],z:u[2]}));const g=Object.keys(i)[0],{area:p}=g?i[g]:{};return{area:p,points:m,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:n,findingSites:a||[],ReferencedFrameOfReferenceUID:r.FrameOfReferenceUID,use3DSpatialCoordinates:!0}}}var Yt;$t.init("EllipticalROI",Ht);const{Polyline:Kt}=u.BF.TID300;class Xt extends Mt{static getMeasurementData(e,t,n,a){const{defaultState:r,NUMGroup:i,SCOORDGroup:o,SCOORD3DGroup:s,ReferencedFrameNumber:c}=xt.getSetupMeasurementData(e,t,a,Xt.toolType);if(o)return this.getMeasurementDataFromScoord({defaultState:r,SCOORDGroup:o,imageToWorldCoords:n,NUMGroup:i,ReferencedFrameNumber:c});if(s)return this.getMeasurementDataFromScoord3D({SCOORD3DGroup:s,defaultState:r});throw new Error("Can't get measurement data with missing SCOORD and SCOORD3D groups.")}static getMeasurementDataFromScoord(e){let{defaultState:t,SCOORDGroup:n,imageToWorldCoords:a,NUMGroup:r,ReferencedFrameNumber:i}=e;const o=t.annotation.metadata.referencedImageId,{GraphicData:s}=n,c=[];for(let e=0;e<s.length;e+=2){const t=a(o,[s[e],s[e+1]]);c.push(t)}const u=t;return u.annotation.data={handles:{points:[c[0],c[1],c[3],c[2]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{[`imageId:${o}`]:{area:r?r.MeasuredValueSequence.NumericValue:null}},frameNumber:i},u}static getMeasurementDataFromScoord3D(e){let{SCOORD3DGroup:t,defaultState:n}=e;const{GraphicData:a}=t,r=[];for(let e=0;e<a.length;e+=3){const t=[a[e],a[e+1],a[e+2]];r.push(t)}const i=n;return i.annotation.data={handles:{points:[r[0],r[1],r[3],r[2]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{}},i}static getTID300RepresentationArguments(e,t){const{data:n,finding:a,findingSites:r,metadata:i}=e,{cachedStats:o={},handles:s}=n,{referencedImageId:c}=i;if(!c)return this.getTID300RepresentationArgumentsSCOORD3D(e);const u=s.points.map(e=>t(c,e)),{area:d,perimeter:l}=o;return{points:[u[0],u[1],u[3],u[2],u[0]],area:d,perimeter:l,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:a,findingSites:r||[],use3DSpatialCoordinates:!1}}static getTID300RepresentationArgumentsSCOORD3D(e){const{data:t,finding:n,findingSites:a,metadata:r}=e,{cachedStats:i={},handles:o}=t,s=o.points,{area:c,perimeter:u}=i;return{points:[s[0],s[1],s[3],s[2],s[0]],area:c,perimeter:u,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:n,findingSites:a||[],ReferencedFrameOfReferenceUID:r.FrameOfReferenceUID,use3DSpatialCoordinates:!0}}}var Qt;(Yt=Xt).init("RectangleROI",Kt),Yt.registerLegacy();const{Length:Jt}=u.BF.TID300;class Zt extends Mt{static getMeasurementDataFromScoord(e){let{defaultState:t,NUMGroup:n,SCOORDGroup:a,ReferencedFrameNumber:r,imageToWorldCoords:i}=e;const o=t.annotation.metadata.referencedImageId,{GraphicData:s}=a,c=[];for(let e=0;e<s.length;e+=2){const t=i(o,[s[e],s[e+1]]);c.push(t)}const u=t;return u.annotation.data={handles:{points:[c[0],c[1]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{[`imageId:${o}`]:{length:n?n.MeasuredValueSequence.NumericValue:0}},frameNumber:r},u}static getMeasurementDataFromScoord3d(e){let{defaultState:t,SCOORD3DGroup:n}=e;const{GraphicData:a}=n,r=a,i=t;return i.annotation.data={handles:{points:[r.slice(0,3),r.slice(3,6)],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{}},i}static getMeasurementData(e,t,n,a){const{defaultState:r,NUMGroup:i,SCOORDGroup:o,SCOORD3DGroup:s,ReferencedFrameNumber:c}=xt.getSetupMeasurementData(e,t,a,this.toolType);if(o)return this.getMeasurementDataFromScoord({defaultState:r,NUMGroup:i,SCOORDGroup:o,ReferencedFrameNumber:c,imageToWorldCoords:n});if(s)return this.getMeasurementDataFromScoord3d({defaultState:r,SCOORD3DGroup:s});throw new Error("Can't get measurement data with missing SCOORD and SCOORD3D groups.")}static getTID300RepresentationArguments(e,t){const{data:n,finding:a,findingSites:r,metadata:i}=e,{cachedStats:o={},handles:s}=n,{referencedImageId:c}=i;if(!c)return this.getTID300RepresentationArgumentsSCOORD3D(e);const u=t(c,s.points[0]),d=t(c,s.points[1]),l={x:u[0],y:u[1]},m={x:d[0],y:d[1]},{length:g}=o[`imageId:${c}`]||{};return{point1:l,point2:m,distance:g,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:a,findingSites:r||[],use3DSpatialCoordinates:!1}}static getTID300RepresentationArgumentsSCOORD3D(e){const{data:t,finding:n,findingSites:a,metadata:r}=e,{cachedStats:i={},handles:o}=t,s=o.points[0],c=o.points[1],u={x:s[0],y:s[1],z:s[2]},d={x:c[0],y:c[1],z:c[2]},l=Object.keys(i)[0],{length:m}=l?i[l]:{};return{point1:u,point2:d,distance:m,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:n,findingSites:a||[],ReferencedFrameOfReferenceUID:r.FrameOfReferenceUID,use3DSpatialCoordinates:!0}}}var en;(Qt=Zt).init("Length",Jt),Qt.registerLegacy();const{Polyline:tn}=u.BF.TID300;class nn extends Mt{static getMeasurementData(e,t,n,a){const{defaultState:r,NUMGroup:i,SCOORDGroup:o,SCOORD3DGroup:s,ReferencedFrameNumber:c}=xt.getSetupMeasurementData(e,t,a,nn.toolType);if(o)return this.getMeasurementDataFromScoord({defaultState:r,SCOORDGroup:o,imageToWorldCoords:n,NUMGroup:i,ReferencedFrameNumber:c});if(s)return this.getMeasurementDataFromScoord3D({defaultState:r,SCOORD3DGroup:s});throw new Error("Can't get measurement data with missing SCOORD and SCOORD3D groups.")}static getMeasurementDataFromScoord(e){let{defaultState:t,SCOORDGroup:n,imageToWorldCoords:a,NUMGroup:r,ReferencedFrameNumber:i}=e;const o=t.annotation.metadata.referencedImageId,{GraphicData:s}=n,c=[];for(let e=0;e<s.length;e+=2){const t=a(o,[s[e],s[e+1]]);c.push(t)}let u=!0;jt.eR.distance(c[c.length-1],c[0])<this.closedContourThreshold&&(c.pop(),u=!1);const d=[];u&&d.push(c[0],c[c.length-1]);const l=t;return l.annotation.data={contour:{polyline:c,closed:!u},handles:{points:d,activeHandleIndex:null,textBox:{hasMoved:!1}},cachedStats:{[`imageId:${o}`]:{area:r?r.MeasuredValueSequence.NumericValue:null}},frameNumber:i},l}static getMeasurementDataFromScoord3D(e){let{defaultState:t,SCOORD3DGroup:n}=e;const{GraphicData:a}=n,r=[];for(let e=0;e<a.length;e+=3){const t=[a[e],a[e+1],a[e+2]];r.push(t)}let i=!0;jt.eR.distance(r[r.length-1],r[0])<this.closedContourThreshold&&(r.pop(),i=!1);const o=[];i&&o.push(r[0],r[r.length-1]);const s=t;return s.annotation.data={contour:{polyline:r,closed:!i},handles:{points:o,activeHandleIndex:null,textBox:{hasMoved:!1}},cachedStats:{}},s}static getTID300RepresentationArguments(e,t){const{data:n,finding:a,findingSites:r,metadata:i}=e,{polyline:o,closed:s}=n.contour,c=!0!==s,{referencedImageId:u}=i;if(!u)return this.getTID300RepresentationArgumentsSCOORD3D(e);const d=o.map(e=>t(u,e));if(!c){const e=d[0];d.push([e[0],e[1]])}const{area:l,areaUnit:m,modalityUnit:g,perimeter:p,mean:f,max:S,stdDev:h}=n.cachedStats[`imageId:${u}`]||{};return{points:d,area:l,areaUnit:m,perimeter:p,modalityUnit:g,mean:f,max:S,stdDev:h,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:a,findingSites:r||[],use3DSpatialCoordinates:!1}}static getTID300RepresentationArgumentsSCOORD3D(e){const{data:t,finding:n,findingSites:a,metadata:r}=e,{polyline:i,closed:o}=t.contour,s=i;if(!(!0!==o)){const e=s[0];s.push([e[0],e[1],e[2]])}const c=Object.keys(t.cachedStats)[0],{area:u,areaUnit:d,modalityUnit:l,perimeter:m,mean:g,max:p,stdDev:f}=c?t.cachedStats[c]:{};return{points:s,area:u,areaUnit:d,perimeter:m,modalityUnit:l,mean:g,max:p,stdDev:f,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:n,findingSites:a||[],ReferencedFrameOfReferenceUID:r.FrameOfReferenceUID,use3DSpatialCoordinates:!0}}}var an;(en=nn).closedContourThreshold=1e-5,en.init("PlanarFreehandROI",tn);const{Point:rn}=u.BF.TID300;class on extends Mt{static getMeasurementData(e,t,n,a,r){const i=super.getMeasurementData(e,t,n,a,r),{defaultState:o,SCOORDGroup:s,SCOORD3DGroup:c}=xt.getSetupMeasurementData(e,t,a,on.toolType);if(s)return this.getMeasurementDataFromScoord({state:i,defaultState:o,SCOORDGroup:s,imageToWorldCoords:n});if(c)return this.getMeasurementDataFromScoord3D({state:i,SCOORD3DGroup:c});throw new Error("Can't get measurement data with missing SCOORD and SCOORD3D groups.")}static getMeasurementDataFromScoord(e){let{state:t,defaultState:n,SCOORDGroup:a,imageToWorldCoords:r}=e;const i=n.annotation.metadata.referencedImageId,{GraphicData:o}=a,s=[];for(let e=0;e<o.length;e+=2){const t=r(i,[o[e],o[e+1]]);s.push(t)}return t.annotation.data={...t.annotation.data,handles:{points:s,activeHandleIndex:null,textBox:{hasMoved:!1}}},t}static getMeasurementDataFromScoord3D(e){let{state:t,SCOORD3DGroup:n}=e;const{GraphicData:a}=n,r=[];for(let e=0;e<a.length;e+=3){const t=[a[e],a[e+1],a[e+2]];r.push(t)}return t.annotation.data={...t.annotation.data,handles:{points:r,activeHandleIndex:null,textBox:{hasMoved:!1}}},t}static getTID300RepresentationArguments(e,t){const{data:n,metadata:a}=e,{finding:r,findingSites:i}=e,{referencedImageId:o}=a;if(!o)return this.getTID300RepresentationArgumentsSCOORD3D(e);const{handles:{points:s=[]}}=n;return{points:s.map(e=>{const n=t(o,e);return{x:n[0],y:n[1]}}),trackingIdentifierTextValue:this.trackingIdentifierTextValue,findingSites:i||[],finding:r,use3DSpatialCoordinates:!1}}static getTID300RepresentationArgumentsSCOORD3D(e){const{data:t,finding:n,findingSites:a,metadata:r}=e,{handles:{points:i=[]}}=t,o=i[0];return{points:[{x:o[0],y:o[1],z:o[2]}],trackingIdentifierTextValue:this.trackingIdentifierTextValue,ReferencedFrameOfReferenceUID:r.FrameOfReferenceUID,findingSites:a||[],finding:n,use3DSpatialCoordinates:!0}}}(an=on).init("Probe",rn),an.registerLegacy();const{Length:sn}=u.BF.TID300;class cn extends Mt{static getMeasurementData(e,t,n,a){const{defaultState:r,SCOORDGroup:i,ReferencedFrameNumber:o}=xt.getSetupMeasurementData(e,t,a,cn.toolType),s=r.annotation.metadata.referencedImageId,{GraphicData:c}=i,u=[];for(let e=0;e<c.length;e+=2){const t=n(s,[c[e],c[e+1]]);u.push(t)}const d=r;return d.annotation.data={handles:{points:[u[0],u[1]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{},frameNumber:o},d}static getTID300RepresentationArguments(e,t){const{data:n,finding:a,findingSites:r,metadata:i}=e,{handles:o}=n,{referencedImageId:s}=i;if(!s)throw new Error("UltrasoundDirectionalTool.getTID300RepresentationArguments: referencedImageId is not defined");const c=t(s,o.points[0]),u=t(s,o.points[1]);return{point1:{x:c[0],y:c[1]},point2:{x:u[0],y:u[1]},trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:a,findingSites:r||[]}}}cn.init("UltrasoundDirectionalTool",sn);const{Normalizer:un}=u.z8,{Segmentation:dn}=u.h4;function ln(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=function(e,t,n){const a=e.map(e=>{const n=t.get("instance",e.imageId);return{...e,...n,SOPClassUID:n.SopClassUID||n.SOPClassUID,SOPInstanceUID:n.SopInstanceUID||n.SOPInstanceUID,PixelData:e.voxelManager.getScalarData(),_vrMap:{PixelData:"OW"},_meta:{}}}),r=un.normalizeToDataset(a);if(!r)throw new Error("Failed to normalize the multiframe dataset, the data is not multi-frame.");return new dn([r],n)}(e,n,a);return Ve(r,t,a)}function mn(e){const{scalarData:t,dimensions:n}=e,a=[],r=new Set;for(let e=0;e<n[2];e++){const i=t.slice(e*n[0]*n[1],(e+1)*n[0]*n[1]),o=[];for(let e=0;e<i.length;e++){const t=i[e];o.includes(t)||0===t||o.push(t)}const s={segmentsOnLabelmap:o,pixelData:i,rows:n[1],columns:n[0]};0!==o.length&&(o.forEach(e=>{r.add(e)}),a[n[2]-1-e]=s)}return e.segmentsOnLabelmap=Array.from(r),e.labelmaps2D=a,e}var gn=n(4667);const pn=e=>{let{largerArray:t,currentTestedArray:n,newArray:a}=e;return t.some((e,t)=>{const r=n[t],i=a[t];return!(!r||!i)&&r.some((e,t)=>{const n=i[t];return e&&n})})},fn=e=>{let{arrayOfSegmentData:t,newSegmentData:n}=e;if(0!==t.length){for(let e=0;e<t.length;e++){const a=t[e],r=a.length>n.length?a:n;if(!pn({currentTestedArray:a,largerArray:r,newArray:n}))return void r.forEach((e,t)=>{const r=a[t],i=n[t];if(!r&&!i||!i)return;if(!r)return void(a[t]=i);const o=r.map((e,t)=>{const n=i[t];return e||n});a[t]=o})}t.push(n)}else t.push(n)},{DicomMessage:Sn,DicomMetaDictionary:hn}=u.p,{Normalizer:In}=u.z8,{decode:On}=u.BF.compression,Dn=e=>{let{segmentsOnFrame:t,imageIdIndex:n,segmentIndex:a}=e;t[n]||(t[n]=[]),t[n].push(a)},Tn=e=>{let{segmentsPixelIndices:t,segmentIndex:n,imageIdIndex:a,indexCache:r}=e;t.has(n)||t.set(n,{});const i=t.get(n);i[a]=r,t.set(n,i)},Rn=e=>{let{PerFrameFunctionalGroups:t,sequenceIndex:n,sopUIDImageIdIndexMap:a,multiframe:r}=e;const i=t.DerivationImageSequence[0].SourceImageSequence[0].ReferencedSOPInstanceUID;return{referencedSOPInstanceUid:i,referencedImageId:a[i],segmentIndex:Be(r,n)}};const Cn=gn.utilities.throttle(e=>{(0,ct.triggerEvent)(ct.eventTarget,Ee.SEGMENTATION_LOAD_PROGRESS,{percentComplete:e})},200);function yn(e){let{segmentsOnFrame:t,labelMapImages:n,pixelDataChunks:a,multiframe:r,referencedImageIds:i,validOrientations:o,metadataProvider:s,tolerance:c,segmentsPixelIndices:u,sopUIDImageIdIndexMap:d,imageIdMaps:l}=e;const{SharedFunctionalGroupsSequence:m,PerFrameFunctionalGroupsSequence:g,Rows:p,Columns:f}=r,S=m.PlaneOrientationSequence?m.PlaneOrientationSequence.ImageOrientationPatient:void 0,h=f*p,I=g.length;let O=!1;return new Promise(e=>{const m=Math.ceil(.1*I),D=T=>{for(let D=T;D<T+m&&D<I;D++){const m=g[D],I=S||m.PlaneOrientationSequence.ImageOrientationPatient,T=Ke(a,D*h,h),R=$e(ee()(T,[p,f]),I,o,c);if(!R)throw new Error("Individual SEG frames are out of plane with respect to the first SEG frame. This is not yet supported. Aborting segmentation loading.");const C=Be(r,D);if(void 0===C)throw new Error("Could not retrieve the segment index. Aborting segmentation loading.");u.has(C)||u.set(C,{});const y=Le(r,D,i,s,c,d);if(!y)return void console.warn("Image not present in stack, can't import frame : "+D+".");const E=l.metadata[y];if(p!==E.Rows||f!==E.Columns)throw new Error("Individual SEG frames have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported. Aborting segmentation loading. ");const x=l.indices[y],M=n[x].getPixelData(),N=R.data,A=[];for(let m=0,g=R.data.length;m<g;++m)if(N[m]){for(let p=m;p<g;++p)if(N[p]){if(!O&&0!==M[p])return O=!0,e(Nn({segmentsOnFrame:t,labelMapImages:n,pixelDataChunks:a,multiframe:r,referencedImageIds:i,validOrientations:o,metadataProvider:s,tolerance:c,segmentsPixelIndices:u,sopUIDImageIdIndexMap:d,imageIdMaps:l}));M[p]=C,A.push(p)}t[x]||(t[x]=[]),t[x].push(C);break}const P=u.get(C);P[x]=A,u.set(C,P)}const R=Math.round(T/I*100);Cn(R),T<I?setTimeout(()=>D(T+m),0):e({hasOverlappingSegments:!1,arrayOfLabelMapImages:[n]})},T=g=>{const S=r.PerFrameFunctionalGroupsSequence,O=r.SharedFunctionalGroupsSequence.PlaneOrientationSequence?.ImageOrientationPatient;for(let e=g;e<g+m&&e<I;e++){const m=S[e],g=O||m.PlaneOrientationSequence.ImageOrientationPatient,I=a.subarray(e*h,(e+1)*h),D=$e(ee()(I,[p,f]),g,o,c);if(!D)throw new Error("Individual Labelmap SEG frames are out of plane with respect to the first SEG frame. This is not yet supported. Aborting segmentation loading.");const T=Le(r,e,i,s,c,d);if(!T){console.warn(`Image not present in stack, can't import frame : ${e}.`);continue}const R=l.metadata[T];if(p!==R.Rows||f!==R.Columns)throw new Error("Individual Labelmap SEG frames have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported. Aborting segmentation loading. ");const C=l.indices[T],y=n[C].getPixelData(),E=D.data;let x=t[C];x||(x=[],t[C]=x);const M=new Set(x);for(let e=0,t=E.length;e<t;++e){const t=E[e];if(0!==t){y[e]=t,M.has(t)||(x.push(t),M.add(t)),u.has(t)||u.set(t,{});const n=u.get(t);n[C]||(n[C]=[]),n[C].push(e)}}}const D=Math.round(g/I*100);Cn(D),g<I?setTimeout(()=>T(g+m),0):e({hasOverlappingSegments:!1,arrayOfLabelMapImages:[n]})};"LABELMAP"===r.SegmentationType?T(0):D(0)})}const En=e=>{let{sharedImageOrientationPatient:t,PerFrameFunctionalGroups:n,pixelDataChunks:a,sequenceIndex:r,sliceLength:i,Rows:o,Columns:s,validOrientations:c,tolerance:u}=e;const d=t||n.PlaneOrientationSequence.ImageOrientationPatient,l=Ke(a,r*i,i),m=$e(ee()(l,[o,s]),d,c,u);if(!m)throw new Error("Individual SEG frames are out of plane with respect to the first SEG frame. This is not yet supported. Aborting segmentation loading.");return m},xn=e=>{let{metadataProvider:t,imageId:n,Rows:a,Columns:r}=e;const i=t.get("instance",n);if(a!==i.Rows||r!==i.Columns)throw new Error("Individual SEG frames have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported. Aborting segmentation loading. ")},Mn=e=>{let{arrayOfSegmentData:t,referencedImageIds:n}=e,a=[];for(let e=0;e<t.length;e++){const n=t[e];n.length>a.length&&(a=n)}return t.map(e=>n.map((t,n)=>{const a=!e[n],r=ct.imageLoader.createAndCacheDerivedLabelmapImage(t),i=r.getPixelData();if(!a)for(let t=0;t<i.length;t++)i[t]=e[n][t];return r}).filter(Boolean))};function Nn(e){let{segmentsOnFrame:t,labelMapImages:n,pixelDataChunks:a,multiframe:r,referencedImageIds:i,validOrientations:o,metadataProvider:s,tolerance:c,segmentsPixelIndices:u,sopUIDImageIdIndexMap:d,imageIdMaps:l}=e;const{SharedFunctionalGroupsSequence:m,PerFrameFunctionalGroupsSequence:g,Rows:p,Columns:f}=r,S=m.PlaneOrientationSequence?m.PlaneOrientationSequence.ImageOrientationPatient:void 0,h=An({sliceLength:f*p,Rows:p,Columns:f,validOrientations:o,metadataProvider:s,imageIdMaps:l,segmentsOnFrame:t,tolerance:c,pixelDataChunks:a,PerFrameFunctionalGroupsSequence:g,labelMapImages:n,sopUIDImageIdIndexMap:d,multiframe:r,sharedImageOrientationPatient:S,segmentsPixelIndices:u});return{arrayOfLabelMapImages:Mn({arrayOfSegmentData:h,referencedImageIds:i}),hasOverlappingSegments:!0}}const An=e=>{let{sliceLength:t,Rows:n,Columns:a,validOrientations:r,metadataProvider:i,imageIdMaps:o,segmentsOnFrame:s,tolerance:c,pixelDataChunks:u,PerFrameFunctionalGroupsSequence:d,labelMapImages:l,sopUIDImageIdIndexMap:m,multiframe:g,sharedImageOrientationPatient:p,segmentsPixelIndices:f}=e;const S=[],h=g.SegmentSequence.length;for(let e=1;e<=h;++e){const h=Pn({PerFrameFunctionalGroupsSequence:d,labelMapImages:l,sopUIDImageIdIndexMap:m,multiframe:g,segmentIndex:e,sliceLength:t,Rows:n,Columns:a,validOrientations:r,tolerance:c,pixelDataChunks:u,sharedImageOrientationPatient:p,metadataProvider:i,imageIdMaps:o,segmentsOnFrame:s,segmentsPixelIndices:f});fn({arrayOfSegmentData:S,newSegmentData:h})}return S},Pn=e=>{let{PerFrameFunctionalGroupsSequence:t,labelMapImages:n,sopUIDImageIdIndexMap:a,multiframe:r,segmentIndex:i,sliceLength:o,Rows:s,Columns:c,validOrientations:u,tolerance:d,pixelDataChunks:l,sharedImageOrientationPatient:m,metadataProvider:g,imageIdMaps:p,segmentsOnFrame:f,segmentsPixelIndices:S}=e;const h=[];for(let e=0;e<n.length;e++){const I=n[e],O=I.referencedImageId,D=t.findIndex((e,t)=>{const{segmentIndex:n,referencedImageId:o}=Rn({PerFrameFunctionalGroups:e,sequenceIndex:t,sopUIDImageIdIndexMap:a,multiframe:r});return n===i&&o===I.referencedImageId});if(-1===D)continue;const T=t[D],R=En({sharedImageOrientationPatient:m,PerFrameFunctionalGroups:T,pixelDataChunks:l,sequenceIndex:D,sliceLength:o,Rows:s,Columns:c,validOrientations:u,tolerance:d});xn({metadataProvider:g,Rows:s,Columns:c,imageId:O});const C=[],y=R.data.map((e,t)=>((e?i:0)&&C.push(t),e?i:0));C.length>0&&(h[e]=y);const E=p.indices[O];Dn({imageIdIndex:E,segmentIndex:i,segmentsOnFrame:f}),Tn({imageIdIndex:E,segmentIndex:i,segmentsPixelIndices:S,indexCache:C})}return h};function vn(e,t,n){return Ze(e,t,n,arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001,arguments.length>5&&void 0!==arguments[5]?arguments[5]:4)}function _n(e,t,n){let{metadataProvider:a,tolerance:r=.001}=n;return async function(e,t,n,a){const{tolerance:r=.001,TypedArrayConstructor:i=Uint8Array,maxBytesPerChunk:o=199e6}=a,s=Sn.readFile(t),c=hn.naturalizeDataset(s.dict);c._meta=hn.namifyDataset(s.meta);const u=In.normalizeToDataset([c]),d=n.get("imagePlaneModule",e[0]),l=n.get("generalSeriesModule",e[0]).seriesInstanceUID;d||console.warn("Insufficient metadata, imagePlaneModule missing.");const m=We(Array.isArray(d.rowCosines)?[...d.rowCosines,...d.columnCosines]:[d.rowCosines.x,d.rowCosines.y,d.rowCosines.z,d.columnCosines.x,d.columnCosines.y,d.columnCosines.z]),g=Ye(u,l);let p,f;if("1.2.840.10008.1.2.5"===u._meta.TransferSyntaxUID.Value[0]){const e=Array.isArray(u.PixelData)?u.PixelData:[u.PixelData];if(p=On(e,u.Rows,u.Columns),1===u.BitsStored)return void console.warn("No implementation for rle + bit packing.");f=[p]}else if(f=je(u,{maxBytesPerChunk:o}),!f)throw new Error("Fractional segmentations are not yet supported");const S=ye(u,m,[d.rows,d.columns,e.length],r),h=e.reduce((e,t)=>{const{sopInstanceUID:a}=n.get("generalImageModule",t);return e[a]=t,e},{});let I;switch(S){case"Planar":I=yn;break;case"Perpendicular":throw new Error("Segmentations orthogonal to the acquisition plane of the source data are not yet supported.");case"Oblique":throw new Error("Segmentations oblique to the acquisition plane of the source data are not yet supported.")}const O=[],D={indices:{},metadata:{}},T=[];for(let t=0;t<e.length;t++){const a=e[t];D.indices[a]=t,D.metadata[a]=n.get("instance",a);const r=ct.imageLoader.createAndCacheDerivedLabelmapImage(a);T.push(r)}const R=new Map,{hasOverlappingSegments:C,arrayOfLabelMapImages:y}=await I({segmentsOnFrame:O,labelMapImages:T,pixelDataChunks:f,multiframe:u,referencedImageIds:e,validOrientations:m,metadataProvider:n,tolerance:r,segmentsPixelIndices:R,sopUIDImageIdIndexMap:h,imageIdMaps:D,TypedArrayConstructor:i}),E=new Map;return R.forEach((t,a)=>{const r=Xe(t,u,n,e);E.set(a,r)}),{labelMapImages:y,segMetadata:g,segmentsOnFrame:O,centroids:E,overlappingSegments:C}}(e,t,a,{tolerance:r})}const{ParametricMap:wn}=st,{generateToolState:bn}=wn;function Fn(e,t,n){return bn(e,t,n,arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001)}function Un(e,t,n){const{referencedImageId:a,FrameOfReferenceUID:r}=e,i=t.get("instance",a),{SeriesInstanceUID:o}=i,{ReferencedSeriesSequence:s}=n;return[{FrameOfReferenceUID:r,RTReferencedStudySequence:[{ReferencedSOPClassUID:n.SOPClassUID,ReferencedSOPInstanceUID:n.SOPInstanceUID,RTReferencedSeriesSequence:[{SeriesInstanceUID:o,ContourImageSequence:[...s[0].ReferencedInstanceSequence]}]}]}]}function Gn(e,t,n,a){const{referencedImageId:r}=e,i=n.get("instance",r),{SeriesInstanceUID:o,StudyInstanceUID:s}=i,c=[];if(o){const e=a.getSeries(s,o),t={SeriesInstanceUID:o,ReferencedInstanceSequence:[]};e.instances.forEach(e=>{const{SOPInstanceUID:n,SOPClassUID:a}=e;t.ReferencedInstanceSequence.push({ReferencedSOPClassUID:a,ReferencedSOPInstanceUID:n})}),c.push(t)}return c}function Vn(e,t){const{FrameOfReferenceUID:n}=e.metadata;return{ROINumber:t+1,ROIName:e.name||`Todo: name ${t+1}`,ROIDescription:`Todo: description ${t+1}`,ROIGenerationAlgorithm:"Todo: algorithm",ReferencedFrameOfReferenceUID:n}}const{generateContourSetsFromLabelmap:qn,AnnotationToPointData:Ln}=gn.utilities.contours,{DicomMetaDictionary:kn}=u.Ay.data;async function Bn(e,t,n){const a=[];(await qn({segmentations:e})).forEach((e,n)=>{if(e){const r=[];e.sliceContours.forEach(e=>{const n=t.get("sopCommonModule",e.referencedImageId),a=[{ReferencedSOPClassUID:n.sopClassUID,ReferencedSOPInstanceUID:n.sopInstanceUID}],i=e.polyData;e.contours.forEach((e,t)=>{const n=e.type,o=e.contourPoints.length,s=[];e.contourPoints.forEach(e=>{const t=i.points[e];t[0]=+t[0].toFixed(2),t[1]=+t[1].toFixed(2),t[2]=+t[2].toFixed(2),s.push(t[0]),s.push(t[1]),s.push(t[2])}),r.push({ContourImageSequence:a,ContourGeometricType:n,NumberOfContourPoints:o,ContourNumber:t+1,ContourData:s})})});const i=e.label||`Segment ${n+1}`,o={name:i,description:i,contourSequence:r,color:e.color,metadata:e.metadata};a.push(o)}});const r=jn({name:e.label,label:e.label},a[0].metadata,t);a.forEach((e,a)=>{const i={ROIDisplayColor:e.color||[255,0,0],ContourSequence:e.contourSequence,ReferencedROINumber:a+1};r.StructureSetROISequence.push(Vn(e,a)),r.ROIContourSequence.push(i),r.ReferencedSeriesSequence=Gn(e.metadata,0,t,n),r.ReferencedFrameOfReferenceSequence=Un(e.metadata,t,r)});const i=new Uint8Array(2);i[1]=1;const o={FileMetaInformationVersion:{Value:[i.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[kn.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}};return r._meta=o,r.SpecificCharacterSet="ISO_IR 192",r}function zn(e,t,n){const a=jn({name:"RTSS from Annotations",label:"RTSS from Annotations"},e[0].metadata,t);e.forEach((e,r)=>{const i=Ln.convert(e,r,t);a.StructureSetROISequence.push(Vn(e,r)),a.ROIContourSequence.push(i),a.RTROIObservationsSequence.push(function(e,t){return{ObservationNumber:t+1,ReferencedROINumber:t+1,RTROIInterpretedType:"Todo: type",ROIInterpreter:"Todo: interpreter"}}(0,r)),a.ReferencedSeriesSequence=Gn(e.metadata,0,t,n),a.ReferencedFrameOfReferenceSequence=Un(e.metadata,t,a)});const r=new Uint8Array(2);r[1]=1;const i={FileMetaInformationVersion:{Value:[r.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[kn.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}};return a._meta=i,a.SpecificCharacterSet="ISO_IR 192",a}function jn(e,t,n){const a=kn.uid(),{referencedImageId:r,FrameOfReferenceUID:i}=t,{studyInstanceUID:o}=n.get("generalSeriesModule",r),s=function(e,t){const n=t.get("generalSeriesModule",e),a=t.get("generalStudyModule",e),r=t.get("patientStudyModule",e),i=t.get("patientModule",e),o=t.get("patientDemographicModule",e);return{Modality:n.modality,PatientID:i.patientId,PatientName:i.patientName,PatientBirthDate:"",PatientAge:r.patientAge,PatientSex:o.patientSex,PatientWeight:r.patientWeight,StudyDate:a.studyDate,StudyTime:a.studyTime,StudyID:"ToDo",AccessionNumber:a.accessionNumber}}(r,n),c=function(e){return{SeriesInstanceUID:e.uid(),SeriesNumber:"99"}}(kn);return{StructureSetROISequence:[],ROIContourSequence:[],RTROIObservationsSequence:[],ReferencedSeriesSequence:[],ReferencedFrameOfReferenceSequence:[],...s,...c,StudyInstanceUID:o,SOPClassUID:"1.2.840.10008.5.1.4.1.1.481.3",SOPInstanceUID:a,Manufacturer:"dcmjs",Modality:"RTSTRUCT",FrameOfReferenceUID:i,PositionReferenceIndicator:"",StructureSetLabel:e.label||"",StructureSetName:e.name||"",ReferringPhysicianName:"",OperatorsName:"",StructureSetDate:kn.date(),StructureSetTime:kn.time(),_meta:null}}const{generateContourSetsFromLabelmap:Hn}=gn.utilities.contours;var Wn;const{Point:$n}=u.BF.TID300;class Yn extends on{static getMeasurementData(e,t,n,a,r){const i=super.getMeasurementData(e,t,n,a,r),{data:o}=i.annotation;return o.isPoint=-1!==r.indexOf("Point"),i}static getTID300RepresentationArguments(e,t){const n=super.getTID300RepresentationArguments(e,t),{data:a}=e;return a.isPoint&&(a.seriesLevel?n.trackingIdentifierTextValue=this.trackingSeriesPointIdentifier:n.trackingIdentifierTextValue=this.trackingPointIdentifier),a.seriesLevel&&(n.trackingIdentifierTextValue=this.trackingSeriesIdentifier),n.points.length||n.points.push({x:0,y:0}),n}}(Wn=Yn).init("KeyImage",$n,{parentType:on.toolType}),Wn.trackingSeriesIdentifier=`${Wn.trackingIdentifierTextValue}:Series`,Wn.trackingPointIdentifier=`${Wn.trackingIdentifierTextValue}:Point`,Wn.trackingSeriesPointIdentifier=`${Wn.trackingIdentifierTextValue}:SeriesPoint`;const Kn={BaseAdapter3D:Mt,Bidirectional:bt,CobbAngle:Lt,Angle:Gt,Length:Zt,CircleROI:zt,EllipticalROI:$t,RectangleROI:Xt,ArrowAnnotate:vt,Probe:on,PlanarFreehandROI:nn,UltrasoundDirectional:cn,KeyImage:Yn,MeasurementReport:xt,CodeScheme:gt,CORNERSTONE_3D_TAG:ut},Xn={Segmentation:r},Qn={ParametricMap:i},Jn={RTSS:o},{Colors:Zn,BitArray:ea}=u.p;function ta(e){const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;switch(t){case 1:return Math.abs(e);case 2:return Math.sqrt(e[0]*e[0]+e[1]*e[1]);case 3:return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);default:{let n=0;for(let a=0;a<t;a++)n+=e[a]*e[a];return Math.sqrt(n)}}}(e);return 0!==t&&(e[0]/=t,e[1]/=t,e[2]/=t),t}const na={Cornerstone:it,Cornerstone3D:Kn},aa={Cornerstone:ot,Cornerstone3D:Xn,VTKjs:{Segmentation:class{constructor(){}static generateSegments(e){"Array"!==e.SegmentSequence.constructor.name&&(e.SegmentSequence=[e.SegmentSequence]),e.SegmentSequence.forEach(e=>{const t=function(e){const t=Zn.dicomlab2RGB(e).map(e=>Math.round(255*e));return t.push(255),t}(e.RecommendedDisplayCIELabValue);segments[e.SegmentNumber]={color:t,functionalGroups:[],offset:null,size:null,pixelData:null}}),e.PerFrameFunctionalGroupsSequence.forEach(e=>{const t=e.SegmentIdentificationSequence.ReferencedSegmentNumber;segments[t].functionalGroups.push(e)});const t=Math.ceil(e.Rows*e.Columns/8);let n=0;return Object.keys(segments).forEach(a=>{const r=segments[a];r.numberOfFrames=r.functionalGroups.length,r.size=r.numberOfFrames*t,r.offset=n,n=r.offset+r.size;const i=e.PixelData.slice(r.offset,n);r.pixelData=ea.unpack(i);const o=function(e,t){const n={},a=e.SharedFunctionalGroupsSequence.PixelMeasuresSequence,r=e.SharedFunctionalGroupsSequence.PlaneOrientationSequence,i=t[0],o=t[t.length-1],s=i.PlanePositionSequence.ImagePositionPatient.map(Number),c=o.PlanePositionSequence.ImagePositionPatient.map(Number);n.origin=s,n.spacing=[a.PixelSpacing[1],a.PixelSpacing[0],a.SpacingBetweenSlices].map(Number),n.dimensions=[e.Columns,e.Rows,t.length].map(Number);const u=r.ImageOrientationPatient.map(Number),d=u.slice(0,3),l=u.slice(3,6);var m,g,p;return n.planeNormal=[],function(e,t,n){const a=e[1]*t[2]-e[2]*t[1],r=e[2]*t[0]-e[0]*t[2],i=e[0]*t[1]-e[1]*t[0];n[0]=a,n[1]=r,n[2]=i}(d,l,n.planeNormal),n.sliceStep=[],m=c,g=s,(p=n.sliceStep)[0]=m[0]-g[0],p[1]=m[1]-g[1],p[2]=m[2]-g[2],ta(n.sliceStep),n.direction=d.concat(l).concat(n.sliceStep),n}(e,r.functionalGroups);r.geometry=o}),segments}}}},ra={Cornerstone:st,Cornerstone3D:Qn},ia={Cornerstone3D:Jn},{datasetToDict:oa}=u.p;function sa(e,t){let n;if(e instanceof ArrayBuffer)n=new Blob([e],{type:"application/dicom"});else{if(!e._meta)throw new Error("Dataset must have a _meta property");const t=m.hp.from(oa(e).write());n=new Blob([t],{type:"application/dicom"})}const a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=t,a.click()}},75183:(e,t,n)=>{"use strict";var a;n.d(t,{A:()=>r}),function(e){e.Interaction="Interaction",e.HandlesUpdated="HandlesUpdated",e.StatsUpdated="StatsUpdated",e.InitialSetup="InitialSetup",e.Completed="Completed",e.InterpolationUpdated="InterpolationUpdated",e.History="History",e.MetadataReferenceModified="MetadataReferenceModified",e.LabelChange="LabelChange"}(a||(a={}));const r=a},94021:(e,t,n)=>{"use strict";var a;n.d(t,{A:()=>r}),function(e){e.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",e.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",e.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",e.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",e.CROSSHAIR_TOOL_CENTER_CHANGED="CORNERSTONE_TOOLS_CROSSHAIR_TOOL_CENTER_CHANGED",e.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",e.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",e.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",e.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",e.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",e.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",e.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",e.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",e.ANNOTATION_CUT_MERGE_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_CUT_MERGE_PROCESS_COMPLETED",e.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",e.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",e.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",e.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",e.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",e.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",e.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",e.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",e.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",e.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",e.HISTORY_UNDO="CORNERSTONE_TOOLS_HISTORY_UNDO",e.HISTORY_REDO="CORNERSTONE_TOOLS_HISTORY_REDO",e.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",e.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",e.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",e.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",e.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",e.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",e.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",e.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",e.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",e.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",e.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",e.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",e.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",e.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",e.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",e.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",e.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"}(a||(a={}));const r=a},18682:(e,t,n)=>{"use strict";var a;n.d(t,{A:()=>r}),function(e){e.Labelmap="Labelmap",e.Contour="Contour",e.Surface="Surface"}(a||(a={}));const r=a},84093:(e,t,n)=>{"use strict";var a;n.d(t,{A:()=>r}),function(e){e.OnInteractionStart="onInteractionStart",e.OnInteractionEnd="onInteractionEnd",e.Preview="preview",e.RejectPreview="rejectPreview",e.AcceptPreview="acceptPreview",e.Fill="fill",e.Interpolate="interpolate",e.StrategyFunction="strategyFunction",e.CreateIsInThreshold="createIsInThreshold",e.Initialize="initialize",e.INTERNAL_setValue="setValue",e.AddPreview="addPreview",e.ComputeInnerCircleRadius="computeInnerCircleRadius",e.GetStatistics="getStatistics",e.EnsureImageVolumeFor3DManipulation="ensureImageVolumeFor3DManipulation",e.EnsureSegmentationVolumeFor3DManipulation="ensureSegmentationVolumeFor3DManipulation"}(a||(a={}));const r=a},66452:(e,t,n)=>{"use strict";var a,r;n.d(t,{i:()=>a,q:()=>r}),function(e){e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.Primary_And_Secondary=3]="Primary_And_Secondary",e[e.Auxiliary=4]="Auxiliary",e[e.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",e[e.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",e[e.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",e[e.Fourth_Button=8]="Fourth_Button",e[e.Fifth_Button=16]="Fifth_Button",e[e.Wheel=524288]="Wheel",e[e.Wheel_Primary=524289]="Wheel_Primary"}(a||(a={})),function(e){e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta",e[e.ShiftCtrl=1617]="ShiftCtrl",e[e.ShiftAlt=1618]="ShiftAlt",e[e.ShiftMeta=1691]="ShiftMeta",e[e.CtrlAlt=1718]="CtrlAlt",e[e.CtrlMeta=1791]="CtrlMeta",e[e.AltMeta=1891]="AltMeta"}(r||(r={}))},49892:(e,t,n)=>{"use strict";var a;n.d(t,{A:()=>r}),function(e){e.Active="Active",e.Passive="Passive",e.Enabled="Enabled",e.Disabled="Disabled"}(a||(a={}));const r=a},10401:(e,t,n)=>{"use strict";var a;n.d(t,{H:()=>a}),function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(a||(a={}))},99737:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AnnotationStyleStates:()=>o,ChangeTypes:()=>m.A,Events:()=>c.A,KeyboardBindings:()=>r.q,MouseBindings:()=>r.i,SegmentationRepresentations:()=>u.A,StrategyCallbacks:()=>l.A,Swipe:()=>d.H,ToolModes:()=>i.A,WorkerTypes:()=>g});var a,r=n(66452),i=n(49892);!function(e){e.Default="",e.Highlighted="Highlighted",e.Selected="Selected",e.Locked="Locked",e.AutoGenerated="AutoGenerated"}(a||(a={}));const o=a;var s,c=n(94021),u=n(18682),d=n(10401),l=n(84093),m=n(75183);!function(e){e.POLYSEG_CONTOUR_TO_LABELMAP="Converting Contour to Labelmap",e.POLYSEG_SURFACE_TO_LABELMAP="Converting Surfaces to Labelmap",e.POLYSEG_CONTOUR_TO_SURFACE="Converting Contour to Surface",e.POLYSEG_LABELMAP_TO_SURFACE="Converting Labelmap to Surface",e.SURFACE_CLIPPING="Clipping Surfaces",e.COMPUTE_STATISTICS="Computing Statistics",e.INTERPOLATE_LABELMAP="Interpolating Labelmap",e.COMPUTE_LARGEST_BIDIRECTIONAL="Computing Largest Bidirectional",e.GENERATE_CONTOUR_SETS="Generating Contour Sets"}(s||(s={}));const g=s},26337:e=>{"use strict";e.exports=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}},11604:e=>{e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},3293:(e,t,n)=>{var a=n(26337),r=n(11604),i="undefined"!=typeof Float64Array;function o(e,t){return e[0]-t[0]}function s(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(o);var a=new Array(n.length);for(e=0;e<a.length;++e)a[e]=n[e][1];return a}function c(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var r="generic"===e;if(-1===t){var i="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(i)()}if(0===t){i="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",i)(u[e][0])}i=["'use strict'"];var o=a(t),c=o.map(function(e){return"i"+e}),d="this.offset+"+o.map(function(e){return"this.stride["+e+"]*i"+e}).join("+"),l=o.map(function(e){return"b"+e}).join(","),m=o.map(function(e){return"c"+e}).join(",");i.push("function "+n+"(a,"+l+","+m+",d){this.data=a","this.shape=["+l+"]","this.stride=["+m+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),i.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+o.map(function(e){return"this.shape["+e+"]"}).join("*"),"}})"),1===t?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),t<4?(i.push("function "+n+"_order(){"),2===t?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+n+"_set("+c.join(",")+",v){"),r?i.push("return this.data.set("+d+",v)}"):i.push("return this.data["+d+"]=v}"),i.push("proto.get=function "+n+"_get("+c.join(",")+"){"),r?i.push("return this.data.get("+d+")}"):i.push("return this.data["+d+"]}"),i.push("proto.index=function "+n+"_index(",c.join(),"){return "+d+"}"),i.push("proto.hi=function "+n+"_hi("+c.join(",")+"){return new "+n+"(this.data,"+o.map(function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")}).join(",")+","+o.map(function(e){return"this.stride["+e+"]"}).join(",")+",this.offset)}");var g=o.map(function(e){return"a"+e+"=this.shape["+e+"]"}),p=o.map(function(e){return"c"+e+"=this.stride["+e+"]"});i.push("proto.lo=function "+n+"_lo("+c.join(",")+"){var b=this.offset,d=0,"+g.join(",")+","+p.join(","));for(var f=0;f<t;++f)i.push("if(typeof i"+f+"==='number'&&i"+f+">=0){d=i"+f+"|0;b+=c"+f+"*d;a"+f+"-=d}");i.push("return new "+n+"(this.data,"+o.map(function(e){return"a"+e}).join(",")+","+o.map(function(e){return"c"+e}).join(",")+",b)}"),i.push("proto.step=function "+n+"_step("+c.join(",")+"){var "+o.map(function(e){return"a"+e+"=this.shape["+e+"]"}).join(",")+","+o.map(function(e){return"b"+e+"=this.stride["+e+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(f=0;f<t;++f)i.push("if(typeof i"+f+"==='number'){d=i"+f+"|0;if(d<0){c+=b"+f+"*(a"+f+"-1);a"+f+"=ceil(-a"+f+"/d)}else{a"+f+"=ceil(a"+f+"/d)}b"+f+"*=d}");i.push("return new "+n+"(this.data,"+o.map(function(e){return"a"+e}).join(",")+","+o.map(function(e){return"b"+e}).join(",")+",c)}");var S=new Array(t),h=new Array(t);for(f=0;f<t;++f)S[f]="a[i"+f+"]",h[f]="b[i"+f+"]";i.push("proto.transpose=function "+n+"_transpose("+c+"){"+c.map(function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+S.join(",")+","+h.join(",")+",this.offset)}"),i.push("proto.pick=function "+n+"_pick("+c+"){var a=[],b=[],c=this.offset");for(f=0;f<t;++f)i.push("if(typeof i"+f+"==='number'&&i"+f+">=0){c=(c+this.stride["+f+"]*i"+f+")|0}else{a.push(this.shape["+f+"]);b.push(this.stride["+f+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+o.map(function(e){return"shape["+e+"]"}).join(",")+","+o.map(function(e){return"stride["+e+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(u[e],s)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,n,a){if(void 0===e)return(0,u.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var o=t.length;if(void 0===n){n=new Array(o);for(var s=o-1,d=1;s>=0;--s)n[s]=d,d*=t[s]}if(void 0===a){a=0;for(s=0;s<o;++s)n[s]<0&&(a-=(t[s]-1)*n[s])}for(var l=function(e){if(r(e))return"buffer";if(i)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),m=u[l];m.length<=o+1;)m.push(c(l,m.length-1));return(0,m[o+1])(e,t,n,a)}}}]);
//# sourceMappingURL=1443.bundle.e47597af1d8373dc1d43.js.map