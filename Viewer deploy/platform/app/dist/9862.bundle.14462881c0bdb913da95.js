"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[9862],{49862:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var r=n(86326),s=n(97598),i=n.n(s),o=(n(95e3),n(43547)),a=n(4667),l=n(55844),c=n(15327),u=n(15871);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d.apply(null,arguments)}function E(e){const{servicesManager:t}=(0,u.Jg)(),{displaySets:n,viewportId:s}=e,{measurementService:i,cornerstoneViewportService:E,viewportGridService:f,toolbarService:S}=t.services,p=n[0],[v,I]=(0,l.B)(),[g,m]=(0,r.useState)(!1),[b,w]=(0,r.useState)(null),[D,V]=(0,r.useState)(null),{trackedSeries:T}=v.context,{SeriesInstanceUID:h}=p,y=(0,r.useCallback)(()=>{const e=E.getCornerstoneViewport(s);if(e instanceof c.BaseVolumeViewport){const t=e?.getCurrentImageId();if(!t)return void(g&&m(!1))}T.includes(h)!==g&&m(!g)},[g,v,s,h]),R=(0,r.useCallback)(e=>{e.detail.element!==D&&(e.detail.element?.addEventListener(c.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,y),V(e.detail.element))},[y,D]),U=(0,r.useCallback)(()=>{D?.removeEventListener(c.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,y)},[y,D]);(0,r.useEffect)(y,[y]),(0,r.useEffect)(()=>{const{unsubscribe:e}=E.subscribe(E.EVENTS.VIEWPORT_DATA_CHANGED,e=>{e.viewportId===s&&y()});return()=>{e()}},[y,s]),(0,r.useEffect)(()=>g?(a.annotation.config.style.setViewportToolStyles(s,{ReferenceLines:{lineDash:"4,4"},global:{lineDash:""}}),void E.getRenderingEngine().renderViewport(s)):(a.annotation.config.style.setViewportToolStyles(s,{global:{lineDash:"4,4"}}),E.getRenderingEngine().renderViewport(s),()=>{a.annotation.config.style.setViewportToolStyles(s,{})}),[g]),(0,r.useEffect)(()=>{const e=i.EVENTS.MEASUREMENT_ADDED,t=i.EVENTS.RAW_MEASUREMENT_ADDED,n=[];return[e,t].forEach(e=>{n.push(i.subscribe(e,({source:e,measurement:t})=>{const{activeViewportId:n}=f.getState();if(s===n){const{referenceStudyUID:e,referenceSeriesUID:n,uid:r,toolName:i}=t;I("SET_DIRTY",{SeriesInstanceUID:n}),I("TRACK_SERIES",{viewportId:s,StudyInstanceUID:e,SeriesInstanceUID:n,measurementId:r,toolName:i})}}).unsubscribe)}),()=>{n.forEach(e=>{e()})}},[i,I,s,f]);(0,r.useCallback)(e=>{const n=function(e,t,n,r){const{measurementService:s,viewportGridService:i}=t.services,o=s.getMeasurements(),{activeViewportId:a,viewports:l}=i.getState(),{displaySetInstanceUIDs:c}=l.get(a),{trackedSeries:u}=r.context,d=o.filter(e=>u.includes(e.referenceSeriesUID)&&c.includes(e.displaySetInstanceUID));if(!d.length)return;const E=d.length,f=d.map(e=>e.uid);let S=f.findIndex(e=>e===n);-1===S?S=0:(S+=e,S<0?S=E-1:S===E&&(S=0));return f[S]}(e,t,b,v);n&&(w(n),i.jumpToMeasurement(s,n))},[i,t,b,v,s]);return r.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},r.createElement(o.OHIFCornerstoneViewport,d({},e,{onElementEnabled:t=>{e.onElementEnabled?.(t),R(t)},onElementDisabled:U})))}E.propTypes={displaySets:i().arrayOf(i().object.isRequired).isRequired,viewportId:i().string.isRequired,dataSource:i().object,children:i().node};const f=E}}]);
//# sourceMappingURL=9862.bundle.14462881c0bdb913da95.js.map