"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5349,8402],{88414:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var r=n(86326),s=n(97598),a=n.n(s),i=n(95e3),o=n(43547);const l=function({servicesManager:e,rtDisplaySet:t,viewportId:n,preHydrateCallbacks:r,hydrateRTDisplaySet:s}){return o.utils.promptHydrationDialog({servicesManager:e,viewportId:n,displaySet:t,preHydrateCallbacks:r,hydrateCallback:s,type:"RTSTRUCT"})};const c=function(e,t,n){const r=t.getCustomization("cornerstone.overlayViewportTools");return e.createToolGroupAndAddTools(n,r)};var p=n(15871);function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u.apply(null,arguments)}function d(e){const{servicesManager:t,commandsManager:n}=(0,p.Jg)(),{children:s,displaySets:a,viewportOptions:d}=e,{displaySetService:S,toolGroupService:I,segmentationService:y,customizationService:m}=t.services,g=d.viewportId,v=`RTToolGroup-${g}`;if(a.length>1)throw new Error("RT viewport should only have a single display set");const f=m.getCustomization("ui.loadingIndicatorTotalPercent"),T=a[0],[{viewports:w,activeViewportId:D},E]=(0,i.ihW)(),{setPositionPresentation:b}=(0,o.usePositionPresentationStore)(),[h,C]=(0,r.useState)(!T.isLoaded),[P,N]=(0,r.useState)({percentComplete:null,totalSegments:null}),M=(0,r.useRef)(null),k=T.referencedDisplaySetInstanceUID,O=S.getDisplaySetByUID(k),R=function(e){const t=e.images[0],n={PatientID:t.PatientID,PatientName:t.PatientName,PatientSex:t.PatientSex,PatientAge:t.PatientAge,SliceThickness:t.SliceThickness,StudyDate:t.StudyDate,SeriesDescription:t.SeriesDescription,SeriesInstanceUID:t.SeriesInstanceUID,SeriesNumber:t.SeriesNumber,ManufacturerModelName:t.ManufacturerModelName,SpacingBetweenSlices:t.SpacingBetweenSlices};return n}(O);M.current={displaySet:O,metadata:R},(0,r.useEffect)(()=>{h||g===D&&l({servicesManager:t,viewportId:g,rtDisplaySet:T,hydrateRTDisplaySet:async()=>n.runCommand("hydrateSecondaryDisplaySet",{displaySet:T,viewportId:g})})},[t,g,T,h,n,D]),(0,r.useEffect)(()=>{const{unsubscribe:e}=y.subscribe(y.EVENTS.SEGMENTATION_LOADING_COMPLETE,e=>{if(e.rtDisplaySet.displaySetInstanceUID===T.displaySetInstanceUID&&C(!1),T?.firstSegmentedSliceImageId&&d?.presentationIds){const{firstSegmentedSliceImageId:e}=T,{presentationIds:t}=d;b(t.positionPresentationId,{viewportType:"stack",viewReference:{referencedImageId:e},viewPresentation:{}})}});return()=>{e()}},[T]),(0,r.useEffect)(()=>{const e=y.subscribe(y.EVENTS.SEGMENT_LOADING_COMPLETE,({percentComplete:e,numSegments:t})=>{N({percentComplete:e,totalSegments:t})}),t=S.subscribe(S.EVENTS.DISPLAY_SETS_REMOVED,({displaySetInstanceUIDs:e})=>{const t=w.get(D);e.includes(t.displaySetInstanceUID)&&E.setDisplaySetsForViewport({viewportId:D,displaySetInstanceUIDs:[]})});return()=>{e.unsubscribe(),t.unsubscribe()}},[T,S,w,D,E]),(0,r.useEffect)(()=>{let e=I.getToolGroup(v);if(!e)return e=c(I,m,v),()=>{y.removeSegmentationRepresentations(g),M.current=null,I.destroyToolGroup(v)}},[]);const U=(0,r.useCallback)(()=>{const{displaySet:t}=M.current;return r.createElement(o.OHIFCornerstoneViewport,u({},e,{displaySets:[t,T],viewportOptions:{viewportType:"stack",toolGroupId:v,orientation:d.orientation,viewportId:d.viewportId,presentationIds:d.presentationIds},onElementEnabled:t=>{e.onElementEnabled?.(t)}}))},[g,T,v]);let G=null;return M.current&&O.displaySetInstanceUID===M.current.displaySet.displaySetInstanceUID?(s&&s.length&&(G=s.map((e,t)=>e&&r.cloneElement(e,{viewportId:g,key:t}))),r.createElement(r.Fragment,null,r.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},h&&r.createElement(f,{className:"h-full w-full",totalNumbers:P.totalSegments,percentComplete:P.percentComplete,loadingText:"Loading RTSTRUCT..."}),U(),G))):null}d.propTypes={displaySets:a().arrayOf(a().object),viewportId:a().string.isRequired,dataSource:a().object,children:a().node};const S=d}}]);
//# sourceMappingURL=5349.bundle.65b754fa4a24bc1be68d.js.map